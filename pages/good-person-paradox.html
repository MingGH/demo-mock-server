<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¥½äººæ²¡å¥½æŠ¥ï¼Ÿ- ç”¨æ¨¡æ‹Ÿæ­ç¤ºå–„è‰¯çš„æ•°å­¦çœŸç›¸</title>
  <script src="../components/header.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .back-link {
      display: inline-block;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }
    .back-link:hover { text-decoration: underline; }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.8rem;
      background: linear-gradient(135deg, #4ade80, #ffd93d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      text-align: center;
      color: rgba(255,255,255,0.7);
      margin-bottom: 25px;
      font-size: 0.95rem;
    }
    .card {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .question-box {
      background: linear-gradient(135deg, rgba(74,222,128,0.2), rgba(255,217,61,0.1));
      border-left: 4px solid #4ade80;
      padding: 15px 20px;
      border-radius: 0 12px 12px 0;
      margin-bottom: 20px;
      font-size: 1rem;
      line-height: 1.8;
    }
    .question-box strong { color: #ffd93d; }
    
    /* ç¤¾ä¼šæ¨¡æ‹ŸåŒºåŸŸ */
    .society-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 4px;
      margin: 20px 0;
      padding: 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
    }
    .person {
      aspect-ratio: 1;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.3s;
      cursor: pointer;
    }
    .person.good { background: rgba(74,222,128,0.6); }
    .person.bad { background: rgba(255,107,107,0.6); }
    .person.neutral { background: rgba(255,217,61,0.6); }
    .person.dead { background: rgba(100,100,100,0.3); opacity: 0.3; }
    .person:hover { transform: scale(1.2); z-index: 10; }
    
    /* ç»Ÿè®¡é¢æ¿ */
    .stats-panel {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    @media (max-width: 500px) {
      .stats-panel { grid-template-columns: 1fr; }
      .society-grid { grid-template-columns: repeat(8, 1fr); }
    }
    .stat-card {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }
    .stat-card .label {
      font-size: 0.85rem;
      color: rgba(255,255,255,0.5);
      margin-bottom: 8px;
    }
    .stat-card .value {
      font-size: 1.8rem;
      font-weight: bold;
    }
    .stat-card .value.good { color: #4ade80; }
    .stat-card .value.bad { color: #ff6b6b; }
    .stat-card .value.neutral { color: #ffd93d; }
    
    /* æ§åˆ¶æŒ‰é’® */
    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .ctrl-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    .ctrl-btn.primary {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      color: white;
    }
    .ctrl-btn.danger {
      background: linear-gradient(135deg, #ff6b6b, #ef4444);
      color: white;
    }
    .ctrl-btn.secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .ctrl-btn:hover { transform: translateY(-2px); }
    .ctrl-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    /* æ»‘å—æ§åˆ¶ */
    .slider-group {
      margin: 15px 0;
    }
    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
      color: rgba(255,255,255,0.7);
    }
    .slider-label span:last-child { color: #ffd93d; font-weight: bold; }
    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.1);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #ffd93d;
      cursor: pointer;
    }
    
    /* å›¾è¡¨ */
    .chart-container {
      position: relative;
      height: 280px;
      margin-top: 20px;
    }
    
    /* åˆ†æåŒº */
    .analysis {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 22px;
      margin-top: 20px;
    }
    .analysis h3 {
      color: #ffd93d;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .analysis p {
      color: rgba(255,255,255,0.85);
      line-height: 1.85;
      margin-bottom: 14px;
    }
    .analysis .highlight { color: #ff6b6b; font-weight: bold; }
    .analysis .safe { color: #4ade80; font-weight: bold; }
    .analysis .formula {
      background: rgba(255,255,255,0.08);
      padding: 12px 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      margin: 14px 0;
      overflow-x: auto;
    }
    
    /* åœºæ™¯å¡ç‰‡ */
    .scenario-cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    @media (max-width: 550px) {
      .scenario-cards { grid-template-columns: 1fr; }
    }
    .scenario-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .scenario-card:hover { background: rgba(0,0,0,0.3); }
    .scenario-card.selected { border-color: #4ade80; background: rgba(74,222,128,0.1); }
    .scenario-card h4 {
      color: #ffd93d;
      font-size: 1rem;
      margin-bottom: 8px;
    }
    .scenario-card p {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      line-height: 1.5;
    }
    
    /* ç»“è®º */
    .conclusion {
      background: linear-gradient(135deg, rgba(74,222,128,0.15), rgba(255,217,61,0.1));
      border: 2px solid #4ade80;
      border-radius: 16px;
      padding: 25px;
      text-align: center;
      margin-top: 20px;
    }
    .conclusion h3 {
      font-size: 1.4rem;
      margin-bottom: 15px;
      color: #4ade80;
    }
    .conclusion p {
      color: rgba(255,255,255,0.9);
      line-height: 1.85;
    }
    
    /* ç”Ÿæˆæ—¥å¿— */
    .log-section {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px;
      font-size: 0.85rem;
    }
    .log-item {
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      color: rgba(255,255,255,0.6);
    }
    .log-item:last-child { border-bottom: none; }
    .log-item.good { color: #4ade80; }
    .log-item.bad { color: #ff6b6b; }
</style>
</head>
<body>
  <div class="container">
    <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
    <h1>ğŸ˜‡ å¥½äººæ²¡å¥½æŠ¥ï¼Ÿ</h1>
    <p class="subtitle">ç”¨æ¨¡æ‹Ÿæ­ç¤ºå–„è‰¯çš„æ•°å­¦çœŸç›¸</p>
    
    <div class="card">
      <div class="question-box">
        <strong>çµé­‚æ‹·é—®ï¼š</strong>ä¸ºä»€ä¹ˆå¥½äººæ€»æ˜¯åƒäºï¼Ÿ<br>
        è€å®äººè¢«æ¬ºè´Ÿã€å–„è‰¯çš„äººè¢«åˆ©ç”¨ã€è¯šå®çš„äººè¢«éª—...<br>
        éš¾é“ã€Œå¥½äººæ²¡å¥½æŠ¥ã€æ˜¯çœŸçš„å—ï¼Ÿ<br><br>
        <span style="color: #ffd93d;">è®©æˆ‘ä»¬ç”¨æ¨¡æ‹Ÿæ¥çœ‹çœ‹ï¼Œå–„è‰¯åˆ°åº•æ˜¯ä¸æ˜¯ä¸€ç§ã€ŒåŠ£åŠ¿ã€ã€‚</span>
      </div>
    </div>
    
    <!-- ç¤¾ä¼šæ¨¡æ‹Ÿå™¨ -->
    <div class="card">
      <h2 style="margin-bottom: 15px; color: #ffd93d;">ğŸŒ ç¤¾ä¼šç”Ÿå­˜æ¨¡æ‹Ÿå™¨</h2>
      <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
        100ä¸ªäººç»„æˆä¸€ä¸ªå°ç¤¾ä¼šï¼Œæ¯è½®éšæœºé…å¯¹äº’åŠ¨ã€‚<br>
        <span style="color: #4ade80;">ğŸ˜‡ å¥½äºº</span>ï¼šæ€»æ˜¯åˆä½œï¼Œå¸®åŠ©ä»–äºº<br>
        <span style="color: #ff6b6b;">ğŸ˜ˆ åäºº</span>ï¼šæ€»æ˜¯èƒŒå›ï¼Œå åˆ«äººä¾¿å®œ<br>
        <span style="color: #ffd93d;">ğŸ¤” èªæ˜äºº</span>ï¼šä»¥ç‰™è¿˜ç‰™ï¼Œä½ å¯¹æˆ‘å¥½æˆ‘å¯¹ä½ å¥½
      </p>
      
      <div class="slider-group">
        <div class="slider-label">
          <span>ğŸ˜‡ å¥½äººæ¯”ä¾‹</span>
          <span id="goodRatioValue">40%</span>
        </div>
        <input type="range" id="goodRatio" min="0" max="100" value="40" oninput="updateRatios('good')">
      </div>
      
      <div class="slider-group">
        <div class="slider-label">
          <span>ğŸ˜ˆ åäººæ¯”ä¾‹</span>
          <span id="badRatioValue">30%</span>
        </div>
        <input type="range" id="badRatio" min="0" max="100" value="30" oninput="updateRatios('bad')">
      </div>
      
      <div class="slider-group">
        <div class="slider-label">
          <span>ğŸ¤” èªæ˜äººæ¯”ä¾‹</span>
          <span id="smartRatioValue">30%</span>
        </div>
        <input type="range" id="smartRatio" min="0" max="100" value="30" oninput="updateRatios('smart')">
      </div>
      
      <div class="stats-panel">
        <div class="stat-card">
          <div class="label">ğŸ˜‡ å¥½äººå­˜æ´»</div>
          <div class="value good" id="goodCount">40</div>
        </div>
        <div class="stat-card">
          <div class="label">ğŸ˜ˆ åäººå­˜æ´»</div>
          <div class="value bad" id="badCount">30</div>
        </div>
        <div class="stat-card">
          <div class="label">ğŸ¤” èªæ˜äººå­˜æ´»</div>
          <div class="value neutral" id="smartCount">30</div>
        </div>
      </div>
      
      <div class="society-grid" id="societyGrid"></div>
      
      <div class="controls">
        <button class="ctrl-btn primary" id="startBtn" onclick="startSimulation()">â–¶ï¸ å¼€å§‹æ¨¡æ‹Ÿ</button>
        <button class="ctrl-btn secondary" onclick="stepSimulation()">â­ï¸ å•æ­¥</button>
        <button class="ctrl-btn danger" onclick="resetSimulation()">ğŸ”„ é‡ç½®</button>
      </div>
      
      <div style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.9rem;">
        ç¬¬ <span id="generation">0</span> ä»£ | æ€»äº’åŠ¨ <span id="totalInteractions">0</span> æ¬¡
      </div>
      
      <div class="chart-container">
        <canvas id="populationChart"></canvas>
      </div>
    </div>
    
    <!-- åœºæ™¯é€‰æ‹© -->
    <div class="card">
      <h2 style="margin-bottom: 15px; color: #ffd93d;">ğŸ­ ä¸åŒç¯å¢ƒä¸‹çš„ç»“æœ</h2>
      <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
        é€‰æ‹©ä¸€ä¸ªé¢„è®¾åœºæ™¯ï¼Œçœ‹çœ‹ä¸åŒç¤¾ä¼šç¯å¢ƒä¸‹ï¼Œå¥½äººçš„å‘½è¿å¦‚ä½•ã€‚
      </p>
      
      <div class="scenario-cards">
        <div class="scenario-card" onclick="loadScenario('jungle')">
          <h4>ğŸŒ´ ä¸›æ—ç¤¾ä¼š</h4>
          <p>80%åäººï¼Œ10%å¥½äººï¼Œ10%èªæ˜äººã€‚å¼±è‚‰å¼ºé£Ÿï¼Œå¥½äººèƒ½æ´»ä¸‹æ¥å—ï¼Ÿ</p>
        </div>
        <div class="scenario-card" onclick="loadScenario('utopia')">
          <h4>ğŸŒˆ ç†æƒ³ç¤¾ä¼š</h4>
          <p>80%å¥½äººï¼Œ10%åäººï¼Œ10%èªæ˜äººã€‚åäººä¼šè¢«åŒåŒ–è¿˜æ˜¯ä¼šæ‰©å¼ ï¼Ÿ</p>
        </div>
        <div class="scenario-card" onclick="loadScenario('balanced')">
          <h4>âš–ï¸ å‡è¡¡ç¤¾ä¼š</h4>
          <p>å„å 1/3ã€‚æœ€æ¥è¿‘ç°å®ï¼Œçœ‹çœ‹è°èƒ½ç¬‘åˆ°æœ€åã€‚</p>
        </div>
        <div class="scenario-card" onclick="loadScenario('smart')">
          <h4>ğŸ§  èªæ˜äººç¤¾ä¼š</h4>
          <p>80%èªæ˜äººï¼Œ10%å¥½äººï¼Œ10%åäººã€‚ä»¥ç‰™è¿˜ç‰™ç­–ç•¥ä¼šä¸»å¯¼å—ï¼Ÿ</p>
        </div>
      </div>
    </div>
    
    <!-- æ•°å­¦åˆ†æ -->
    <div class="card analysis">
      <h3>ğŸ“ ä¸ºä»€ä¹ˆå¥½äººã€Œçœ‹èµ·æ¥ã€åƒäºï¼Ÿ</h3>
      
      <p><strong>1. çŸ­æœŸ vs é•¿æœŸ</strong></p>
      <p>
        åœ¨<span class="highlight">å•æ¬¡åšå¼ˆ</span>ä¸­ï¼Œå¥½äººç¡®å®åƒäºï¼š<br>
        å¥½äººé‡åˆ°åäºº â†’ å¥½äººè¢«å ä¾¿å®œ<br>
        å¥½äººé‡åˆ°å¥½äºº â†’ åŒæ–¹éƒ½å¥½<br>
        åäººé‡åˆ°å¥½äºº â†’ åäººå ä¾¿å®œ
      </p>
      <div class="formula">
        å•æ¬¡æ”¶ç›Šï¼šåäºº > å¥½äººï¼ˆå¦‚æœå¯¹æ–¹æ˜¯å¥½äººï¼‰
      </div>
      <p>
        ä½†åœ¨<span class="safe">é‡å¤åšå¼ˆ</span>ä¸­ï¼Œæƒ…å†µå®Œå…¨ä¸åŒï¼š<br>
        åäººä¼šè¢«è¯†åˆ«ã€è¢«å­¤ç«‹ã€è¢«æŠ¥å¤ã€‚<br>
        å¥½äººä¼šå»ºç«‹ä¿¡ä»»ã€è·å¾—åˆä½œã€å½¢æˆè”ç›Ÿã€‚
      </p>
      
      <p><strong>2. ç¯å¢ƒå†³å®šå‘½è¿</strong></p>
      <p>
        å¥½äººåœ¨<span class="highlight">åäººå¤šçš„ç¯å¢ƒ</span>é‡Œç¡®å®éš¾ä»¥ç”Ÿå­˜â€”â€”è¿™ä¸æ˜¯å¥½äººçš„é—®é¢˜ï¼Œæ˜¯ç¯å¢ƒçš„é—®é¢˜ã€‚<br>
        ä½†åœ¨<span class="safe">æ­£å¸¸ç¤¾ä¼š</span>é‡Œï¼Œå¥½äººå¾€å¾€èƒ½è·å¾—æ›´å¤šé•¿æœŸæ”¶ç›Šã€‚
      </p>
      <p>
        å…³é”®å˜é‡ï¼š<br>
        â€¢ äº’åŠ¨æ˜¯å¦é‡å¤ï¼Ÿï¼ˆä¸€æ¬¡æ€§ vs é•¿æœŸå…³ç³»ï¼‰<br>
        â€¢ èƒŒå›æ˜¯å¦æœ‰ä»£ä»·ï¼Ÿï¼ˆå£°èª‰ã€æƒ©ç½šæœºåˆ¶ï¼‰<br>
        â€¢ å¥½äººèƒ½å¦è¯†åˆ«åäººï¼Ÿï¼ˆä¿¡æ¯é€æ˜åº¦ï¼‰
      </p>
      
      <p><strong>3. ã€Œèªæ˜çš„å¥½äººã€æ‰æ˜¯æœ€ä¼˜è§£</strong></p>
      <p>
        çº¯ç²¹çš„å¥½äººï¼ˆæ°¸è¿œåˆä½œï¼‰å®¹æ˜“è¢«åˆ©ç”¨ã€‚<br>
        çº¯ç²¹çš„åäººï¼ˆæ°¸è¿œèƒŒå›ï¼‰ä¼šè¢«å­¤ç«‹ã€‚<br>
        <span class="safe">ã€Œä»¥ç‰™è¿˜ç‰™ã€</span>ç­–ç•¥ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼š
      </p>
      <div class="formula">
        ä»¥ç‰™è¿˜ç‰™ = å–„è‰¯ï¼ˆå…ˆåˆä½œï¼‰+ å¯æ¿€æ€’ï¼ˆè¢«èƒŒå›å°±æŠ¥å¤ï¼‰+ å®½å®¹ï¼ˆå¯¹æ–¹æ”¹è¿‡å°±åŸè°…ï¼‰
      </div>
      <p>
        è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ¨¡æ‹Ÿä¸­ã€Œèªæ˜äººã€å¾€å¾€èƒ½ç¬‘åˆ°æœ€åã€‚
      </p>
    </div>
    
    <!-- ç°å®æ¡ˆä¾‹ -->
    <div class="card analysis">
      <h3>ğŸŒ ç°å®ä¸­çš„ã€Œå¥½äººå›°å¢ƒã€</h3>
      
      <p><strong>1. èŒåœºè€å®äºº</strong></p>
      <p>
        è€å®äººæ€»æ˜¯è¢«å®‰æ’æ›´å¤šå·¥ä½œï¼Œä¸ä¼šæ‹’ç»ï¼Œä¸ä¼šé‚€åŠŸã€‚<br>
        çŸ­æœŸçœ‹ï¼šè€å®äººåƒäºï¼Œä¼šæ¥äº‹çš„äººå‡èŒã€‚<br>
        é•¿æœŸçœ‹ï¼šè€å®äººå»ºç«‹äº†å¯é çš„å£ç¢‘ï¼Œå…³é”®æ—¶åˆ»è¢«ä¿¡ä»»ã€‚<br>
        <span class="safe">ä½†å‰ææ˜¯ï¼šç¯å¢ƒè¦èƒ½è¯†åˆ«å’Œå¥–åŠ±å¯é æ€§ã€‚</span>
      </p>
      
      <p><strong>2. å•†ä¸šè¯šä¿¡</strong></p>
      <p>
        éª—å­çŸ­æœŸèƒ½èµšå¿«é’±ï¼Œä½†ä¼šè¢«å¸‚åœºæ·˜æ±°ã€‚<br>
        è¯šä¿¡å•†å®¶çŸ­æœŸå¯èƒ½åƒäºï¼Œä½†èƒ½å»ºç«‹å“ç‰Œå’Œå›å¤´å®¢ã€‚<br>
        <span class="highlight">å…³é”®ï¼šå¸‚åœºä¿¡æ¯æ˜¯å¦é€æ˜ï¼Œéª—å­æ˜¯å¦ä¼šè¢«æ›å…‰ã€‚</span>
      </p>
      
      <p><strong>3. ç¤¾äº¤å…³ç³»</strong></p>
      <p>
        æ€»æ˜¯ä»˜å‡ºçš„äººå®¹æ˜“è¢«å½“æˆã€Œå·¥å…·äººã€ã€‚<br>
        ä½†çœŸæ­£çš„å¥½äººä¼šå¸å¼•åŒæ ·å–„è‰¯çš„äººï¼Œå½¢æˆé«˜è´¨é‡ç¤¾äº¤åœˆã€‚<br>
        <span class="safe">å…³é”®ï¼šå­¦ä¼šè¯†åˆ«å’Œè¿œç¦»ã€Œå¸è¡€é¬¼ã€ã€‚</span>
      </p>
    </div>
    
    <!-- ç»“è®º -->
    <div class="card conclusion">
      <h3>ğŸ’¡ å¥½äººæ²¡å¥½æŠ¥ï¼Ÿä¸ï¼Œæ˜¯ã€Œå‚»å¥½äººã€æ²¡å¥½æŠ¥</h3>
      <p>
        ã€Œå¥½äººæ²¡å¥½æŠ¥ã€æ˜¯ä¸€ç§<span style="color: #ff6b6b;">å¹¸å­˜è€…åå·®</span>â€”â€”<br>
        æˆ‘ä»¬åªè®°ä½äº†å¥½äººåƒäºçš„æ¡ˆä¾‹ï¼Œå¿˜è®°äº†å¥½äººæˆåŠŸçš„æ¡ˆä¾‹ã€‚<br><br>
        
        çœŸç›¸æ˜¯ï¼š<br>
        <span style="color: #ffd93d;">å–„è‰¯æ˜¯ä¸€ç§é•¿æœŸç­–ç•¥ï¼Œä¸æ˜¯çŸ­æœŸç­–ç•¥ã€‚</span><br><br>
        
        çº¯ç²¹çš„ã€Œå‚»å¥½äººã€ç¡®å®å®¹æ˜“è¢«åˆ©ç”¨ã€‚<br>
        ä½†<span style="color: #4ade80;">ã€Œèªæ˜çš„å¥½äººã€</span>â€”â€”å–„è‰¯ä½†æœ‰åº•çº¿ã€ä¿¡ä»»ä½†ä¼šéªŒè¯ã€<br>
        å¸®åŠ©ä½†ä¸è¢«åˆ©ç”¨â€”â€”æ‰æ˜¯çœŸæ­£çš„èµ¢å®¶ã€‚<br><br>
        
        <span style="color: rgba(255,255,255,0.6);">
          ä¸æ˜¯å¥½äººæ²¡å¥½æŠ¥ï¼Œ<br>
          æ˜¯ä½ éœ€è¦åœ¨å¯¹çš„ç¯å¢ƒé‡Œï¼Œåšä¸€ä¸ªèªæ˜çš„å¥½äººã€‚
        </span>
      </p>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let population = [];
    let generation = 0;
    let totalInteractions = 0;
    let isRunning = false;
    let animationId = null;
    let chart = null;
    let historyData = { good: [40], bad: [30], smart: [30] };
    
    // æ”¶ç›ŠçŸ©é˜µ
    const PAYOFF = {
      'cooperate-cooperate': [3, 3],
      'cooperate-defect': [0, 5],
      'defect-cooperate': [5, 0],
      'defect-defect': [1, 1]
    };
    
    // åˆå§‹åŒ–
    function init() {
      updateRatios();
      initChart();  // å…ˆåˆå§‹åŒ–å›¾è¡¨
      resetSimulation();
    }
    
    function updateRatios(changed) {
      let good = parseInt(document.getElementById('goodRatio').value);
      let bad = parseInt(document.getElementById('badRatio').value);
      let smart = parseInt(document.getElementById('smartRatio').value);
      
      const total = good + bad + smart;
      
      if (total !== 100 && total > 0) {
        // å½’ä¸€åŒ–åˆ°100%
        good = Math.round(good / total * 100);
        bad = Math.round(bad / total * 100);
        smart = 100 - good - bad;
        
        // æ›´æ–°æ»‘æ†å€¼
        document.getElementById('goodRatio').value = good;
        document.getElementById('badRatio').value = bad;
        document.getElementById('smartRatio').value = smart;
      }
      
      document.getElementById('goodRatioValue').textContent = good + '%';
      document.getElementById('badRatioValue').textContent = bad + '%';
      document.getElementById('smartRatioValue').textContent = smart + '%';
    }
    
    function resetSimulation() {
      isRunning = false;
      if (animationId) cancelAnimationFrame(animationId);
      document.getElementById('startBtn').textContent = 'â–¶ï¸ å¼€å§‹æ¨¡æ‹Ÿ';
      
      const good = parseInt(document.getElementById('goodRatio').value);
      const bad = parseInt(document.getElementById('badRatio').value);
      const smart = 100 - good - bad;
      
      population = [];
      for (let i = 0; i < good; i++) population.push({ type: 'good', score: 0, memory: {} });
      for (let i = 0; i < bad; i++) population.push({ type: 'bad', score: 0, memory: {} });
      for (let i = 0; i < smart; i++) population.push({ type: 'smart', score: 0, memory: {} });
      
      // æ‰“ä¹±é¡ºåº
      population.sort(() => Math.random() - 0.5);
      
      generation = 0;
      totalInteractions = 0;
      historyData = { good: [good], bad: [bad], smart: [smart] };
      
      updateDisplay();
      updateChart();
    }
    
    function updateDisplay() {
      const grid = document.getElementById('societyGrid');
      grid.innerHTML = '';
      
      let goodCount = 0, badCount = 0, smartCount = 0;
      
      population.forEach((person, i) => {
        const div = document.createElement('div');
        div.className = `person ${person.type}`;
        div.title = `${person.type === 'good' ? 'å¥½äºº' : person.type === 'bad' ? 'åäºº' : 'èªæ˜äºº'}\nç§¯åˆ†: ${person.score}`;
        
        if (person.type === 'good') { div.textContent = 'ğŸ˜‡'; goodCount++; }
        else if (person.type === 'bad') { div.textContent = 'ğŸ˜ˆ'; badCount++; }
        else { div.textContent = 'ğŸ¤”'; smartCount++; }
        
        grid.appendChild(div);
      });
      
      document.getElementById('goodCount').textContent = goodCount;
      document.getElementById('badCount').textContent = badCount;
      document.getElementById('smartCount').textContent = smartCount;
      document.getElementById('generation').textContent = generation;
      document.getElementById('totalInteractions').textContent = totalInteractions;
    }
    
    function getAction(person, opponentId) {
      if (person.type === 'good') return 'cooperate';
      if (person.type === 'bad') return 'defect';
      // èªæ˜äººï¼šä»¥ç‰™è¿˜ç‰™
      if (person.memory[opponentId] === undefined) return 'cooperate';
      return person.memory[opponentId];
    }
    
    function interact(p1, p2, id1, id2) {
      const action1 = getAction(p1, id2);
      const action2 = getAction(p2, id1);
      
      const key = `${action1}-${action2}`;
      const [score1, score2] = PAYOFF[key];
      
      p1.score += score1;
      p2.score += score2;
      
      // è®°å¿†å¯¹æ–¹çš„è¡Œä¸º
      p1.memory[id2] = action2;
      p2.memory[id1] = action1;
      
      totalInteractions++;
    }
    
    function runGeneration() {
      // æ¯ä¸ªäººéšæœºé…å¯¹äº’åŠ¨5æ¬¡
      for (let round = 0; round < 5; round++) {
        const shuffled = [...population.keys()].sort(() => Math.random() - 0.5);
        for (let i = 0; i < shuffled.length - 1; i += 2) {
          const id1 = shuffled[i];
          const id2 = shuffled[i + 1];
          interact(population[id1], population[id2], id1, id2);
        }
      }
      
      // è‡ªç„¶é€‰æ‹©ï¼šæ·˜æ±°æœ€ä½åˆ†çš„10%ï¼Œå¤åˆ¶æœ€é«˜åˆ†çš„10%
      population.sort((a, b) => a.score - b.score);
      
      const eliminateCount = Math.floor(population.length * 0.1);
      const topPerformers = population.slice(-eliminateCount);
      
      // ç§»é™¤æœ€ä½åˆ†çš„
      population = population.slice(eliminateCount);
      
      // å¤åˆ¶æœ€é«˜åˆ†çš„
      topPerformers.forEach(p => {
        population.push({
          type: p.type,
          score: 0,
          memory: {}
        });
      });
      
      // é‡ç½®åˆ†æ•°
      population.forEach(p => { p.score = 0; p.memory = {}; });
      
      // æ‰“ä¹±é¡ºåº
      population.sort(() => Math.random() - 0.5);
      
      generation++;
      
      // è®°å½•å†å²
      const counts = { good: 0, bad: 0, smart: 0 };
      population.forEach(p => counts[p.type]++);
      historyData.good.push(counts.good);
      historyData.bad.push(counts.bad);
      historyData.smart.push(counts.smart);
      
      updateDisplay();
      updateChart();
    }
    
    function startSimulation() {
      if (isRunning) {
        isRunning = false;
        document.getElementById('startBtn').textContent = 'â–¶ï¸ ç»§ç»­æ¨¡æ‹Ÿ';
        return;
      }
      
      isRunning = true;
      document.getElementById('startBtn').textContent = 'â¸ï¸ æš‚åœ';
      
      function loop() {
        if (!isRunning) return;
        runGeneration();
        
        // æ£€æŸ¥æ˜¯å¦ç»“æŸï¼ˆåªæœ‰å½“åŸæœ¬å­˜åœ¨çš„ç±»å‹ç­ç»æ—¶æ‰åœæ­¢ï¼‰
        const counts = { good: 0, bad: 0, smart: 0 };
        population.forEach(p => counts[p.type]++);
        
        // è·å–åˆå§‹æ¯”ä¾‹ï¼Œåˆ¤æ–­å“ªäº›ç±»å‹åŸæœ¬å°±å­˜åœ¨
        const initGood = parseInt(document.getElementById('goodRatio').value);
        const initBad = parseInt(document.getElementById('badRatio').value);
        const initSmart = parseInt(document.getElementById('smartRatio').value);
        
        const extinct = (initGood > 0 && counts.good === 0) || 
                       (initBad > 0 && counts.bad === 0) || 
                       (initSmart > 0 && counts.smart === 0);
        
        if (extinct || generation >= 100) {
          isRunning = false;
          document.getElementById('startBtn').textContent = 'â–¶ï¸ é‡æ–°å¼€å§‹';
          return;
        }
        
        animationId = setTimeout(loop, 200);
      }
      
      loop();
    }
    
    function stepSimulation() {
      if (isRunning) return;
      runGeneration();
    }
    
    function loadScenario(type) {
      document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
      event.target.closest('.scenario-card').classList.add('selected');
      
      let good, bad;
      switch(type) {
        case 'jungle': good = 10; bad = 80; break;
        case 'utopia': good = 80; bad = 10; break;
        case 'balanced': good = 33; bad = 33; break;
        case 'smart': good = 10; bad = 10; break;
      }
      
      document.getElementById('goodRatio').value = good;
      document.getElementById('badRatio').value = bad;
      updateRatios();
      resetSimulation();
    }
    
    function initChart() {
      const ctx = document.getElementById('populationChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [0],
          datasets: [
            {
              label: 'ğŸ˜‡ å¥½äºº',
              data: historyData.good,
              borderColor: '#4ade80',
              backgroundColor: 'rgba(74, 222, 128, 0.1)',
              fill: true,
              tension: 0.3
            },
            {
              label: 'ğŸ˜ˆ åäºº',
              data: historyData.bad,
              borderColor: '#ff6b6b',
              backgroundColor: 'rgba(255, 107, 107, 0.1)',
              fill: true,
              tension: 0.3
            },
            {
              label: 'ğŸ¤” èªæ˜äºº',
              data: historyData.smart,
              borderColor: '#ffd93d',
              backgroundColor: 'rgba(255, 217, 61, 0.1)',
              fill: true,
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: 'rgba(255,255,255,0.7)' }
            }
          },
          scales: {
            x: {
              title: { display: true, text: 'ä»£æ•°', color: 'rgba(255,255,255,0.5)' },
              ticks: { color: 'rgba(255,255,255,0.5)' },
              grid: { color: 'rgba(255,255,255,0.05)' }
            },
            y: {
              title: { display: true, text: 'äººæ•°', color: 'rgba(255,255,255,0.5)' },
              ticks: { color: 'rgba(255,255,255,0.5)' },
              grid: { color: 'rgba(255,255,255,0.05)' },
              min: 0,
              max: 100
            }
          }
        }
      });
    }
    
    function updateChart() {
      if (!chart) return;
      chart.data.labels = Array.from({ length: historyData.good.length }, (_, i) => i);
      chart.data.datasets[0].data = historyData.good;
      chart.data.datasets[1].data = historyData.bad;
      chart.data.datasets[2].data = historyData.smart;
      chart.update('none');
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>