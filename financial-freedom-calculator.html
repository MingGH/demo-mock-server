<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœ€åˆçº§è´¢å¯Œè‡ªç”±è®¡ç®—å™¨ - ä½ ç¦»èººå¹³è¿˜æœ‰å¤šè¿œï¼Ÿ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 30px 20px;
    }

    .container { max-width: 900px; margin: 0 auto; }

    .header { text-align: center; margin: 20px 0 40px; }
    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(90deg, #22d3ee, #a78bfa, #f472b6, #22d3ee);
      background-size: 300% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient 6s ease infinite;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .header p { color: rgba(255,255,255,0.5); margin-top: 12px; font-size: 15px; }

    .section-title {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      margin-bottom: 15px;
      padding-left: 5px;
      border-left: 3px solid #a78bfa;
    }

    .input-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .input-card {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 15px;
    }
    .input-card label {
      display: block;
      color: rgba(255,255,255,0.6);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .input-card input, .input-card select {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px 12px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      outline: none;
      transition: border-color 0.3s;
    }
    .input-card input:focus, .input-card select:focus { border-color: #a78bfa; }
    .input-card select option { background: #1e293b; }
    .input-card .unit { color: rgba(255,255,255,0.4); font-size: 11px; margin-top: 4px; }

    .controls { display: flex; justify-content: center; margin: 30px 0; }
    .btn {
      padding: 14px 40px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s;
      background: linear-gradient(135deg, #a78bfa, #22d3ee);
      color: white;
      box-shadow: 0 5px 25px rgba(167, 139, 250, 0.3);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 35px rgba(167, 139, 250, 0.4);
    }

    .results { display: none; }
    .results.show { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .result-hero {
      background: linear-gradient(135deg, rgba(167,139,250,0.15), rgba(34,211,238,0.15));
      border-radius: 20px;
      border: 1px solid rgba(167,139,250,0.3);
      padding: 40px;
      text-align: center;
      margin-bottom: 25px;
    }
    .result-hero .label { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 10px; }
    .result-hero .amount {
      font-size: 3.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #22d3ee, #a78bfa);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .result-hero .amount span { font-size: 1.5rem; }
    .result-hero .sub { color: rgba(255,255,255,0.5); font-size: 13px; margin-top: 10px; }

    .breakdown {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .breakdown-card {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
      text-align: center;
    }
    .breakdown-card .icon { font-size: 24px; margin-bottom: 8px; }
    .breakdown-card .value { font-size: 1.5rem; font-weight: 700; color: #22d3ee; }
    .breakdown-card .label { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px; }

    .chart-section {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 25px;
    }
    .chart-section h3 { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; text-align: center; }
    .chart-container { position: relative; height: 280px; }

    .levels {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 25px;
    }
    .levels h3 { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; }
    .level-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .level-item:last-child { border-bottom: none; }
    .level-item .rank { width: 30px; font-size: 18px; }
    .level-item .name { flex: 1; color: rgba(255,255,255,0.8); }
    .level-item .amount { font-weight: 600; color: #a78bfa; }
    .level-item.current { background: rgba(167,139,250,0.1); border-radius: 8px; margin: 0 -10px; padding: 12px 10px; }
    .level-item.current .name { color: #22d3ee; font-weight: 600; }

    .tips {
      background: rgba(34,211,238,0.1);
      border-radius: 12px;
      border: 1px solid rgba(34,211,238,0.2);
      padding: 20px;
      margin-bottom: 25px;
    }
    .tips h3 { color: #22d3ee; font-size: 14px; margin-bottom: 12px; }
    .tips ul { list-style: none; }
    .tips li { color: rgba(255,255,255,0.7); font-size: 13px; line-height: 1.8; padding-left: 20px; position: relative; }
    .tips li::before { content: 'ğŸ’¡'; position: absolute; left: 0; }

    .formula {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 20px;
      font-size: 13px;
      color: rgba(255,255,255,0.4);
    }
    .formula summary { cursor: pointer; color: rgba(255,255,255,0.6); }
    .formula p { margin-top: 10px; line-height: 1.8; }
    .formula code { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; }

    @media (max-width: 600px) {
      .result-hero .amount { font-size: 2.5rem; }
      .header h1 { font-size: 1.6rem; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ–ï¸ æœ€åˆçº§è´¢å¯Œè‡ªç”±è®¡ç®—å™¨</h1>
    <p>ç®—ç®—ä½ ç¦»"èººå¹³"è¿˜å·®å¤šå°‘é’±</p>
  </div>

  <div class="section-title">ğŸ’° åŸºæœ¬ç”Ÿæ´»å¼€æ”¯</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ  ä½æˆ¿æ”¯å‡º</label>
      <input type="number" id="housing" value="2000" min="0" step="100">
      <div class="unit">å…ƒ/æœˆï¼ˆæˆ¿è´·/æˆ¿ç§Ÿï¼‰</div>
    </div>
    <div class="input-card">
      <label>ğŸœ é¤é¥®æ”¯å‡º</label>
      <input type="number" id="food" value="2000" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸš— äº¤é€šå‡ºè¡Œ</label>
      <input type="number" id="transport" value="500" min="0" step="50">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ“± é€šè®¯ç½‘ç»œ</label>
      <input type="number" id="telecom" value="200" min="0" step="50">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
  </div>

  <div class="section-title">ğŸ¯ å…¶ä»–å¿…è¦æ”¯å‡º</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ¥ åŒ»ç–—ä¿é™©</label>
      <input type="number" id="medical" value="500" min="0" step="100">
      <div class="unit">å…ƒ/æœˆï¼ˆå«å•†ä¸šä¿é™©ï¼‰</div>
    </div>
    <div class="input-card">
      <label>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ èµ¡å…»æ”¯å‡º</label>
      <input type="number" id="family" value="1000" min="0" step="100">
      <div class="unit">å…ƒ/æœˆï¼ˆçˆ¶æ¯/å­å¥³ï¼‰</div>
    </div>
    <div class="input-card">
      <label>ğŸ® å¨±ä¹ä¼‘é—²</label>
      <input type="number" id="entertainment" value="800" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ“¦ å…¶ä»–æ‚é¡¹</label>
      <input type="number" id="misc" value="500" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
  </div>

  <div class="section-title">âš™ï¸ è®¡ç®—å‚æ•°</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ“ˆ é¢„æœŸå¹´åŒ–æ”¶ç›Šç‡</label>
      <select id="returnRate">
        <option value="0.03">3% - ä¿å®ˆå‹ï¼ˆå¤§é¢å­˜å•/å›½å€ºï¼‰</option>
        <option value="0.04" selected>4% - ç¨³å¥å‹ï¼ˆå€ºåˆ¸åŸºé‡‘ä¸ºä¸»ï¼‰</option>
        <option value="0.05">5% - å¹³è¡¡å‹ï¼ˆè‚¡å€ºæ··åˆï¼‰</option>
        <option value="0.06">6% - è¿›å–å‹ï¼ˆæŒ‡æ•°åŸºé‡‘ä¸ºä¸»ï¼‰</option>
      </select>
    </div>
    <div class="input-card">
      <label>ğŸ“Š é€šèƒ€é¢„æœŸ</label>
      <select id="inflation">
        <option value="0.02">2% - ä½é€šèƒ€</option>
        <option value="0.03" selected>3% - æ­£å¸¸æ°´å¹³</option>
        <option value="0.04">4% - è¾ƒé«˜é€šèƒ€</option>
      </select>
    </div>
    <div class="input-card">
      <label>ğŸ›¡ï¸ å®‰å…¨è¾¹é™…</label>
      <select id="safetyMargin">
        <option value="1.0">æ— ï¼ˆåˆšå¥½å¤Ÿç”¨ï¼‰</option>
        <option value="1.2" selected>20%ï¼ˆæ¨èï¼‰</option>
        <option value="1.5">50%ï¼ˆä¿å®ˆï¼‰</option>
        <option value="2.0">100%ï¼ˆéå¸¸ä¿å®ˆï¼‰</option>
      </select>
    </div>
    <div class="input-card">
      <label>â° è®¡åˆ’èººå¹³å¹´é™</label>
      <select id="years">
        <option value="30">30å¹´</option>
        <option value="40" selected>40å¹´</option>
        <option value="50">50å¹´ï¼ˆæ°¸ç»­ï¼‰</option>
      </select>
    </div>
  </div>

  <div class="controls">
    <button class="btn" onclick="calculate()">ğŸ§® å¼€å§‹è®¡ç®—</button>
  </div>

  <div class="results" id="results">
    <div class="result-hero">
      <div class="label">ğŸ¯ ä½ çš„æœ€åˆçº§è´¢å¯Œè‡ªç”±é—¨æ§›</div>
      <div class="amount" id="totalAmount">0<span>ä¸‡å…ƒ</span></div>
      <div class="sub" id="subText">æ¯æœˆè¢«åŠ¨æ”¶å…¥è¦†ç›–åŸºæœ¬ç”Ÿæ´»å¼€æ”¯</div>
    </div>

    <div class="breakdown">
      <div class="breakdown-card">
        <div class="icon">ğŸ’¸</div>
        <div class="value" id="monthlyExpense">0</div>
        <div class="label">æœˆæ”¯å‡º</div>
      </div>
      <div class="breakdown-card">
        <div class="icon">ğŸ“…</div>
        <div class="value" id="yearlyExpense">0</div>
        <div class="label">å¹´æ”¯å‡º</div>
      </div>
      <div class="breakdown-card">
        <div class="icon">ğŸ“ˆ</div>
        <div class="value" id="realReturn">0%</div>
        <div class="label">å®é™…æ”¶ç›Šç‡</div>
      </div>
      <div class="breakdown-card">
        <div class="icon">ğŸ›¡ï¸</div>
        <div class="value" id="safetyAmount">0</div>
        <div class="label">å®‰å…¨è¾¹é™…</div>
      </div>
    </div>

    <div class="chart-section">
      <h3>ğŸ“Š æœˆæ”¯å‡ºæ„æˆ</h3>
      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <div class="levels">
      <h3>ğŸ† è´¢å¯Œè‡ªç”±ç­‰çº§å‚è€ƒ</h3>
      <div id="levelList"></div>
    </div>

    <div class="tips">
      <h3>ğŸ’¡ å®ç°å»ºè®®</h3>
      <ul id="tipsList"></ul>
    </div>

    <details class="formula">
      <summary>ğŸ“ è®¡ç®—å…¬å¼è¯´æ˜</summary>
      <p id="formulaText"></p>
    </details>
  </div>
</div>

<script>
let pieChart = null;

function calculate() {
  // è·å–æ‰€æœ‰è¾“å…¥
  const housing = parseFloat(document.getElementById('housing').value) || 0;
  const food = parseFloat(document.getElementById('food').value) || 0;
  const transport = parseFloat(document.getElementById('transport').value) || 0;
  const telecom = parseFloat(document.getElementById('telecom').value) || 0;
  const medical = parseFloat(document.getElementById('medical').value) || 0;
  const family = parseFloat(document.getElementById('family').value) || 0;
  const entertainment = parseFloat(document.getElementById('entertainment').value) || 0;
  const misc = parseFloat(document.getElementById('misc').value) || 0;
  
  const returnRate = parseFloat(document.getElementById('returnRate').value);
  const inflation = parseFloat(document.getElementById('inflation').value);
  const safetyMargin = parseFloat(document.getElementById('safetyMargin').value);
  const years = parseInt(document.getElementById('years').value);
  
  // è®¡ç®—æœˆæ”¯å‡ºå’Œå¹´æ”¯å‡º
  const monthlyExpense = housing + food + transport + telecom + medical + family + entertainment + misc;
  const yearlyExpense = monthlyExpense * 12;
  
  // å®é™…æ”¶ç›Šç‡ = åä¹‰æ”¶ç›Šç‡ - é€šèƒ€ç‡
  const realReturn = returnRate - inflation;
  
  // ä½¿ç”¨å¹´é‡‘ç°å€¼å…¬å¼è®¡ç®—æ‰€éœ€æœ¬é‡‘
  // å¦‚æœæ˜¯æ°¸ç»­ï¼ˆ50å¹´ï¼‰ï¼Œä½¿ç”¨æ°¸ç»­å¹´é‡‘å…¬å¼ï¼šæœ¬é‡‘ = å¹´æ”¯å‡º / å®é™…æ”¶ç›Šç‡
  // å¦åˆ™ä½¿ç”¨æ™®é€šå¹´é‡‘ç°å€¼å…¬å¼
  let baseAmount;
  if (years >= 50 || realReturn <= 0) {
    // æ°¸ç»­å¹´é‡‘æˆ–å®é™…æ”¶ç›Šç‡ä¸ºè´Ÿæ—¶ï¼Œä½¿ç”¨ç®€å•å€æ•°
    baseAmount = realReturn > 0 ? yearlyExpense / realReturn : yearlyExpense * years;
  } else {
    // æ™®é€šå¹´é‡‘ç°å€¼å…¬å¼ï¼šPV = PMT Ã— [(1 - (1+r)^-n) / r]
    baseAmount = yearlyExpense * (1 - Math.pow(1 + realReturn, -years)) / realReturn;
  }
  
  // åŠ ä¸Šå®‰å…¨è¾¹é™…
  const totalAmount = baseAmount * safetyMargin;
  
  // æ˜¾ç¤ºç»“æœ
  document.getElementById('results').classList.add('show');
  document.getElementById('totalAmount').innerHTML = (totalAmount / 10000).toFixed(0) + '<span>ä¸‡å…ƒ</span>';
  document.getElementById('monthlyExpense').textContent = monthlyExpense.toLocaleString() + 'å…ƒ';
  document.getElementById('yearlyExpense').textContent = (yearlyExpense / 10000).toFixed(1) + 'ä¸‡';
  document.getElementById('realReturn').textContent = (realReturn * 100).toFixed(1) + '%';
  document.getElementById('safetyAmount').textContent = '+' + ((safetyMargin - 1) * 100).toFixed(0) + '%';
  
  document.getElementById('subText').textContent = 
    `æ¯æœˆè¢«åŠ¨æ”¶å…¥ ${monthlyExpense.toLocaleString()} å…ƒï¼Œè¦†ç›– ${years} å¹´ç”Ÿæ´»å¼€æ”¯`;

  // ç»˜åˆ¶é¥¼å›¾
  drawPieChart({
    'ä½æˆ¿': housing,
    'é¤é¥®': food,
    'äº¤é€š': transport,
    'é€šè®¯': telecom,
    'åŒ»ç–—': medical,
    'èµ¡å…»': family,
    'å¨±ä¹': entertainment,
    'å…¶ä»–': misc
  });
  
  // æ˜¾ç¤ºè´¢å¯Œè‡ªç”±ç­‰çº§
  showLevels(totalAmount, monthlyExpense);
  
  // æ˜¾ç¤ºå»ºè®®
  showTips(totalAmount, monthlyExpense, realReturn, safetyMargin);
  
  // æ˜¾ç¤ºå…¬å¼è¯´æ˜
  showFormula(yearlyExpense, realReturn, safetyMargin, years, baseAmount, totalAmount);
  
  // æ»šåŠ¨åˆ°ç»“æœ
  document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function drawPieChart(data) {
  const ctx = document.getElementById('pieChart').getContext('2d');
  
  if (pieChart) pieChart.destroy();
  
  const labels = Object.keys(data).filter(k => data[k] > 0);
  const values = labels.map(k => data[k]);
  const colors = ['#f472b6', '#fb923c', '#facc15', '#4ade80', '#22d3ee', '#a78bfa', '#f87171', '#94a3b8'];
  
  pieChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels,
      datasets: [{
        data: values,
        backgroundColor: colors.slice(0, labels.length),
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'right',
          labels: { color: 'rgba(255,255,255,0.7)', padding: 15, font: { size: 12 } }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = (context.raw / total * 100).toFixed(1);
              return `${context.label}: ${context.raw}å…ƒ (${percentage}%)`;
            }
          }
        }
      }
    }
  });
}

function showLevels(currentAmount, monthlyExpense) {
  const levels = [
    { name: 'ç”Ÿå­˜è‡ªç”±', emoji: 'ğŸ¥£', multiplier: 0.5, desc: 'åŸºæœ¬æ¸©é¥±' },
    { name: 'åˆçº§è‡ªç”±', emoji: 'ğŸ ', multiplier: 1.0, desc: 'å½“å‰æ°´å¹³' },
    { name: 'èˆ’é€‚è‡ªç”±', emoji: 'âœˆï¸', multiplier: 2.0, desc: 'å¶å°”æ—…æ¸¸' },
    { name: 'å“è´¨è‡ªç”±', emoji: 'ğŸš—', multiplier: 3.0, desc: 'æœ‰è½¦æœ‰æˆ¿' },
    { name: 'è±ªåè‡ªç”±', emoji: 'ğŸï¸', multiplier: 5.0, desc: 'æƒ³ä¹°å°±ä¹°' },
    { name: 'ç»ˆæè‡ªç”±', emoji: 'ğŸš€', multiplier: 10.0, desc: 'è´¢åŠ¡æ— å¿§' }
  ];
  
  let html = '';
  levels.forEach(level => {
    const amount = currentAmount * level.multiplier;
    const isCurrent = level.multiplier === 1.0;
    html += `
      <div class="level-item ${isCurrent ? 'current' : ''}">
        <div class="rank">${level.emoji}</div>
        <div class="name">${level.name} <span style="color:rgba(255,255,255,0.4);font-size:12px">${level.desc}</span></div>
        <div class="amount">${(amount / 10000).toFixed(0)}ä¸‡</div>
      </div>
    `;
  });
  
  document.getElementById('levelList').innerHTML = html;
}

function showTips(totalAmount, monthlyExpense, realReturn, safetyMargin) {
  const tips = [];
  
  // æ ¹æ®é‡‘é¢ç»™å‡ºå»ºè®®
  if (totalAmount < 1000000) {
    tips.push('ä½ çš„ç›®æ ‡é‡‘é¢ç›¸å¯¹è¾ƒä½ï¼Œé€šè¿‡ç¨³å®šå·¥ä½œ+åˆç†å‚¨è“„ï¼Œ5-10å¹´å†…æœ‰æœ›å®ç°');
  } else if (totalAmount < 3000000) {
    tips.push('300ä¸‡ä»¥å†…çš„ç›®æ ‡ï¼Œå»ºè®®é€šè¿‡"ä¸»ä¸šæ”¶å…¥+å‰¯ä¸š+æŠ•èµ„"ä¸‰ç®¡é½ä¸‹');
  } else {
    tips.push('ç›®æ ‡é‡‘é¢è¾ƒé«˜ï¼Œé™¤äº†å‚¨è“„æŠ•èµ„ï¼Œå¯ä»¥è€ƒè™‘åˆ›ä¸šæˆ–å‘å±•é«˜æ”¶å…¥æŠ€èƒ½');
  }
  
  // æ ¹æ®æ”¶ç›Šç‡ç»™å‡ºå»ºè®®
  if (realReturn <= 0.01) {
    tips.push('å®é™…æ”¶ç›Šç‡è¾ƒä½ï¼Œå»ºè®®å­¦ä¹ åŸºç¡€æŠ•èµ„çŸ¥è¯†ï¼Œé€‚å½“é…ç½®æƒç›Šç±»èµ„äº§');
  } else if (realReturn >= 0.03) {
    tips.push('é¢„æœŸæ”¶ç›Šç‡è¾ƒé«˜ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„æŠ•èµ„ç»éªŒå’Œé£é™©æ‰¿å—èƒ½åŠ›');
  }
  
  // æ ¹æ®å®‰å…¨è¾¹é™…ç»™å‡ºå»ºè®®
  if (safetyMargin < 1.2) {
    tips.push('å»ºè®®å¢åŠ å®‰å…¨è¾¹é™…ï¼Œåº”å¯¹æ„å¤–æ”¯å‡ºå’Œå¸‚åœºæ³¢åŠ¨');
  }
  
  // é€šç”¨å»ºè®®
  tips.push('è´¢å¯Œè‡ªç”±ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯æ–°ç”Ÿæ´»çš„èµ·ç‚¹ã€‚å»ºè®®æå‰è§„åˆ’é€€ä¼‘åçš„ç”Ÿæ´»æ–¹å¼');
  tips.push('å®šæœŸå¤ç›˜è°ƒæ•´è®¡åˆ’ï¼Œæ¯å¹´é‡æ–°è¯„ä¼°ä¸€æ¬¡ç›®æ ‡é‡‘é¢');
  
  document.getElementById('tipsList').innerHTML = tips.map(t => `<li>${t}</li>`).join('');
}

function showFormula(yearlyExpense, realReturn, safetyMargin, years, baseAmount, totalAmount) {
  const html = `
    <strong>æ ¸å¿ƒå…¬å¼ï¼š</strong><br><br>
    
    <code>å®é™…æ”¶ç›Šç‡ = åä¹‰æ”¶ç›Šç‡ - é€šèƒ€ç‡ = ${(realReturn * 100 + 3).toFixed(1)}% - 3% = ${(realReturn * 100).toFixed(1)}%</code><br><br>
    
    <code>åŸºç¡€æœ¬é‡‘ = å¹´æ”¯å‡º Ã— å¹´é‡‘ç°å€¼ç³»æ•°</code><br>
    <code>= ${(yearlyExpense/10000).toFixed(1)}ä¸‡ Ã— ${(baseAmount/yearlyExpense).toFixed(1)} = ${(baseAmount/10000).toFixed(0)}ä¸‡</code><br><br>
    
    <code>æœ€ç»ˆé‡‘é¢ = åŸºç¡€æœ¬é‡‘ Ã— å®‰å…¨è¾¹é™…</code><br>
    <code>= ${(baseAmount/10000).toFixed(0)}ä¸‡ Ã— ${safetyMargin} = ${(totalAmount/10000).toFixed(0)}ä¸‡</code><br><br>
    
    <strong>è¯´æ˜ï¼š</strong><br>
    â€¢ å¹´é‡‘ç°å€¼ç³»æ•°è€ƒè™‘äº†${years}å¹´çš„æ—¶é—´è·¨åº¦å’Œå¤åˆ©æ•ˆåº”<br>
    â€¢ å®‰å…¨è¾¹é™…ç”¨äºåº”å¯¹æ„å¤–æ”¯å‡ºã€å¸‚åœºæ³¢åŠ¨ã€é€šèƒ€è¶…é¢„æœŸç­‰é£é™©<br>
    â€¢ è¿™æ˜¯"æœ€åˆçº§"è´¢å¯Œè‡ªç”±ï¼Œä»…è¦†ç›–åŸºæœ¬ç”Ÿæ´»ï¼Œä¸å«å¤§é¢æ¶ˆè´¹å’Œå“è´¨å‡çº§<br>
    â€¢ å®é™…æ‰§è¡Œä¸­å»ºè®®æ¯å¹´æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
  `;
  
  document.getElementById('formulaText').innerHTML = html;
}

// è¾“å…¥å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
document.querySelectorAll('input, select').forEach(el => {
  el.addEventListener('change', () => {
    if (document.getElementById('results').classList.contains('show')) {
      calculate();
    }
  });
});
</script>

</body>
</html>
