<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSHæ”»å‡»IPç»Ÿè®¡ - è°åœ¨æ‰«ä½ çš„æœåŠ¡å™¨ï¼Ÿ</title>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
      min-height: 100vh;
      color: #e4e4e4;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    .header { text-align: center; margin: 20px 0 30px; }
    .header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ff4444, #ff8800, #ff4444);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .header p { color: rgba(255,255,255,0.5); margin-top: 10px; font-size: 14px; }

    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .stat-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      transition: all 0.3s;
    }
    .stat-card:hover {
      border-color: rgba(255,68,68,0.3);
      transform: translateY(-2px);
    }
    .stat-card .value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #ff4444;
      font-family: 'Monaco', 'Consolas', monospace;
    }
    .stat-card .label {
      color: rgba(255,255,255,0.5);
      font-size: 13px;
      margin-top: 8px;
    }
    .stat-card.highlight { 
      border-color: rgba(255,136,0,0.3);
      background: rgba(255,136,0,0.05);
    }
    .stat-card.highlight .value { color: #ff8800; }

    /* æ—¶é—´åˆ†å¸ƒå›¾ */
    .chart-section {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 25px;
    }
    .chart-title {
      color: #ff8800;
      font-size: 15px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .time-chart {
      display: flex;
      align-items: flex-end;
      height: 150px;
      gap: 2px;
      padding: 0 10px;
    }
    .time-bar {
      flex: 1;
      background: linear-gradient(180deg, #ff4444, #ff8800);
      border-radius: 2px 2px 0 0;
      min-height: 2px;
      transition: height 0.5s ease;
      position: relative;
    }
    .time-bar:hover {
      opacity: 0.8;
    }
    .time-bar:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 11px;
      white-space: nowrap;
      z-index: 10;
    }
    .time-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 11px;
      color: rgba(255,255,255,0.4);
    }

    /* IPåˆ—è¡¨ */
    .list-section {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 25px;
    }
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .list-title {
      color: #ff8800;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .search-box {
      display: flex;
      gap: 10px;
    }
    .search-box input {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 8px 15px;
      color: white;
      font-size: 13px;
      width: 200px;
    }
    .search-box input::placeholder { color: rgba(255,255,255,0.3); }
    .search-box input:focus {
      outline: none;
      border-color: rgba(255,68,68,0.5);
    }

    .ip-table {
      width: 100%;
      border-collapse: collapse;
    }
    .ip-table th {
      text-align: left;
      padding: 12px 15px;
      background: rgba(0,0,0,0.2);
      color: rgba(255,255,255,0.6);
      font-size: 12px;
      font-weight: 500;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .ip-table td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      font-size: 13px;
    }
    .ip-table tr:hover td {
      background: rgba(255,68,68,0.05);
    }
    .ip-table .ip {
      font-family: 'Monaco', 'Consolas', monospace;
      color: #ff4444;
    }
    .ip-table .count {
      color: #ff8800;
      font-weight: 600;
    }
    .ip-table .time {
      color: rgba(255,255,255,0.4);
    }
    
    .table-container {
      max-height: 500px;
      overflow-y: auto;
    }
    .table-container::-webkit-scrollbar {
      width: 6px;
    }
    .table-container::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
    }
    .table-container::-webkit-scrollbar-thumb {
      background: rgba(255,68,68,0.3);
      border-radius: 3px;
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }
    .pagination button {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    .pagination button:hover:not(:disabled) {
      background: rgba(255,68,68,0.2);
      border-color: rgba(255,68,68,0.3);
    }
    .pagination button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    .pagination .page-info {
      color: rgba(255,255,255,0.5);
      font-size: 13px;
    }

    /* è§£é‡ŠåŒºåŸŸ */
    .explanation {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 25px;
      line-height: 1.8;
    }
    .explanation h3 {
      color: #ff8800;
      font-size: 16px;
      margin-bottom: 15px;
    }
    .explanation p {
      color: rgba(255,255,255,0.7);
      margin-bottom: 12px;
      font-size: 14px;
    }
    .explanation ul {
      color: rgba(255,255,255,0.7);
      margin: 10px 0 10px 20px;
      font-size: 14px;
    }
    .explanation li { margin-bottom: 8px; }
    .key-point {
      background: rgba(255,68,68,0.1);
      border-left: 3px solid #ff4444;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 10px 10px 0;
    }
    .key-point strong { color: #ff4444; }
    .code-block {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 13px;
      color: #4ade80;
      margin: 10px 0;
      overflow-x: auto;
    }

    .loading {
      text-align: center;
      padding: 50px;
      color: rgba(255,255,255,0.5);
    }
    .loading .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,68,68,0.2);
      border-top-color: #ff4444;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 600px) {
      .header h1 { font-size: 1.4rem; }
      .stat-card .value { font-size: 1.8rem; }
      .search-box { display: none; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ”’ SSHæ”»å‡»IPç»Ÿè®¡</h1>
    <p>å®æ—¶å±•ç¤ºå°è¯•æš´åŠ›ç ´è§£æœåŠ¡å™¨çš„IPåœ°å€</p>
  </div>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <div class="stats-row">
    <div class="stat-card highlight">
      <div class="value" id="totalIPs">-</div>
      <div class="label">æ”»å‡»IPæ€»æ•°</div>
    </div>
    <div class="stat-card">
      <div class="value" id="totalAttempts">-</div>
      <div class="label">æ€»å°è¯•æ¬¡æ•°</div>
    </div>
    <div class="stat-card">
      <div class="value" id="avgAttempts">-</div>
      <div class="label">å¹³å‡å°è¯•æ¬¡æ•°/IP</div>
    </div>
    <div class="stat-card">
      <div class="value" id="todayCount">-</div>
      <div class="label">ä»Šæ—¥æ–°å¢IP</div>
    </div>
  </div>

  <!-- æ—¶é—´åˆ†å¸ƒå›¾ -->
  <div class="chart-section">
    <div class="chart-title">ğŸ“ˆ æœ€è¿‘30å¤©æ”»å‡»è¶‹åŠ¿</div>
    <div class="time-chart" id="timeChart"></div>
    <div class="time-labels">
      <span id="chartStart">-</span>
      <span id="chartEnd">ä»Šå¤©</span>
    </div>
  </div>

  <!-- IPåˆ—è¡¨ -->
  <div class="list-section">
    <div class="list-header">
      <div class="list-title">ğŸ”¥ æ”»å‡»IPåˆ—è¡¨ï¼ˆæŒ‰å°è¯•æ¬¡æ•°æ’åºï¼‰</div>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="æœç´¢IPåœ°å€...">
      </div>
    </div>
    <div class="table-container">
      <table class="ip-table">
        <thead>
          <tr>
            <th>IPåœ°å€</th>
            <th>å°è¯•æ¬¡æ•°</th>
            <th>é¦–æ¬¡å‘ç°</th>
            <th>æœ€åæ´»åŠ¨</th>
          </tr>
        </thead>
        <tbody id="ipTableBody">
          <tr>
            <td colspan="4">
              <div class="loading">
                <div class="spinner"></div>
                <div>åŠ è½½ä¸­...</div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="pagination">
      <button id="prevBtn" disabled>ä¸Šä¸€é¡µ</button>
      <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ</span>
      <button id="nextBtn">ä¸‹ä¸€é¡µ</button>
    </div>
  </div>

  <!-- è§£é‡Š -->
  <div class="explanation">
    <h3>ğŸ¤” ä¸ºä»€ä¹ˆä½ çš„æœåŠ¡å™¨æ€»è¢«æ‰«æï¼Ÿ</h3>
    
    <p>ç®€å•æ¥è¯´ï¼š<strong>å› ä¸ºä½ çš„IPæ˜¯å…¬å¼€çš„ï¼Œè€Œäº’è”ç½‘ä¸Šæœ‰æ— æ•°è‡ªåŠ¨åŒ–æ‰«æç¨‹åºåœ¨24å°æ—¶ä¸é—´æ–­åœ°æ‰«ææ•´ä¸ªIPv4åœ°å€ç©ºé—´ã€‚</strong></p>
    
    <div class="key-point">
      <strong>IPv4åªæœ‰çº¦43äº¿ä¸ªåœ°å€</strong>ï¼Œä»¥ç°ä»£ç½‘ç»œé€Ÿåº¦ï¼Œä¸€å°æœºå™¨å‡ å°æ—¶å°±èƒ½æ‰«å®Œæ•´ä¸ªäº’è”ç½‘çš„22ç«¯å£ã€‚æ‰€ä»¥ä¸æ˜¯"ä¸ºä»€ä¹ˆæ‰«ä½ "ï¼Œè€Œæ˜¯"æ‰€æœ‰äººéƒ½åœ¨è¢«æ‰«"ã€‚
    </div>

    <p>è¿™äº›æ‰«ææ¥è‡ªï¼š</p>
    <ul>
      <li><strong>åƒµå°¸ç½‘ç»œï¼ˆBotnetï¼‰</strong>ï¼šè¢«é»‘å®¢æ§åˆ¶çš„å¤§é‡è®¡ç®—æœºï¼Œè‡ªåŠ¨æ‰«æå¯»æ‰¾æ–°çš„å—å®³è€…</li>
      <li><strong>è‡ªåŠ¨åŒ–æ”»å‡»è„šæœ¬</strong>ï¼šä½¿ç”¨å¸¸è§å¼±å¯†ç å­—å…¸å°è¯•ç™»å½•</li>
      <li><strong>å®‰å…¨ç ”ç©¶æœºæ„</strong>ï¼šå¦‚Shodanã€Censysç­‰åœ¨åšäº’è”ç½‘æ™®æŸ¥</li>
      <li><strong>é»‘äº§å›¢ä¼™</strong>ï¼šå¯»æ‰¾å¯ä»¥ç”¨æ¥æŒ–çŸ¿ã€å‘åƒåœ¾é‚®ä»¶ã€åšè·³æ¿çš„æœåŠ¡å™¨</li>
    </ul>

    <h3>ğŸ›¡ï¸ å¦‚ä½•ä¿æŠ¤ä½ çš„æœåŠ¡å™¨ï¼Ÿ</h3>
    
    <p><strong>1. ç¦ç”¨å¯†ç ç™»å½•ï¼Œåªç”¨SSHå¯†é’¥</strong></p>
    <div class="code-block"># /etc/ssh/sshd_config
PasswordAuthentication no
PubkeyAuthentication yes</div>

    <p><strong>2. ä¿®æ”¹é»˜è®¤ç«¯å£</strong></p>
    <div class="code-block">Port 22222  # æ”¹æˆå…¶ä»–ç«¯å£</div>
    <p style="color: rgba(255,255,255,0.5); font-size: 13px;">æ²»æ ‡ä¸æ²»æœ¬ï¼Œä½†èƒ½å‡å°‘90%çš„æ‰«ææ—¥å¿—ã€‚</p>

    <p><strong>3. å®‰è£…fail2ban</strong></p>
    <div class="code-block">apt install fail2ban</div>
    <p style="color: rgba(255,255,255,0.5); font-size: 13px;">è‡ªåŠ¨å°ç¦å¤šæ¬¡å°è¯•å¤±è´¥çš„IPã€‚</p>

    <p><strong>4. ä½¿ç”¨é˜²ç«å¢™ç™½åå•</strong></p>
    <p>åªå…è®¸ç‰¹å®šIPè®¿é—®SSHç«¯å£ã€‚</p>
  </div>
</div>

<script>
let allData = [];
let filteredData = [];
let currentPage = 1;
const pageSize = 50;

// åŠ è½½æ•°æ®
async function loadData() {
  try {
    // ä½¿ç”¨åç«¯ä»£ç†æ¥å£ï¼ˆå¸¦ç¼“å­˜å’Œé¢„å¤„ç†ï¼‰
    const response = await fetch('https://demo-api-mockserver.runnable.run/blockip/stats');
    const data = await response.json();
    
    // ç›´æ¥ä½¿ç”¨åç«¯é¢„å¤„ç†å¥½çš„æ•°æ®
    updateStatsFromServer(data.stats);
    updateChartFromServer(data.daily);
    renderTableFromServer(data.list);
    
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
    document.getElementById('ipTableBody').innerHTML = 
      '<tr><td colspan="4" style="text-align:center;color:#ff4444;padding:30px;">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</td></tr>';
  }
}

// ä½¿ç”¨åç«¯é¢„å¤„ç†çš„ç»Ÿè®¡æ•°æ®
function updateStatsFromServer(stats) {
  document.getElementById('totalIPs').textContent = stats.totalIPs.toLocaleString();
  document.getElementById('totalAttempts').textContent = stats.totalAttempts.toLocaleString();
  document.getElementById('avgAttempts').textContent = stats.avgAttempts;
  document.getElementById('todayCount').textContent = stats.todayCount;
}

// ä½¿ç”¨åç«¯é¢„å¤„ç†çš„æ¯æ—¥ç»Ÿè®¡
function updateChartFromServer(daily) {
  const chart = document.getElementById('timeChart');
  const maxCount = Math.max(...daily.map(d => d.count), 1);
  
  chart.innerHTML = daily.map(item => {
    const height = (item.count / maxCount) * 140;
    const shortDate = item.date.slice(5);
    return `<div class="time-bar" style="height: ${Math.max(height, 2)}px" data-tooltip="${shortDate}: ${item.count}ä¸ªIP"></div>`;
  }).join('');
  
  if (daily.length > 0) {
    document.getElementById('chartStart').textContent = daily[0].date.slice(5);
  }
}

// ä½¿ç”¨åç«¯é¢„å¤„ç†çš„åˆ—è¡¨æ•°æ®
let serverList = [];

function renderTableFromServer(list) {
  serverList = list;
  filteredData = [...list];
  renderTable();
}

// æ›´æ–°ç»Ÿè®¡ï¼ˆä¿ç•™åŸæœ‰é€»è¾‘ç”¨äºæœç´¢è¿‡æ»¤ï¼‰
function updateStats() {
  // ç»Ÿè®¡å·²ç”±åç«¯å¤„ç†ï¼Œè¿™é‡Œä¸éœ€è¦é‡æ–°è®¡ç®—
}

// æ›´æ–°æ—¶é—´åˆ†å¸ƒå›¾
function updateChart() {
  // å›¾è¡¨å·²ç”±åç«¯å¤„ç†
}

// æ¸²æŸ“è¡¨æ ¼
function renderTable() {
  const start = (currentPage - 1) * pageSize;
  const end = start + pageSize;
  const pageData = filteredData.slice(start, end);
  
  const tbody = document.getElementById('ipTableBody');
  
  if (pageData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:rgba(255,255,255,0.4);padding:30px;">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„IP</td></tr>';
    return;
  }
  
  // ä½¿ç”¨åç«¯é¢„å¤„ç†çš„å­—æ®µå
  tbody.innerHTML = pageData.map(item => `
    <tr>
      <td class="ip">${item.ip}</td>
      <td class="count">${item.count}</td>
      <td class="time">${item.first}</td>
      <td class="time">${item.last}</td>
    </tr>
  `).join('');
  
  // æ›´æ–°åˆ†é¡µ
  const totalPages = Math.ceil(filteredData.length / pageSize);
  document.getElementById('pageInfo').textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`;
  document.getElementById('prevBtn').disabled = currentPage === 1;
  document.getElementById('nextBtn').disabled = currentPage >= totalPages;
}

// æ ¼å¼åŒ–æ—¥æœŸï¼ˆä¿ç•™ç”¨äºå…¼å®¹ï¼‰
function formatDate(isoString) {
  if (!isoString) return '-';
  return isoString;
}

// æœç´¢
document.getElementById('searchInput').addEventListener('input', (e) => {
  const query = e.target.value.trim();
  if (query) {
    filteredData = serverList.filter(item => item.ip.includes(query));
  } else {
    filteredData = [...serverList];
  }
  currentPage = 1;
  renderTable();
});

// åˆ†é¡µ
document.getElementById('prevBtn').addEventListener('click', () => {
  if (currentPage > 1) {
    currentPage--;
    renderTable();
  }
});

document.getElementById('nextBtn').addEventListener('click', () => {
  const totalPages = Math.ceil(filteredData.length / pageSize);
  if (currentPage < totalPages) {
    currentPage++;
    renderTable();
  }
});

// åˆå§‹åŒ–
loadData();
</script>

</body>
</html>
