<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‡¯åˆ©å…¬å¼ï¼š51%èƒœç‡ä¸‹å¤šå°‘æœ€ä¼˜ï¼Ÿ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    
    .header { text-align: center; margin: 20px 0 30px; }
    .header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(90deg, #4ade80, #feca57, #4ade80);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .header p { color: rgba(255,255,255,0.6); margin-top: 10px; font-size: 14px; }

    .card {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 20px;
    }

    .question-box {
      background: linear-gradient(135deg, rgba(74,222,128,0.1), rgba(254,202,87,0.05));
      border-left: 4px solid #4ade80;
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin-bottom: 20px;
      line-height: 1.9;
    }
    .question-box strong { color: #feca57; }

    /* æ ¸å¿ƒç­”æ¡ˆ */
    .answer-box {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, rgba(74,222,128,0.15), rgba(254,202,87,0.1));
      border: 2px solid #4ade80;
      border-radius: 16px;
      margin: 20px 0;
    }
    .big-answer {
      font-size: 4rem;
      font-weight: 800;
      color: #4ade80;
      line-height: 1;
      text-shadow: 0 0 40px rgba(74,222,128,0.3);
    }
    .answer-desc {
      font-size: 1.1rem;
      color: rgba(255,255,255,0.8);
      margin-top: 15px;
    }

    /* è®¾ç½®é¢æ¿ */
    .setup-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    @media (max-width: 600px) {
      .setup-grid { grid-template-columns: 1fr; }
    }
    .setup-item {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    .setup-item label {
      display: block;
      color: rgba(255,255,255,0.5);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .setup-item input, .setup-item select {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px;
      color: white;
      font-size: 16px;
      text-align: center;
    }
    .setup-item input:focus { outline: none; border-color: #4ade80; }

    /* æŒ‰é’® */
    .controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .btn {
      padding: 12px 25px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      color: #1a1a2e;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn-gold {
      background: linear-gradient(135deg, #feca57, #f0b429);
      color: #1a1a2e;
    }
    .btn:hover:not(:disabled) { transform: translateY(-2px); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* ç»Ÿè®¡é¢æ¿ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin: 20px 0;
    }
    @media (max-width: 600px) {
      .stats-row { grid-template-columns: repeat(2, 1fr); }
    }
    .stat-box {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }
    .stat-value.green { color: #4ade80; }
    .stat-value.red { color: #ff6b6b; }
    .stat-value.gold { color: #feca57; }
    .stat-label {
      color: rgba(255,255,255,0.5);
      font-size: 11px;
      margin-top: 5px;
    }

    /* å›¾è¡¨ */
    .chart-container {
      position: relative;
      height: 300px;
      margin: 20px 0;
    }

    /* ç­–ç•¥å¯¹æ¯” */
    .strategy-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    @media (max-width: 700px) {
      .strategy-grid { grid-template-columns: 1fr; }
    }
    .strategy-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.3s;
      cursor: pointer;
    }
    .strategy-card:hover { border-color: rgba(255,255,255,0.2); }
    .strategy-card.active { border-color: #4ade80; background: rgba(74,222,128,0.1); }
    .strategy-card.optimal { border-color: #feca57; }
    .strategy-card h4 {
      color: #feca57;
      margin-bottom: 10px;
    }
    .strategy-card .pct {
      font-size: 2rem;
      font-weight: 700;
      color: white;
    }
    .strategy-card .desc {
      font-size: 12px;
      color: rgba(255,255,255,0.5);
      margin-top: 8px;
    }

    /* å…¬å¼å±•ç¤º */
    .formula-box {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .formula {
      font-family: 'Times New Roman', serif;
      font-size: 1.4rem;
      color: #feca57;
      margin: 15px 0;
    }
    .formula-desc {
      color: rgba(255,255,255,0.6);
      font-size: 13px;
      line-height: 1.8;
    }

    /* åˆ†æåŒº */
    .analysis {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 22px;
      margin-top: 20px;
    }
    .analysis h3 {
      color: #feca57;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .analysis p {
      color: rgba(255,255,255,0.85);
      line-height: 1.85;
      margin-bottom: 14px;
      font-size: 14px;
    }
    .analysis .highlight { color: #ff6b6b; font-weight: bold; }
    .analysis .safe { color: #4ade80; font-weight: bold; }

    /* ç»“è®º */
    .conclusion {
      background: linear-gradient(135deg, rgba(74,222,128,0.15), rgba(254,202,87,0.1));
      border: 2px solid #feca57;
      border-radius: 16px;
      padding: 25px;
      text-align: center;
    }
    .conclusion h3 {
      color: #4ade80;
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    .conclusion p {
      color: rgba(255,255,255,0.85);
      line-height: 1.8;
      font-size: 14px;
    }
    .conclusion .key-point {
      color: #feca57;
      font-weight: 600;
    }

    /* æ‰¹é‡æ¨¡æ‹Ÿç»“æœ */
    .batch-results {
      margin-top: 20px;
    }
    .result-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    @media (max-width: 500px) {
      .result-grid { grid-template-columns: 1fr; }
    }
    .result-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .result-card h4 {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    .result-card .big-num {
      font-size: 2rem;
      font-weight: bold;
    }
    .result-card .big-num.red { color: #ff6b6b; }
    .result-card .big-num.green { color: #4ade80; }
    .result-card .big-num.gold { color: #feca57; }

    /* å¤åˆ¶æŒ‰é’® */
    .copy-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: rgba(74,222,128,0.9);
      color: #1a1a2e;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(74,222,128,0.3);
      transition: all 0.2s;
    }
    .copy-btn:hover { transform: translateY(-2px); }

    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* å…¨å±€ç»Ÿè®¡é¢æ¿ */
    .global-stats {
      background: linear-gradient(135deg, rgba(74,222,128,0.08), rgba(254,202,87,0.05));
      border: 1px solid rgba(74,222,128,0.2);
      border-radius: 12px;
      padding: 15px 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
    }
    .global-stat {
      text-align: center;
    }
    .global-stat .num {
      font-size: 1.4rem;
      font-weight: 700;
      color: #4ade80;
    }
    .global-stat .label {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
      margin-top: 3px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ¯ å‡¯åˆ©å…¬å¼ï¼š51%èƒœç‡ä¸‹å¤šå°‘æœ€ä¼˜ï¼Ÿ</h1>
    <p>51%æ¦‚ç‡èµ¢ä¸€å€ï¼Œ49%æ¦‚ç‡è¾“å…¨éƒ¨ï¼Œæ¯æ¬¡è¯¥ä¸‹æ³¨å¤šå°‘ï¼Ÿ</p>
  </div>

  <!-- å…¨å±€ç»Ÿè®¡ -->
  <div class="global-stats">
    <div class="global-stat">
      <div class="num" id="globalSims">-</div>
      <div class="label">æ€»æ¨¡æ‹Ÿæ¬¡æ•°</div>
    </div>
    <div class="global-stat">
      <div class="num" id="globalUsers">-</div>
      <div class="label">å‚ä¸ç”¨æˆ·</div>
    </div>
    <div class="global-stat">
      <div class="num" id="globalBatchSims">-</div>
      <div class="label">æ‰¹é‡æ¨¡æ‹Ÿ</div>
    </div>
  </div>

  <!-- é—®é¢˜æè¿° -->
  <div class="card">
    <div class="question-box">
      <strong>é—®é¢˜ï¼š</strong>å‡è®¾æœ‰ä¸€ç§èµŒåšæ¸¸æˆï¼š<br>
      â€¢ æ¯æ¬¡ä¸‹æ³¨ï¼Œ<strong>51%</strong> æ¦‚ç‡èµ¢ï¼Œèµ¢äº†æ‹¿å› <strong>2å€</strong>ï¼ˆæœ¬é‡‘+ç­‰é¢å¥–é‡‘ï¼‰<br>
      â€¢ <strong>49%</strong> æ¦‚ç‡è¾“ï¼Œè¾“äº†å¤±å» <strong>å…¨éƒ¨ä¸‹æ³¨</strong><br>
      â€¢ å¯¹æ‰‹ç­¹ç æ— é™ï¼Œæ°¸ä¸ç ´äº§<br>
      â€¢ ä½ åˆå§‹æœ‰ <strong>10000å…ƒ</strong>ï¼Œä¸èƒ½å†ä¹°ï¼Œä¸èƒ½æ¬ è´¦<br><br>
      é—®ï¼šæ¯æ¬¡ä¸‹æ³¨å¤šå°‘æ¯”ä¾‹ï¼Œæ‰èƒ½è®©èµ„é‡‘å¢é•¿æœ€å¿«ã€åŒæ—¶ä¸å®¹æ˜“ç ´äº§ï¼Ÿ
    </div>

    <!-- æ ¸å¿ƒç­”æ¡ˆ -->
    <div class="answer-box">
      <div class="big-answer">2%</div>
      <div class="answer-desc">å‡¯åˆ©å…¬å¼çš„æœ€ä¼˜è§£ï¼šæ¯æ¬¡ä¸‹æ³¨æ€»èµ„é‡‘çš„ 2%</div>
    </div>
  </div>

  <!-- å‡¯åˆ©å…¬å¼ -->
  <div class="card">
    <h2 style="color: #feca57; margin-bottom: 15px; text-align: center;">ğŸ“ å‡¯åˆ©å…¬å¼</h2>
    
    <div class="formula-box">
      <div class="formula">f* = p - q/b = p - (1-p)/b</div>
      <div class="formula-desc">
        f* = æœ€ä¼˜ä¸‹æ³¨æ¯”ä¾‹<br>
        p = è·èƒœæ¦‚ç‡ = 51% = 0.51<br>
        q = å¤±è´¥æ¦‚ç‡ = 49% = 0.49<br>
        b = èµ”ç‡ï¼ˆèµ¢äº†èµšå¤šå°‘å€ï¼‰= 1ï¼ˆèµ¢1å€ï¼‰
      </div>
    </div>

    <div class="formula-box">
      <div class="formula">f* = 0.51 - 0.49/1 = 0.02 = <span style="color: #4ade80;">2%</span></div>
      <div class="formula-desc">
        ä»£å…¥æ•°å€¼ï¼šæœ€ä¼˜ä¸‹æ³¨æ¯”ä¾‹ = 2%<br>
        å³ï¼šæ¯æ¬¡ä¸‹æ³¨å½“å‰æ€»èµ„é‡‘çš„ 2%
      </div>
    </div>
  </div>

  <!-- ç­–ç•¥å¯¹æ¯”æ¨¡æ‹Ÿ -->
  <div class="card">
    <h2 style="color: #feca57; margin-bottom: 15px; text-align: center;">ğŸ® ç­–ç•¥å¯¹æ¯”æ¨¡æ‹Ÿå™¨</h2>
    <p style="text-align: center; color: rgba(255,255,255,0.6); font-size: 13px; margin-bottom: 20px;">
      é€‰æ‹©ä¸åŒçš„ä¸‹æ³¨æ¯”ä¾‹ï¼Œçœ‹çœ‹é•¿æœŸç»“æœæœ‰ä»€ä¹ˆåŒºåˆ«
    </p>

    <div class="setup-grid">
      <div class="setup-item">
        <label>åˆå§‹èµ„é‡‘</label>
        <input type="number" id="initialMoney" value="10000" min="1000" step="1000">
      </div>
      <div class="setup-item">
        <label>èƒœç‡</label>
        <input type="number" id="winProb" value="51" min="1" max="99" step="1">
        <span style="color: rgba(255,255,255,0.4); font-size: 12px;">%</span>
      </div>
      <div class="setup-item">
        <label>èµ”ç‡ï¼ˆèµ¢äº†èµšå‡ å€ï¼‰</label>
        <input type="number" id="odds" value="1" min="0.1" max="10" step="0.1">
      </div>
    </div>

    <div style="text-align: center; margin: 15px 0;">
      <span style="color: rgba(255,255,255,0.6); font-size: 13px;">
        å½“å‰å‡¯åˆ©æœ€ä¼˜æ¯”ä¾‹ï¼š<span id="kellyOptimal" style="color: #4ade80; font-weight: bold;">2%</span>
      </span>
    </div>

    <div class="strategy-grid">
      <div class="strategy-card" data-pct="1" onclick="selectStrategy(1)">
        <h4>ä¿å®ˆç­–ç•¥</h4>
        <div class="pct">1%</div>
        <div class="desc">ä½äºå‡¯åˆ©å€¼ï¼Œå¢é•¿æ…¢ä½†ç¨³</div>
      </div>
      <div class="strategy-card optimal active" data-pct="2" onclick="selectStrategy(2)">
        <h4>â­ å‡¯åˆ©æœ€ä¼˜</h4>
        <div class="pct">2%</div>
        <div class="desc">æ•°å­¦æœ€ä¼˜ï¼Œé•¿æœŸå¢é•¿æœ€å¿«</div>
      </div>
      <div class="strategy-card" data-pct="5" onclick="selectStrategy(5)">
        <h4>æ¿€è¿›ç­–ç•¥</h4>
        <div class="pct">5%</div>
        <div class="desc">é«˜äºå‡¯åˆ©å€¼ï¼Œæ³¢åŠ¨å¤§</div>
      </div>
    </div>

    <div class="setup-grid" style="grid-template-columns: 1fr;">
      <div class="setup-item">
        <label>è‡ªå®šä¹‰ä¸‹æ³¨æ¯”ä¾‹ (%)</label>
        <input type="range" id="betPct" value="2" min="0.5" max="20" step="0.5" 
               oninput="updateBetPctDisplay()" style="width: 100%;">
        <div style="margin-top: 8px; color: #feca57; font-size: 1.2rem;" id="betPctDisplay">2%</div>
      </div>
    </div>

    <div class="controls">
      <button class="btn btn-primary" onclick="runSingleSim()">â–¶ï¸ æ¨¡æ‹Ÿ1000å±€</button>
      <button class="btn btn-gold" onclick="runComparison()">ğŸ“Š ä¸‰ç­–ç•¥å¯¹æ¯”</button>
      <button class="btn btn-secondary" onclick="resetSim()">ğŸ”„ é‡ç½®</button>
    </div>

    <div class="stats-row">
      <div class="stat-box">
        <div class="stat-value gold" id="roundCount">0</div>
        <div class="stat-label">å·²è¿›è¡Œå±€æ•°</div>
      </div>
      <div class="stat-box">
        <div class="stat-value green" id="currentMoney">Â¥10,000</div>
        <div class="stat-label">å½“å‰èµ„é‡‘</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="winRate" style="color: #4ade80;">-</div>
        <div class="stat-label">å®é™…èƒœç‡</div>
      </div>
      <div class="stat-box">
        <div class="stat-value gold" id="peakMoney">Â¥10,000</div>
        <div class="stat-label">å†å²æœ€é«˜</div>
      </div>
    </div>

    <div class="chart-container">
      <canvas id="moneyChart"></canvas>
    </div>
  </div>

  <!-- æ‰¹é‡æ¨¡æ‹Ÿ -->
  <div class="card">
    <h2 style="color: #feca57; margin-bottom: 15px; text-align: center;">ğŸ§ª è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿï¼š1000ä¸ªç©å®¶çš„å‘½è¿</h2>
    <p style="text-align: center; color: rgba(255,255,255,0.6); font-size: 13px; margin-bottom: 20px;">
      æ¨¡æ‹Ÿ1000ä¸ªäººï¼Œå„ç”¨ä¸åŒç­–ç•¥ç©1000å±€ï¼Œçœ‹çœ‹æœ€ç»ˆç»“æœåˆ†å¸ƒ
    </p>

    <div class="controls">
      <button class="btn btn-primary" onclick="runMassSimulation()">ğŸš€ è¿è¡Œæ‰¹é‡æ¨¡æ‹Ÿ</button>
    </div>

    <div class="batch-results" id="batchResults" style="display: none;">
      <h3 style="color: #feca57; text-align: center; margin-bottom: 15px;">ğŸ“Š 1000äºº Ã— 1000å±€ ç»“æœ</h3>
      
      <div class="result-grid">
        <div class="result-card">
          <h4>ğŸ’€ ç ´äº§äººæ•°ï¼ˆ2%ç­–ç•¥ï¼‰</h4>
          <div class="big-num green" id="kelly2Bankrupt">-</div>
        </div>
        <div class="result-card">
          <h4>ğŸ’€ ç ´äº§äººæ•°ï¼ˆ10%ç­–ç•¥ï¼‰</h4>
          <div class="big-num red" id="kelly10Bankrupt">-</div>
        </div>
        <div class="result-card">
          <h4>ğŸ“ˆ ä¸­ä½æ•°èµ„é‡‘ï¼ˆ2%ç­–ç•¥ï¼‰</h4>
          <div class="big-num green" id="kelly2Median">-</div>
        </div>
        <div class="result-card">
          <h4>ğŸ“ˆ ä¸­ä½æ•°èµ„é‡‘ï¼ˆ10%ç­–ç•¥ï¼‰</h4>
          <div class="big-num gold" id="kelly10Median">-</div>
        </div>
      </div>

      <div class="chart-container" style="height: 250px; margin-top: 20px;">
        <canvas id="distributionChart"></canvas>
      </div>
    </div>
  </div>

  <!-- ä¸ºä»€ä¹ˆæ˜¯2% -->
  <div class="card analysis">
    <h3>ğŸ¤” ä¸ºä»€ä¹ˆæ˜¯2%ï¼Ÿç›´è§‰è§£é‡Š</h3>
    
    <p><strong>1. æœŸæœ›å€¼æ˜¯æ­£çš„ï¼Œä½†æ³¢åŠ¨å¾ˆå¤§</strong></p>
    <p>
      51%èƒœç‡ã€1å€èµ”ç‡ï¼ŒæœŸæœ›å€¼ = 0.51 Ã— 1 - 0.49 Ã— 1 = <span class="safe">+2%</span><br>
      æ¯å±€å¹³å‡èƒ½èµš2%ï¼Œå¬èµ·æ¥ä¸é”™ã€‚ä½†é—®é¢˜æ˜¯ï¼š<span class="highlight">è¾“äº†ä¼šå¤±å»å…¨éƒ¨ä¸‹æ³¨</span>ã€‚
    </p>

    <p><strong>2. ä¸‹æ³¨å¤ªå¤š = ç ´äº§é£é™©</strong></p>
    <p>
      å¦‚æœæ¯æ¬¡ä¸‹æ³¨50%ï¼Œè¿è¾“ä¸¤æ¬¡å°±åªå‰©25%ã€‚è¿è¾“5æ¬¡ï¼ˆæ¦‚ç‡çº¦2.8%ï¼‰å°±åªå‰©3%ã€‚<br>
      <span class="highlight">é«˜ä¸‹æ³¨æ¯”ä¾‹ä¼šè®©ä½ åœ¨è¿æ°”ä¸å¥½æ—¶è¿…é€Ÿç ´äº§</span>ï¼Œå³ä½¿é•¿æœŸæœŸæœ›æ˜¯æ­£çš„ã€‚
    </p>

    <p><strong>3. ä¸‹æ³¨å¤ªå°‘ = å¢é•¿å¤ªæ…¢</strong></p>
    <p>
      å¦‚æœæ¯æ¬¡åªä¸‹æ³¨0.1%ï¼Œè™½ç„¶å‡ ä¹ä¸å¯èƒ½ç ´äº§ï¼Œä½†èµ„é‡‘å¢é•¿æå…¶ç¼“æ…¢ã€‚<br>
      1000å±€åå¯èƒ½åªå¢é•¿äº†20%ï¼Œæµªè´¹äº†æ­£æœŸæœ›å€¼çš„ä¼˜åŠ¿ã€‚
    </p>

    <p><strong>4. å‡¯åˆ©å…¬å¼ = æœ€ä¼˜å¹³è¡¡ç‚¹</strong></p>
    <p>
      å‡¯åˆ©å…¬å¼æ‰¾åˆ°çš„æ˜¯<span class="safe">é•¿æœŸå‡ ä½•å¢é•¿ç‡æœ€å¤§åŒ–</span>çš„ä¸‹æ³¨æ¯”ä¾‹ã€‚<br>
      2%æ—¢èƒ½å……åˆ†åˆ©ç”¨æ­£æœŸæœ›å€¼ï¼Œåˆä¸ä¼šå› ä¸ºçŸ­æœŸæ³¢åŠ¨è€Œç ´äº§ã€‚
    </p>
  </div>

  <!-- å®æˆ˜å»ºè®® -->
  <div class="card analysis">
    <h3>ğŸ’¡ å®æˆ˜å»ºè®®</h3>
    
    <p><strong>1. å®é™…æ“ä½œä¸­ï¼Œç”¨ã€ŒåŠå‡¯åˆ©ã€æ›´å®‰å…¨</strong></p>
    <p>
      å‡¯åˆ©å…¬å¼å‡è®¾ä½ çŸ¥é“ç²¾ç¡®çš„èƒœç‡å’Œèµ”ç‡ã€‚ç°å®ä¸­å¾€å¾€æœ‰è¯¯å·®ã€‚<br>
      å¾ˆå¤šèŒä¸šæŠ•èµ„è€…ä½¿ç”¨<span class="safe">åŠå‡¯åˆ©ï¼ˆ1%ï¼‰</span>ï¼Œç‰ºç‰²ä¸€ç‚¹å¢é•¿é€Ÿåº¦æ¢å–æ›´ä½çš„ç ´äº§é£é™©ã€‚
    </p>

    <p><strong>2. æ°¸è¿œä¸è¦è¶…è¿‡å‡¯åˆ©å€¼</strong></p>
    <p>
      ä¸‹æ³¨æ¯”ä¾‹è¶…è¿‡å‡¯åˆ©å€¼ï¼Œ<span class="highlight">é•¿æœŸæœŸæœ›æ”¶ç›Šåè€Œä¼šä¸‹é™</span>ã€‚<br>
      è¿™æ˜¯åç›´è§‰çš„ï¼šä¸‹æ³¨è¶Šå¤šä¸ä¸€å®šèµšè¶Šå¤šï¼Œè¿‡åº¦ä¸‹æ³¨ä¼šå› ä¸ºæ³¢åŠ¨è€ŒäºæŸã€‚
    </p>

    <p><strong>3. è¿™ä¸ªæ¸¸æˆå€¼å¾—ç©å—ï¼Ÿ</strong></p>
    <p>
      51%èƒœç‡ã€1å€èµ”ç‡ï¼Œå‡¯åˆ©å€¼åªæœ‰2%ã€‚è¿™æ„å‘³ç€<span class="highlight">ä¼˜åŠ¿éå¸¸å¾®å¼±</span>ã€‚<br>
      éœ€è¦å¤§é‡é‡å¤æ‰èƒ½ä½“ç°ä¼˜åŠ¿ï¼ŒçŸ­æœŸå†…è¿æ°”æˆåˆ†å¾ˆå¤§ã€‚<br>
      å¦‚æœæœ‰æ‰‹ç»­è´¹ã€æ—¶é—´æˆæœ¬ï¼Œè¿™ä¸ªæ¸¸æˆå¯èƒ½ä¸å€¼å¾—ç©ã€‚
    </p>
  </div>

  <!-- ç»“è®º -->
  <div class="card conclusion">
    <h3>ğŸ“Œ ç»“è®º</h3>
    <p>
      51%èƒœç‡ã€1å€èµ”ç‡çš„æ¸¸æˆï¼Œ<span class="key-point">æœ€ä¼˜ä¸‹æ³¨æ¯”ä¾‹æ˜¯2%</span>ã€‚<br><br>
      ä¸‹æ³¨å¤ªå¤šä¼šå› ä¸ºæ³¢åŠ¨ç ´äº§ï¼Œä¸‹æ³¨å¤ªå°‘ä¼šæµªè´¹æ­£æœŸæœ›å€¼ã€‚<br>
      å‡¯åˆ©å…¬å¼ç»™å‡ºçš„æ˜¯<span class="key-point">é•¿æœŸè´¢å¯Œå¢é•¿æœ€å¿«</span>çš„æ•°å­¦æœ€ä¼˜è§£ã€‚<br><br>
      ä½†è®°ä½ï¼šè¿™åªæ˜¯æ•°å­¦æ¨¡å‹ã€‚ç°å®ä¸­è¿˜è¦è€ƒè™‘<br>
      èƒœç‡ä¼°è®¡è¯¯å·®ã€å¿ƒç†æ‰¿å—èƒ½åŠ›ã€èµ„é‡‘æµåŠ¨æ€§ç­‰å› ç´ ã€‚<br><br>
      <span style="color: rgba(255,255,255,0.6);">
        ã€ŒçŸ¥é“æœ€ä¼˜è§£ã€å’Œã€Œèƒ½æ‰§è¡Œæœ€ä¼˜è§£ã€æ˜¯ä¸¤å›äº‹ã€‚
      </span>
    </p>
  </div>
</div>

<button class="copy-btn" onclick="copyShareText()">ğŸ“‹ å¤åˆ¶åˆ†äº«</button>
<div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>

<script>
// å…¨å±€å˜é‡
let money = 10000;
let initialMoney = 10000;
let roundCount = 0;
let winCount = 0;
let peakMoney = 10000;
let moneyHistory = [10000];
let chart = null;
let distributionChart = null;
let userTracked = false;

// ç»Ÿè®¡ API
const StatsAPI = {
  baseUrl: '/stats',
  keys: {
    sims: 'kelly-criterion-sims',
    users: 'kelly-criterion-users',
    batchSims: 'kelly-criterion-batch-sims'
  },
  
  async incr(key) {
    try {
      const res = await fetch(`${this.baseUrl}?action=incr&key=${key}`);
      const data = await res.json();
      return data.data || 0;
    } catch (e) {
      console.warn('Stats incr failed:', e);
      return 0;
    }
  },
  
  async get(key) {
    try {
      const res = await fetch(`${this.baseUrl}?action=get&key=${key}`);
      const data = await res.json();
      return data.data || 0;
    } catch (e) {
      console.warn('Stats get failed:', e);
      return 0;
    }
  },
  
  async loadAll() {
    const [sims, users, batchSims] = await Promise.all([
      this.get(this.keys.sims),
      this.get(this.keys.users),
      this.get(this.keys.batchSims)
    ]);
    return { sims, users, batchSims };
  },
  
  async trackUser() {
    if (userTracked) return;
    userTracked = true;
    await this.incr(this.keys.users);
  },
  
  async trackSim() {
    await this.incr(this.keys.sims);
  },
  
  async trackBatchSim() {
    await this.incr(this.keys.batchSims);
  }
};

// æ›´æ–°å…¨å±€ç»Ÿè®¡æ˜¾ç¤º
async function updateGlobalStats() {
  const stats = await StatsAPI.loadAll();
  document.getElementById('globalSims').textContent = stats.sims.toLocaleString();
  document.getElementById('globalUsers').textContent = stats.users.toLocaleString();
  document.getElementById('globalBatchSims').textContent = stats.batchSims.toLocaleString();
}

// è®¡ç®—å‡¯åˆ©æœ€ä¼˜æ¯”ä¾‹
function calcKelly() {
  const p = parseFloat(document.getElementById('winProb').value) / 100;
  const b = parseFloat(document.getElementById('odds').value);
  const kelly = p - (1 - p) / b;
  return Math.max(0, kelly);
}

// æ›´æ–°å‡¯åˆ©æ˜¾ç¤º
function updateKellyDisplay() {
  const kelly = calcKelly();
  document.getElementById('kellyOptimal').textContent = (kelly * 100).toFixed(1) + '%';
  
  // æ›´æ–°ç­–ç•¥å¡ç‰‡
  const cards = document.querySelectorAll('.strategy-card');
  cards.forEach(card => {
    if (card.classList.contains('optimal')) {
      card.querySelector('.pct').textContent = (kelly * 100).toFixed(1) + '%';
      card.dataset.pct = (kelly * 100).toFixed(1);
    }
  });
}

// é€‰æ‹©ç­–ç•¥
function selectStrategy(pct) {
  document.querySelectorAll('.strategy-card').forEach(c => c.classList.remove('active'));
  document.querySelector(`[data-pct="${pct}"]`)?.classList.add('active');
  document.getElementById('betPct').value = pct;
  updateBetPctDisplay();
}

// æ›´æ–°ä¸‹æ³¨æ¯”ä¾‹æ˜¾ç¤º
function updateBetPctDisplay() {
  const pct = document.getElementById('betPct').value;
  document.getElementById('betPctDisplay').textContent = pct + '%';
  
  // æ›´æ–°ç­–ç•¥å¡ç‰‡é€‰ä¸­çŠ¶æ€
  document.querySelectorAll('.strategy-card').forEach(c => {
    c.classList.remove('active');
    if (parseFloat(c.dataset.pct) === parseFloat(pct)) {
      c.classList.add('active');
    }
  });
}

// æ ¼å¼åŒ–é‡‘é¢
function formatMoney(num) {
  if (num >= 1e9) return 'Â¥' + (num / 1e9).toFixed(2) + 'B';
  if (num >= 1e6) return 'Â¥' + (num / 1e6).toFixed(2) + 'M';
  if (num >= 1e3) return 'Â¥' + (num / 1e3).toFixed(1) + 'K';
  return 'Â¥' + num.toFixed(0);
}

// æ›´æ–°æ˜¾ç¤º
function updateDisplay() {
  document.getElementById('roundCount').textContent = roundCount;
  document.getElementById('currentMoney').textContent = formatMoney(money);
  document.getElementById('currentMoney').className = 'stat-value ' + (money >= initialMoney ? 'green' : 'red');
  document.getElementById('winRate').textContent = roundCount > 0 ? (winCount / roundCount * 100).toFixed(1) + '%' : '-';
  document.getElementById('peakMoney').textContent = formatMoney(peakMoney);
}

// åˆå§‹åŒ–å›¾è¡¨
function initChart() {
  const ctx = document.getElementById('moneyChart').getContext('2d');
  if (chart) chart.destroy();
  
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [0],
      datasets: [{
        label: 'èµ„é‡‘',
        data: [initialMoney],
        borderColor: '#4ade80',
        backgroundColor: 'rgba(74, 222, 128, 0.1)',
        fill: true,
        tension: 0.1,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: {
          display: true,
          title: { display: true, text: 'å±€æ•°', color: 'rgba(255,255,255,0.5)' },
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { color: 'rgba(255,255,255,0.4)', maxTicksLimit: 10 }
        },
        y: {
          display: true,
          title: { display: true, text: 'èµ„é‡‘', color: 'rgba(255,255,255,0.5)' },
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { 
            color: 'rgba(255,255,255,0.4)',
            callback: v => formatMoney(v)
          },
          type: 'logarithmic'
        }
      }
    }
  });
}

// æ›´æ–°å›¾è¡¨
function updateChart() {
  if (!chart) return;
  chart.data.labels = moneyHistory.map((_, i) => i);
  chart.data.datasets[0].data = moneyHistory;
  chart.update('none');
}

// å•æ¬¡æ¨¡æ‹Ÿ
async function runSingleSim() {
  const p = parseFloat(document.getElementById('winProb').value) / 100;
  const betPct = parseFloat(document.getElementById('betPct').value) / 100;
  
  // ç»Ÿè®¡
  StatsAPI.trackUser();
  StatsAPI.trackSim();
  
  for (let i = 0; i < 1000; i++) {
    if (money < 1) break; // ç ´äº§
    
    const bet = money * betPct;
    if (Math.random() < p) {
      money += bet;
      winCount++;
    } else {
      money -= bet;
    }
    
    roundCount++;
    if (money > peakMoney) peakMoney = money;
    
    // æ¯10å±€è®°å½•ä¸€æ¬¡
    if (roundCount % 10 === 0) {
      moneyHistory.push(money);
    }
  }
  
  updateDisplay();
  updateChart();
  updateGlobalStats();
}

// ä¸‰ç­–ç•¥å¯¹æ¯”
async function runComparison() {
  const p = parseFloat(document.getElementById('winProb').value) / 100;
  const kelly = calcKelly();
  
  // ç»Ÿè®¡
  StatsAPI.trackUser();
  StatsAPI.trackSim();
  
  const strategies = [
    { name: 'ä¿å®ˆ(1%)', pct: 0.01, color: '#60a5fa', data: [initialMoney] },
    { name: 'å‡¯åˆ©(' + (kelly*100).toFixed(1) + '%)', pct: kelly, color: '#4ade80', data: [initialMoney] },
    { name: 'æ¿€è¿›(10%)', pct: 0.10, color: '#ff6b6b', data: [initialMoney] }
  ];
  
  // ç”Ÿæˆç›¸åŒçš„éšæœºåºåˆ—
  const results = [];
  for (let i = 0; i < 1000; i++) {
    results.push(Math.random() < p);
  }
  
  // å¯¹æ¯ä¸ªç­–ç•¥åº”ç”¨ç›¸åŒçš„ç»“æœ
  strategies.forEach(s => {
    let m = initialMoney;
    for (let i = 0; i < 1000; i++) {
      if (m < 1) {
        s.data.push(0);
        continue;
      }
      const bet = m * s.pct;
      m = results[i] ? m + bet : m - bet;
      if (i % 10 === 9) s.data.push(m);
    }
  });
  
  // æ›´æ–°å›¾è¡¨
  const ctx = document.getElementById('moneyChart').getContext('2d');
  if (chart) chart.destroy();
  
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: strategies[0].data.map((_, i) => i * 10),
      datasets: strategies.map(s => ({
        label: s.name,
        data: s.data,
        borderColor: s.color,
        backgroundColor: 'transparent',
        tension: 0.1,
        pointRadius: 0
      }))
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          labels: { color: 'rgba(255,255,255,0.7)' }
        }
      },
      scales: {
        x: {
          display: true,
          title: { display: true, text: 'å±€æ•°', color: 'rgba(255,255,255,0.5)' },
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { color: 'rgba(255,255,255,0.4)' }
        },
        y: {
          display: true,
          title: { display: true, text: 'èµ„é‡‘', color: 'rgba(255,255,255,0.5)' },
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { 
            color: 'rgba(255,255,255,0.4)',
            callback: v => formatMoney(v)
          },
          type: 'logarithmic'
        }
      }
    }
  });
  
  updateGlobalStats();
}

// æ‰¹é‡æ¨¡æ‹Ÿ
async function runMassSimulation() {
  const p = parseFloat(document.getElementById('winProb').value) / 100;
  const initial = parseFloat(document.getElementById('initialMoney').value);
  
  // ç»Ÿè®¡
  StatsAPI.trackUser();
  StatsAPI.trackBatchSim();
  
  const results2 = [];
  const results10 = [];
  
  // æ¨¡æ‹Ÿ1000ä¸ªç©å®¶
  for (let player = 0; player < 1000; player++) {
    let m2 = initial, m10 = initial;
    
    for (let round = 0; round < 1000; round++) {
      const win = Math.random() < p;
      
      // 2%ç­–ç•¥
      if (m2 >= 1) {
        const bet2 = m2 * 0.02;
        m2 = win ? m2 + bet2 : m2 - bet2;
      }
      
      // 10%ç­–ç•¥
      if (m10 >= 1) {
        const bet10 = m10 * 0.10;
        m10 = win ? m10 + bet10 : m10 - bet10;
      }
    }
    
    results2.push(m2);
    results10.push(m10);
  }
  
  // ç»Ÿè®¡
  const bankrupt2 = results2.filter(m => m < 1).length;
  const bankrupt10 = results10.filter(m => m < 1).length;
  
  results2.sort((a, b) => a - b);
  results10.sort((a, b) => a - b);
  const median2 = results2[500];
  const median10 = results10[500];
  
  // æ˜¾ç¤ºç»“æœ
  document.getElementById('batchResults').style.display = 'block';
  document.getElementById('kelly2Bankrupt').textContent = bankrupt2;
  document.getElementById('kelly10Bankrupt').textContent = bankrupt10;
  document.getElementById('kelly2Median').textContent = formatMoney(median2);
  document.getElementById('kelly10Median').textContent = formatMoney(median10);
  
  // åˆ†å¸ƒå›¾
  drawDistributionChart(results2, results10);
  updateGlobalStats();
}

// åˆ†å¸ƒå›¾
function drawDistributionChart(results2, results10) {
  const ctx = document.getElementById('distributionChart').getContext('2d');
  if (distributionChart) distributionChart.destroy();
  
  // åˆ›å»ºåˆ†å¸ƒæ¡¶
  const buckets2 = new Array(20).fill(0);
  const buckets10 = new Array(20).fill(0);
  
  results2.forEach(m => {
    const idx = Math.min(19, Math.floor(Math.log10(Math.max(1, m)) * 2));
    buckets2[idx]++;
  });
  
  results10.forEach(m => {
    const idx = Math.min(19, Math.floor(Math.log10(Math.max(1, m)) * 2));
    buckets10[idx]++;
  });
  
  const labels = [];
  for (let i = 0; i < 20; i++) {
    labels.push(formatMoney(Math.pow(10, i / 2)));
  }
  
  distributionChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: '2%ç­–ç•¥',
          data: buckets2,
          backgroundColor: 'rgba(74, 222, 128, 0.6)'
        },
        {
          label: '10%ç­–ç•¥',
          data: buckets10,
          backgroundColor: 'rgba(255, 107, 107, 0.6)'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          labels: { color: 'rgba(255,255,255,0.7)' }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { color: 'rgba(255,255,255,0.4)', maxRotation: 45 }
        },
        y: {
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { color: 'rgba(255,255,255,0.4)' }
        }
      }
    }
  });
}

// é‡ç½®
function resetSim() {
  initialMoney = parseFloat(document.getElementById('initialMoney').value) || 10000;
  money = initialMoney;
  roundCount = 0;
  winCount = 0;
  peakMoney = initialMoney;
  moneyHistory = [initialMoney];
  
  updateDisplay();
  initChart();
  updateKellyDisplay();
}

// å¤åˆ¶åˆ†äº«
function copyShareText() {
  const kelly = calcKelly();
  const text = `ã€å‡¯åˆ©å…¬å¼è®¡ç®—å™¨ã€‘
51%èƒœç‡ã€1å€èµ”ç‡çš„æ¸¸æˆï¼Œæœ€ä¼˜ä¸‹æ³¨æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Ÿ

ç­”æ¡ˆï¼š${(kelly * 100).toFixed(1)}%

ä¸‹æ³¨å¤ªå¤šä¼šå› ä¸ºæ³¢åŠ¨ç ´äº§ï¼Œä¸‹æ³¨å¤ªå°‘ä¼šæµªè´¹æ­£æœŸæœ›å€¼ã€‚
å‡¯åˆ©å…¬å¼ç»™å‡ºçš„æ˜¯é•¿æœŸè´¢å¯Œå¢é•¿æœ€å¿«çš„æ•°å­¦æœ€ä¼˜è§£ã€‚

æ¥è¯•è¯•ä¸åŒç­–ç•¥çš„æ¨¡æ‹Ÿæ•ˆæœ ğŸ‘‰ `;
  
  navigator.clipboard.writeText(text + window.location.href).then(() => {
    const toast = document.getElementById('toast');
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2000);
  });
}

// ç›‘å¬å‚æ•°å˜åŒ–
document.getElementById('winProb').addEventListener('change', updateKellyDisplay);
document.getElementById('odds').addEventListener('change', updateKellyDisplay);

// åˆå§‹åŒ–
resetSim();
updateGlobalStats();
</script>

</body>
</html>