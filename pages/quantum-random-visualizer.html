<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‡å­éšæœºæ•°å¯è§†åŒ– - çœŸéšæœº vs ä¼ªéšæœº</title>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 50%, #0a1a2e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 2rem;
      background: linear-gradient(135deg, #00d4ff, #a855f7, #00d4ff);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .subtitle {
      text-align: center;
      color: rgba(255,255,255,0.6);
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .card-title {
      font-size: 1.1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-title .quantum { color: #00d4ff; }
    .card-title .pseudo { color: #f472b6; }
    
    .source-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(0,212,255,0.15);
      border: 1px solid rgba(0,212,255,0.3);
      border-radius: 20px;
      padding: 4px 12px;
      font-size: 0.75rem;
      color: #00d4ff;
    }
    .source-badge.pseudo {
      background: rgba(244,114,182,0.15);
      border-color: rgba(244,114,182,0.3);
      color: #f472b6;
    }
    
    .visualizer-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    @media (max-width: 700px) {
      .visualizer-grid { grid-template-columns: 1fr; }
    }
    
    .canvas-container {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 15px;
      position: relative;
    }
    .canvas-container canvas {
      width: 100%;
      height: 300px;
      border-radius: 8px;
    }
    .canvas-label {
      position: absolute;
      top: 25px;
      left: 25px;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
    }
    
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }
    .btn-primary {
      background: linear-gradient(135deg, #00d4ff, #a855f7);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,212,255,0.4);
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn-secondary:hover { background: rgba(255,255,255,0.2); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
    .stat-box {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    .stat-box.quantum { border-left: 3px solid #00d4ff; }
    .stat-box.pseudo { border-left: 3px solid #f472b6; }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
    }
    .stat-box.quantum .stat-value { color: #00d4ff; }
    .stat-box.pseudo .stat-value { color: #f472b6; }
    .stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.5);
      margin-top: 5px;
    }
    
    .histogram-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    @media (max-width: 700px) {
      .histogram-container { grid-template-columns: 1fr; }
    }
    .histogram {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 15px;
    }
    .histogram-title {
      font-size: 0.9rem;
      margin-bottom: 15px;
      color: rgba(255,255,255,0.7);
    }
    .histogram-bars {
      display: flex;
      align-items: flex-end;
      height: 120px;
      gap: 2px;
    }
    .histogram-bar {
      flex: 1;
      min-width: 8px;
      transition: height 0.3s;
      border-radius: 2px 2px 0 0;
    }
    .histogram-bar.quantum { background: linear-gradient(to top, #00d4ff, #a855f7); }
    .histogram-bar.pseudo { background: linear-gradient(to top, #f472b6, #fb923c); }
    
    .explanation {
      background: rgba(0,212,255,0.05);
      border-left: 3px solid #00d4ff;
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin-top: 20px;
    }
    .explanation h3 {
      color: #00d4ff;
      margin-bottom: 10px;
      font-size: 1rem;
    }
    .explanation p {
      color: rgba(255,255,255,0.7);
      line-height: 1.8;
      font-size: 0.9rem;
    }
    .explanation a {
      color: #00d4ff;
      text-decoration: none;
    }
    .explanation a:hover { text-decoration: underline; }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #00d4ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .number-stream {
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 100px;
      overflow-y: auto;
      word-break: break-all;
      line-height: 1.6;
    }
    .number-stream.quantum { color: #00d4ff; }
    .number-stream.pseudo { color: #f472b6; }
  </style>
</head>
<body>
  <div class="container">
    <h1>âš›ï¸ é‡å­éšæœºæ•°å¯è§†åŒ–</h1>
    <p class="subtitle">çœŸéšæœº vs ä¼ªéšæœº â€”â€” ç”¨çœ¼ç›çœ‹è§éšæœºæ€§çš„æœ¬è´¨</p>
    
    <div class="card">
      <div class="card-title">
        <span>ğŸ¯ éšæœºæ€§å¯¹æ¯”å®éªŒ</span>
      </div>
      
      <div class="controls">
        <button class="btn btn-primary" id="generateBtn" onclick="generateNumbers()">
          âš›ï¸ ç”Ÿæˆéšæœºæ•°
        </button>
        <button class="btn btn-secondary" onclick="clearAll()">ğŸ”„ æ¸…ç©º</button>
        <select id="countSelect" style="padding: 10px 15px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
          <option value="100">100 ä¸ª</option>
          <option value="500" selected>500 ä¸ª</option>
          <option value="1000">1000 ä¸ª</option>
          <option value="2000">2000 ä¸ª</option>
        </select>
      </div>
      
      <div class="visualizer-grid">
        <div class="canvas-container">
          <div class="canvas-label">
            <span class="source-badge">âš›ï¸ é‡å­çœŸéšæœº</span>
          </div>
          <canvas id="quantumCanvas"></canvas>
        </div>
        <div class="canvas-container">
          <div class="canvas-label">
            <span class="source-badge pseudo">ğŸ”¢ Math.random()</span>
          </div>
          <canvas id="pseudoCanvas"></canvas>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-box quantum">
          <div class="stat-value" id="quantumMean">-</div>
          <div class="stat-label">é‡å­å‡å€¼</div>
        </div>
        <div class="stat-box quantum">
          <div class="stat-value" id="quantumStd">-</div>
          <div class="stat-label">é‡å­æ ‡å‡†å·®</div>
        </div>
        <div class="stat-box pseudo">
          <div class="stat-value" id="pseudoMean">-</div>
          <div class="stat-label">ä¼ªéšæœºå‡å€¼</div>
        </div>
        <div class="stat-box pseudo">
          <div class="stat-value" id="pseudoStd">-</div>
          <div class="stat-label">ä¼ªéšæœºæ ‡å‡†å·®</div>
        </div>
      </div>
      
      <div class="histogram-container">
        <div class="histogram">
          <div class="histogram-title">âš›ï¸ é‡å­éšæœºæ•°åˆ†å¸ƒ</div>
          <div class="histogram-bars" id="quantumHistogram"></div>
        </div>
        <div class="histogram">
          <div class="histogram-title">ğŸ”¢ ä¼ªéšæœºæ•°åˆ†å¸ƒ</div>
          <div class="histogram-bars" id="pseudoHistogram"></div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ“Š åŸå§‹æ•°æ®æµ</div>
      <div class="visualizer-grid">
        <div>
          <div style="font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-bottom: 8px;">é‡å­éšæœºæ•°</div>
          <div class="number-stream quantum" id="quantumStream">ç­‰å¾…ç”Ÿæˆ...</div>
        </div>
        <div>
          <div style="font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-bottom: 8px;">ä¼ªéšæœºæ•°</div>
          <div class="number-stream pseudo" id="pseudoStream">ç­‰å¾…ç”Ÿæˆ...</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="explanation">
        <h3>ğŸ”¬ æ•°æ®æ¥æºè¯´æ˜</h3>
        <p>
          æœ¬é¡µé¢çš„é‡å­éšæœºæ•°æ¥è‡ªæ¾³å¤§åˆ©äºšå›½ç«‹å¤§å­¦ï¼ˆANUï¼‰çš„ <a href="https://qrng.anu.edu.au/" target="_blank">é‡å­éšæœºæ•°ç”Ÿæˆå™¨</a>ã€‚
          è¿™äº›éšæœºæ•°æ˜¯é€šè¿‡æµ‹é‡çœŸç©ºçš„é‡å­æ¶¨è½å®æ—¶ç”Ÿæˆçš„ã€‚
        </p>
        <p style="margin-top: 10px;">
          åœ¨é‡å­ç‰©ç†å­¦ä¸­ï¼Œå³ä½¿æ˜¯å®Œå…¨çš„çœŸç©ºä¹Ÿå­˜åœ¨é›¶ç‚¹èƒ½é‡ï¼Œç”µç£åœºåœ¨æ‰€æœ‰é¢‘ç‡ä¸Šéƒ½è¡¨ç°å‡ºç›¸ä½å’ŒæŒ¯å¹…çš„éšæœºæ³¢åŠ¨ã€‚
          é€šè¿‡ç²¾ç¡®æµ‹é‡è¿™äº›æ³¢åŠ¨ï¼Œå¯ä»¥ç”ŸæˆçœŸæ­£ä¸å¯é¢„æµ‹çš„éšæœºæ•°ã€‚
        </p>
        <p style="margin-top: 10px;">
          è€Œ <code>Math.random()</code> ä½¿ç”¨çš„æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼ˆPRNGï¼‰ï¼ŒåŸºäºç¡®å®šæ€§ç®—æ³•ï¼Œç»™å®šç›¸åŒçš„ç§å­ä¼šäº§ç”Ÿç›¸åŒçš„åºåˆ—ã€‚
          è™½ç„¶ç»Ÿè®¡ç‰¹æ€§ç›¸ä¼¼ï¼Œä½†æœ¬è´¨ä¸Šæ˜¯å¯é¢„æµ‹çš„ã€‚
        </p>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://demo-api-mockserver.runnable.run';
    let quantumNumbers = [];
    let pseudoNumbers = [];
    
    async function generateNumbers() {
      const btn = document.getElementById('generateBtn');
      const count = parseInt(document.getElementById('countSelect').value);
      
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>è·å–é‡å­éšæœºæ•°...';
      
      try {
        // è·å–é‡å­éšæœºæ•°
        const response = await fetch(`${API_BASE}/quantum/numbers?count=${count}&min=0&max=255`);
        const data = await response.json();
        
        if (data.status === 200 && data.data) {
          quantumNumbers = data.data;
        } else {
          throw new Error('è·å–é‡å­éšæœºæ•°å¤±è´¥');
        }
        
        // ç”Ÿæˆä¼ªéšæœºæ•°
        pseudoNumbers = Array.from({length: count}, () => Math.floor(Math.random() * 256));
        
        // æ›´æ–°å¯è§†åŒ–
        drawScatterPlot('quantumCanvas', quantumNumbers, '#00d4ff');
        drawScatterPlot('pseudoCanvas', pseudoNumbers, '#f472b6');
        
        // æ›´æ–°ç»Ÿè®¡
        updateStats();
        
        // æ›´æ–°ç›´æ–¹å›¾
        drawHistogram('quantumHistogram', quantumNumbers, 'quantum');
        drawHistogram('pseudoHistogram', pseudoNumbers, 'pseudo');
        
        // æ›´æ–°æ•°æ®æµ
        document.getElementById('quantumStream').textContent = quantumNumbers.join(', ');
        document.getElementById('pseudoStream').textContent = pseudoNumbers.join(', ');
        
      } catch (error) {
        console.error(error);
        alert('è·å–é‡å­éšæœºæ•°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'âš›ï¸ ç”Ÿæˆéšæœºæ•°';
      }
    }
    
    function drawScatterPlot(canvasId, numbers, color) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      const rect = canvas.getBoundingClientRect();
      
      canvas.width = rect.width * 2;
      canvas.height = 300 * 2;
      ctx.scale(2, 2);
      
      const width = rect.width;
      const height = 300;
      
      // æ¸…ç©ºç”»å¸ƒ
      ctx.fillStyle = 'rgba(0,0,0,0.3)';
      ctx.fillRect(0, 0, width, height);
      
      // ç»˜åˆ¶æ•£ç‚¹å›¾ï¼ˆç›¸é‚»ä¸¤ä¸ªæ•°ä½œä¸º x, y åæ ‡ï¼‰
      ctx.fillStyle = color;
      for (let i = 0; i < numbers.length - 1; i += 2) {
        const x = (numbers[i] / 255) * (width - 20) + 10;
        const y = (numbers[i + 1] / 255) * (height - 20) + 10;
        ctx.beginPath();
        ctx.arc(x, y, 2, 0, Math.PI * 2);
        ctx.fill();
      }
    }
    
    function drawHistogram(containerId, numbers, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      // åˆ†æˆ 20 ä¸ªæ¡¶
      const buckets = new Array(20).fill(0);
      numbers.forEach(n => {
        const bucket = Math.min(Math.floor(n / 256 * 20), 19);
        buckets[bucket]++;
      });
      
      const maxCount = Math.max(...buckets);
      
      buckets.forEach(count => {
        const bar = document.createElement('div');
        bar.className = `histogram-bar ${type}`;
        bar.style.height = `${(count / maxCount) * 100}%`;
        container.appendChild(bar);
      });
    }
    
    function updateStats() {
      // è®¡ç®—å‡å€¼
      const qMean = quantumNumbers.reduce((a, b) => a + b, 0) / quantumNumbers.length;
      const pMean = pseudoNumbers.reduce((a, b) => a + b, 0) / pseudoNumbers.length;
      
      // è®¡ç®—æ ‡å‡†å·®
      const qStd = Math.sqrt(quantumNumbers.reduce((sum, n) => sum + Math.pow(n - qMean, 2), 0) / quantumNumbers.length);
      const pStd = Math.sqrt(pseudoNumbers.reduce((sum, n) => sum + Math.pow(n - pMean, 2), 0) / pseudoNumbers.length);
      
      document.getElementById('quantumMean').textContent = qMean.toFixed(2);
      document.getElementById('quantumStd').textContent = qStd.toFixed(2);
      document.getElementById('pseudoMean').textContent = pMean.toFixed(2);
      document.getElementById('pseudoStd').textContent = pStd.toFixed(2);
    }
    
    function clearAll() {
      quantumNumbers = [];
      pseudoNumbers = [];
      
      ['quantumCanvas', 'pseudoCanvas'].forEach(id => {
        const canvas = document.getElementById(id);
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      });
      
      ['quantumHistogram', 'pseudoHistogram'].forEach(id => {
        document.getElementById(id).innerHTML = '';
      });
      
      document.getElementById('quantumMean').textContent = '-';
      document.getElementById('quantumStd').textContent = '-';
      document.getElementById('pseudoMean').textContent = '-';
      document.getElementById('pseudoStd').textContent = '-';
      
      document.getElementById('quantumStream').textContent = 'ç­‰å¾…ç”Ÿæˆ...';
      document.getElementById('pseudoStream').textContent = 'ç­‰å¾…ç”Ÿæˆ...';
    }
  </script>
</body>
</html>
