<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åç›´è§‰æ¦‚ç‡è®º - é‚£äº›è®©äººè§‰å¾—ä¸å¯æ€è®®çš„ç»“è®º</title>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .back-link {
      display: inline-block;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }
    .back-link:hover { text-decoration: underline; }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 2rem;
      background: linear-gradient(135deg, #f093fb, #f5576c, #4facfe);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 3s ease infinite;
    }
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .subtitle {
      text-align: center;
      color: rgba(255,255,255,0.7);
      margin-bottom: 30px;
      font-size: 1rem;
      line-height: 1.6;
    }
    
    /* å¯¼èˆªæ ‡ç­¾ */
    .nav-tabs {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 25px;
    }
    .nav-tab {
      padding: 10px 20px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 25px;
      color: rgba(255,255,255,0.8);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
    }
    .nav-tab:hover, .nav-tab.active {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      border-color: transparent;
      color: white;
      transform: translateY(-2px);
    }
    
    /* å¡ç‰‡ */
    .card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 25px;
      border: 1px solid rgba(255,255,255,0.1);
      display: none;
    }
    .card.active { display: block; }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .card-icon {
      font-size: 2.5rem;
    }
    .card-title {
      font-size: 1.5rem;
      background: linear-gradient(135deg, #f5af19, #f12711);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .card-subtitle {
      color: rgba(255,255,255,0.6);
      font-size: 0.9rem;
      margin-top: 5px;
    }
    
    .question-box {
      background: linear-gradient(135deg, rgba(245,175,25,0.15), rgba(241,39,17,0.1));
      border-left: 4px solid #f5af19;
      padding: 20px;
      border-radius: 0 15px 15px 0;
      margin-bottom: 25px;
      line-height: 1.8;
    }
    .question-box strong { color: #f5af19; }
    
    /* äº¤äº’åŒºåŸŸ */
    .interactive-area {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
    }
    
    /* æŒ‰é’® */
    .btn {
      padding: 12px 28px;
      border: none;
      border-radius: 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    .btn-primary {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: white;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(240,147,251,0.3);
    }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .btn-group {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    
    /* ç»Ÿè®¡æ˜¾ç¤º */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-box {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 18px;
      text-align: center;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #f5af19;
    }
    .stat-value.green { color: #4ade80; }
    .stat-value.red { color: #f87171; }
    .stat-value.blue { color: #60a5fa; }
    .stat-label {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
      margin-top: 5px;
    }
    
    /* è¿›åº¦æ¡ */
    .progress-container {
      margin: 20px 0;
    }
    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    .progress-bar {
      height: 25px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      border-radius: 12px;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .progress-fill.green { background: linear-gradient(90deg, #4ade80, #22d3ee); }
    .progress-fill.red { background: linear-gradient(90deg, #f87171, #fb923c); }
    .progress-fill.blue { background: linear-gradient(90deg, #60a5fa, #a78bfa); }
    
    /* è§£é‡ŠåŒºåŸŸ */
    .explanation {
      background: rgba(255,255,255,0.03);
      border-radius: 15px;
      padding: 25px;
      margin-top: 25px;
    }
    .explanation h3 {
      color: #f5af19;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .explanation p {
      color: rgba(255,255,255,0.85);
      line-height: 1.9;
      margin-bottom: 12px;
    }
    .formula {
      background: rgba(255,255,255,0.08);
      padding: 15px 20px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      margin: 15px 0;
      overflow-x: auto;
      border-left: 3px solid #f5af19;
    }
    .highlight { color: #f87171; font-weight: bold; }
    .success { color: #4ade80; font-weight: bold; }
    
    /* ç”Ÿæ—¥é—®é¢˜ç‰¹æ®Šæ ·å¼ */
    .people-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin: 20px 0;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
    }
    .person {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: all 0.3s;
    }
    .person.match {
      background: linear-gradient(135deg, #f87171, #fb923c);
      animation: pulse 0.5s ease;
      transform: scale(1.2);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1.2); }
      50% { transform: scale(1.4); }
    }
    
    /* ä¿¡å°é—®é¢˜æ ·å¼ */
    .envelopes {
      display: flex;
      gap: 30px;
      justify-content: center;
      margin: 25px 0;
    }
    .envelope {
      width: 120px;
      height: 80px;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border-radius: 5px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: #78350f;
      font-weight: bold;
    }
    .envelope::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(135deg, #fcd34d, #fbbf24);
      clip-path: polygon(0 0, 50% 100%, 100% 0);
    }
    .envelope:hover:not(.disabled) {
      transform: translateY(-5px) scale(1.05);
    }
    .envelope.selected {
      box-shadow: 0 0 30px rgba(251,191,36,0.5);
    }
    .envelope.disabled { opacity: 0.6; cursor: not-allowed; }
    .envelope .amount {
      position: absolute;
      bottom: 10px;
      font-size: 0.9rem;
    }
    
    /* åœ£å½¼å¾—å ¡æ‚–è®º */
    .coin-flip-area {
      text-align: center;
      padding: 20px;
    }
    .big-coin {
      font-size: 5rem;
      margin: 20px 0;
      transition: transform 0.5s;
    }
    .big-coin.flipping {
      animation: coinFlip 0.5s ease;
    }
    @keyframes coinFlip {
      0% { transform: rotateY(0deg); }
      100% { transform: rotateY(720deg); }
    }
    .flip-result {
      font-size: 1.3rem;
      min-height: 40px;
      margin: 15px 0;
    }
    .flip-result.win { color: #4ade80; }
    .flip-result.lose { color: #f87171; }
    
    /* è´ç‰¹æœ—æ‚–è®º */
    .chord-visual {
      width: 250px;
      height: 250px;
      margin: 20px auto;
      position: relative;
    }
    .chord-visual svg {
      width: 100%;
      height: 100%;
    }
    
    /* è¾›æ™®æ£®æ‚–è®ºè¡¨æ ¼ */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.9rem;
    }
    .data-table th, .data-table td {
      padding: 12px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .data-table th {
      background: rgba(245,175,25,0.2);
      color: #f5af19;
    }
    .data-table tr:nth-child(even) {
      background: rgba(0,0,0,0.1);
    }
    .data-table .highlight-cell {
      background: rgba(74,222,128,0.2);
      color: #4ade80;
      font-weight: bold;
    }
    .data-table .warning-cell {
      background: rgba(248,113,113,0.2);
      color: #f87171;
      font-weight: bold;
    }
    
    /* ç»“è®ºæ¡† */
    .conclusion-box {
      background: linear-gradient(135deg, rgba(240,147,251,0.15), rgba(245,87,108,0.1));
      border: 2px solid rgba(240,147,251,0.3);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      margin-top: 25px;
    }
    .conclusion-box h3 {
      color: #f093fb;
      margin-bottom: 15px;
    }
    .conclusion-box p {
      color: rgba(255,255,255,0.9);
      line-height: 1.8;
    }
    
    /* å“åº”å¼ */
    @media (max-width: 600px) {
      .card { padding: 20px; }
      .card-title { font-size: 1.2rem; }
      .envelopes { flex-direction: column; align-items: center; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
    <h1>ğŸ² åç›´è§‰æ¦‚ç‡è®º</h1>
    <p class="subtitle">é‚£äº›è®©æ•°å­¦å®¶éƒ½æ›¾å›°æƒ‘çš„æ¦‚ç‡æ‚–è®º<br>æ¯ä¸€ä¸ªéƒ½é…æœ‰äº¤äº’å¼æ¨¡æ‹Ÿï¼Œçœ¼è§ä¸ºå®</p>
    
    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="birthday">ğŸ‚ ç”Ÿæ—¥æ‚–è®º</div>
      <div class="nav-tab" data-tab="stpetersburg">ğŸ’° åœ£å½¼å¾—å ¡æ‚–è®º</div>
      <div class="nav-tab" data-tab="envelope">âœ‰ï¸ ä¸¤ä¿¡å°æ‚–è®º</div>
      <div class="nav-tab" data-tab="simpson">ğŸ“Š è¾›æ™®æ£®æ‚–è®º</div>
      <div class="nav-tab" data-tab="bertrand">ğŸ“ è´ç‰¹æœ—æ‚–è®º</div>
      <div class="nav-tab" data-tab="waitingtime">â±ï¸ ç­‰å¾…æ—¶é—´æ‚–è®º</div>
    </div>

    <!-- 1. ç”Ÿæ—¥æ‚–è®º -->
    <div class="card active" id="birthday">
      <div class="card-header">
        <div class="card-icon">ğŸ‚</div>
        <div>
          <div class="card-title">ç”Ÿæ—¥æ‚–è®º</div>
          <div class="card-subtitle">23äººä¸­æœ‰ä¸¤äººåŒç”Ÿæ—¥çš„æ¦‚ç‡è¶…è¿‡50%</div>
        </div>
      </div>
      
      <div class="question-box">
        <strong>é—®é¢˜ï¼š</strong>ä¸€ä¸ªæˆ¿é—´é‡Œéœ€è¦å¤šå°‘äººï¼Œæ‰èƒ½ä½¿è‡³å°‘ä¸¤äººç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡è¶…è¿‡ <strong>50%</strong>ï¼Ÿ<br><br>
        <strong>ç›´è§‰ç­”æ¡ˆï¼š</strong>ä¸€å¹´365å¤©ï¼Œåº”è¯¥è¦180å¤šäººå§ï¼Ÿ<br>
        <strong>çœŸå®ç­”æ¡ˆï¼š</strong>åªéœ€è¦ <strong class="success">23äºº</strong>ï¼
      </div>
      
      <div class="interactive-area">
        <div style="text-align: center; margin-bottom: 15px;">
          <label style="color: rgba(255,255,255,0.7);">æˆ¿é—´äººæ•°ï¼š</label>
          <input type="range" id="peopleCount" min="2" max="70" value="23" style="width: 200px; vertical-align: middle;">
          <span id="peopleCountDisplay" style="font-size: 1.5rem; font-weight: bold; color: #f5af19; margin-left: 10px;">23</span>
        </div>
        
        <div class="people-grid" id="peopleGrid"></div>
        
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value blue" id="theoreticalProb">50.7%</div>
            <div class="stat-label">ç†è®ºæ¦‚ç‡</div>
          </div>
          <div class="stat-box">
            <div class="stat-value green" id="simulatedProb">-</div>
            <div class="stat-label">æ¨¡æ‹Ÿæ¦‚ç‡</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="matchFound">-</div>
            <div class="stat-label">æœ¬æ¬¡ç»“æœ</div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="simulateBirthday()">ğŸ² æ¨¡æ‹Ÿä¸€æ¬¡</button>
          <button class="btn btn-secondary" onclick="simulateBirthdayMany(1000)">âš¡ æ¨¡æ‹Ÿ1000æ¬¡</button>
          <button class="btn btn-secondary" onclick="resetBirthday()">ğŸ”„ é‡ç½®</button>
        </div>
      </div>
      
      <div class="explanation">
        <h3>ğŸ¤” ä¸ºä»€ä¹ˆè¿™ä¹ˆåç›´è§‰ï¼Ÿ</h3>
        <p>äººä»¬å®¹æ˜“çŠ¯çš„é”™è¯¯æ˜¯ï¼šæŠŠã€ŒæŸäººå’Œæˆ‘åŒç”Ÿæ—¥ã€ä¸ã€Œä»»æ„ä¸¤äººåŒç”Ÿæ—¥ã€æ··æ·†ã€‚</p>
        <p>23äººä¸­ï¼Œå¯èƒ½çš„é…å¯¹æ•°æ˜¯ï¼š</p>
        <div class="formula">C(23,2) = 23 Ã— 22 / 2 = <span class="success">253 å¯¹</span></div>
        <p>æ¯ä¸€å¯¹ä¸åŒç”Ÿæ—¥çš„æ¦‚ç‡æ˜¯ 364/365ï¼Œ253å¯¹éƒ½ä¸åŒçš„æ¦‚ç‡æ˜¯ï¼š</p>
        <div class="formula">(364/365)^253 â‰ˆ 0.4995 â†’ è‡³å°‘æœ‰ä¸€å¯¹ç›¸åŒ â‰ˆ <span class="success">50.05%</span></div>
        <p><strong>å…³é”®æ´å¯Ÿï¼š</strong>é…å¯¹æ•°éšäººæ•°å¹³æ–¹å¢é•¿ï¼Œè€Œä¸æ˜¯çº¿æ€§å¢é•¿ï¼</p>
      </div>
    </div>
    
    <!-- 2. åœ£å½¼å¾—å ¡æ‚–è®º -->
    <div class="card" id="stpetersburg">
      <div class="card-header">
        <div class="card-icon">ğŸ’°</div>
        <div>
          <div class="card-title">åœ£å½¼å¾—å ¡æ‚–è®º</div>
          <div class="card-subtitle">æœŸæœ›å€¼æ— ç©·å¤§çš„æ¸¸æˆï¼Œä½ æ„¿æ„èŠ±å¤šå°‘é’±ç©ï¼Ÿ</div>
        </div>
      </div>
      
      <div class="question-box">
        <strong>æ¸¸æˆè§„åˆ™ï¼š</strong>æŠ›ç¡¬å¸ï¼Œç¬¬ä¸€æ¬¡æ­£é¢å¾—2å…ƒï¼Œç¬¬äºŒæ¬¡æ‰æ­£é¢å¾—4å…ƒï¼Œç¬¬ä¸‰æ¬¡æ‰æ­£é¢å¾—8å…ƒ...ç¬¬næ¬¡æ‰æ­£é¢å¾— 2^n å…ƒã€‚<br><br>
        <strong>æœŸæœ›æ”¶ç›Šï¼š</strong>E = 1/2Ã—2 + 1/4Ã—4 + 1/8Ã—8 + ... = 1 + 1 + 1 + ... = <strong class="highlight">âˆ</strong><br><br>
        <strong>æ‚–è®ºï¼š</strong>æœŸæœ›å€¼æ— ç©·å¤§ï¼Œä½†ä½ æ„¿æ„èŠ±100å…ƒç©ä¸€æ¬¡å—ï¼Ÿ
      </div>
      
      <div class="interactive-area">
        <div class="coin-flip-area">
          <div class="big-coin" id="stpCoin">ğŸª™</div>
          <div class="flip-result" id="stpResult">ç‚¹å‡»å¼€å§‹æ¸¸æˆ</div>
          <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);" id="stpFlipCount">å·²æŠ›: 0 æ¬¡</div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value" id="stpGames">0</div>
            <div class="stat-label">æ¸¸æˆæ¬¡æ•°</div>
          </div>
          <div class="stat-box">
            <div class="stat-value green" id="stpTotalWin">Â¥0</div>
            <div class="stat-label">æ€»æ”¶ç›Š</div>
          </div>
          <div class="stat-box">
            <div class="stat-value blue" id="stpAvgWin">Â¥0</div>
            <div class="stat-label">å¹³å‡æ”¶ç›Š</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="stpMaxWin">Â¥0</div>
            <div class="stat-label">æœ€å¤§å•æ¬¡</div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="playStPetersburg()">ğŸ² ç©ä¸€å±€</button>
          <button class="btn btn-secondary" onclick="playStPetersburgMany(100)">âš¡ ç©100å±€</button>
          <button class="btn btn-secondary" onclick="playStPetersburgMany(1000)">âš¡ ç©1000å±€</button>
          <button class="btn btn-secondary" onclick="resetStPetersburg()">ğŸ”„ é‡ç½®</button>
        </div>
      </div>
      
      <div class="explanation">
        <h3>ğŸ¤” ä¸ºä»€ä¹ˆæœŸæœ›å€¼æ— ç©·å¤§å´æ²¡äººæ„¿æ„èŠ±å¤§é’±ç©ï¼Ÿ</h3>
        <p><strong>1. è¾¹é™…æ•ˆç”¨é€’å‡ï¼š</strong>èµ¢100ä¸‡å’Œèµ¢200ä¸‡çš„å¿«ä¹å·®è·ï¼Œè¿œå°äºèµ¢0å’Œèµ¢100ä¸‡ã€‚</p>
        <p><strong>2. å¤§æ•°éœ€è¦çœŸçš„å¤§ï¼š</strong>æœŸæœ›å€¼æ”¶æ•›ææ…¢ï¼Œéœ€è¦ç© 2^n æ¬¡æ‰èƒ½ç¨³å®šè·å¾— n å…ƒ/æ¬¡ã€‚</p>
        <div class="formula">
          ç© 1000 æ¬¡ï¼Œå¹³å‡æ”¶ç›Šçº¦ 10 å…ƒ/æ¬¡<br>
          ç© 100ä¸‡ æ¬¡ï¼Œå¹³å‡æ”¶ç›Šçº¦ 20 å…ƒ/æ¬¡<br>
          ç© 10äº¿ æ¬¡ï¼Œå¹³å‡æ”¶ç›Šçº¦ 30 å…ƒ/æ¬¡
        </div>
        <p><strong>3. ç°å®çº¦æŸï¼š</strong>æ²¡æœ‰èµŒåœºæœ‰æ— é™èµ„é‡‘æ”¯ä»˜ 2^100 å…ƒçš„å¥–é‡‘ã€‚</p>
        <p>è¿™ä¸ªæ‚–è®ºä¿ƒä½¿ä¼¯åŠªåˆ©æå‡ºäº†<span class="success">ã€Œæ•ˆç”¨å‡½æ•°ã€</span>çš„æ¦‚å¿µï¼Œå¥ å®šäº†ç°ä»£å†³ç­–ç†è®ºçš„åŸºç¡€ã€‚</p>
      </div>
    </div>
    
    <!-- 3. ä¸¤ä¿¡å°æ‚–è®º -->
    <div class="card" id="envelope">
      <div class="card-header">
        <div class="card-icon">âœ‰ï¸</div>
        <div>
          <div class="card-title">ä¸¤ä¿¡å°æ‚–è®º</div>
          <div class="card-subtitle">æ¢è¿˜æ˜¯ä¸æ¢ï¼Ÿé€»è¾‘å‘Šè¯‰ä½ æ°¸è¿œè¦æ¢</div>
        </div>
      </div>
      
      <div class="question-box">
        <strong>é—®é¢˜ï¼š</strong>ä¸¤ä¸ªä¿¡å°ï¼Œä¸€ä¸ªè£…çš„é’±æ˜¯å¦ä¸€ä¸ªçš„ä¸¤å€ã€‚ä½ éšæœºé€‰äº†ä¸€ä¸ªï¼Œæ‰“å¼€çœ‹åˆ° <strong>100å…ƒ</strong>ã€‚<br><br>
        <strong>æ¢çš„æœŸæœ›ï¼š</strong>å¦ä¸€ä¸ªè¦ä¹ˆæ˜¯50å…ƒ(æ¦‚ç‡1/2)ï¼Œè¦ä¹ˆæ˜¯200å…ƒ(æ¦‚ç‡1/2)<br>
        æœŸæœ› = 0.5Ã—50 + 0.5Ã—200 = <strong class="success">125å…ƒ</strong> > 100å…ƒ<br><br>
        <strong>æ‚–è®ºï¼š</strong>æŒ‰è¿™ä¸ªé€»è¾‘ï¼Œæ— è®ºçœ‹åˆ°å¤šå°‘é’±éƒ½åº”è¯¥æ¢ã€‚ä½†å¦‚æœä¸æ‰“å¼€å‘¢ï¼Ÿæ¢æ¥æ¢å»æœ‰æ„ä¹‰å—ï¼Ÿ
      </div>
      
      <div class="interactive-area">
        <div class="envelopes">
          <div class="envelope" id="env1" onclick="selectEnvelope(1)">
            <span>A</span>
            <div class="amount" id="env1Amount"></div>
          </div>
          <div class="envelope" id="env2" onclick="selectEnvelope(2)">
            <span>B</span>
            <div class="amount" id="env2Amount"></div>
          </div>
        </div>
        
        <div style="text-align: center; min-height: 60px;" id="envMessage">
          ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªä¿¡å°
        </div>
        
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value" id="envGames">0</div>
            <div class="stat-label">æ¸¸æˆæ¬¡æ•°</div>
          </div>
          <div class="stat-box">
            <div class="stat-value green" id="envSwitchAvg">-</div>
            <div class="stat-label">æ¢çš„å¹³å‡æ”¶ç›Š</div>
          </div>
          <div class="stat-box">
            <div class="stat-value blue" id="envStayAvg">-</div>
            <div class="stat-label">ä¸æ¢å¹³å‡æ”¶ç›Š</div>
          </div>
        </div>
        
        <div class="btn-group" id="envButtons">
          <button class="btn btn-primary" onclick="initEnvelope()">ğŸ² æ–°æ¸¸æˆ</button>
          <button class="btn btn-secondary" onclick="simulateEnvelopeMany(1000)">âš¡ æ¨¡æ‹Ÿ1000æ¬¡</button>
        </div>
      </div>
      
      <div class="explanation">
        <h3>ğŸ¤” æ‚–è®ºåœ¨å“ªé‡Œï¼Ÿ</h3>
        <p><strong>é”™è¯¯çš„å‡è®¾ï¼š</strong>ã€Œå¦ä¸€ä¸ªä¿¡å°æ˜¯50æˆ–200çš„æ¦‚ç‡å„50%ã€æ˜¯é”™çš„ï¼</p>
        <p>å¦‚æœå°ä¿¡å°æ˜¯Xï¼Œå¤§ä¿¡å°æ˜¯2Xï¼Œé‚£ä¹ˆï¼š</p>
        <div class="formula">
          çœ‹åˆ°100å…ƒæ—¶ï¼š<br>
          - å¦‚æœä½ æ‹¿çš„æ˜¯å°ä¿¡å°(X=100)ï¼Œå¦ä¸€ä¸ªæ˜¯200<br>
          - å¦‚æœä½ æ‹¿çš„æ˜¯å¤§ä¿¡å°(2X=100)ï¼Œå¦ä¸€ä¸ªæ˜¯50<br>
          è¿™ä¸¤ç§æƒ…å†µçš„æ¦‚ç‡<span class="highlight">ä¸ä¸€å®šç›¸ç­‰</span>ï¼
        </div>
        <p>å…³é”®åœ¨äºï¼šXçš„åˆ†å¸ƒæ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœXå‡åŒ€åˆ†å¸ƒåœ¨[1,100]ï¼Œçœ‹åˆ°100å…ƒæ›´å¯èƒ½æ˜¯å¤§ä¿¡å°ã€‚</p>
        <p><strong>æ­£ç¡®ç»“è®ºï¼š</strong>åœ¨æ²¡æœ‰å…ˆéªŒä¿¡æ¯æ—¶ï¼Œæ¢ä¸ä¸æ¢çš„æœŸæœ›æ”¶ç›Šç›¸åŒã€‚</p>
      </div>
    </div>

    <!-- 4. è¾›æ™®æ£®æ‚–è®º -->
    <div class="card" id="simpson">
      <div class="card-header">
        <div class="card-icon">ğŸ“Š</div>
        <div>
          <div class="card-title">è¾›æ™®æ£®æ‚–è®º</div>
          <div class="card-subtitle">åˆ†ç»„éƒ½èµ¢ï¼Œåˆå¹¶å´è¾“ï¼Ÿ</div>
        </div>
      </div>
      
      <div class="question-box">
        <strong>çœŸå®æ¡ˆä¾‹ï¼š</strong>1973å¹´ä¼¯å…‹åˆ©å¤§å­¦æ‹›ç”Ÿè¢«æ§æ€§åˆ«æ­§è§†ã€‚<br><br>
        <strong>æ€»ä½“æ•°æ®ï¼š</strong>ç”·æ€§å½•å–ç‡ 44%ï¼Œå¥³æ€§å½•å–ç‡ 35% â†’ æ­§è§†å¥³æ€§ï¼Ÿ<br>
        <strong>åˆ†ç³»æ•°æ®ï¼š</strong>å¤§å¤šæ•°ç³»å¥³æ€§å½•å–ç‡<span class="success">æ›´é«˜</span>ï¼<br><br>
        <strong>æ‚–è®ºï¼š</strong>æ¯ä¸ªå­ç¾¤ä½“ä¸­Aéƒ½æ¯”Bå¥½ï¼Œä½†åˆå¹¶åBå´æ¯”Aå¥½ã€‚
      </div>
      
      <div class="interactive-area">
        <h4 style="text-align: center; margin-bottom: 15px; color: rgba(255,255,255,0.8);">ğŸ¥ æ¨¡æ‹Ÿï¼šä¸¤ç§è¯ç‰©çš„ç–—æ•ˆå¯¹æ¯”</h4>
        
        <table class="data-table" id="simpsonTable">
          <tr>
            <th>æ‚£è€…ç±»å‹</th>
            <th>è¯ç‰©Aæ²»æ„ˆç‡</th>
            <th>è¯ç‰©Bæ²»æ„ˆç‡</th>
            <th>æ›´ä¼˜</th>
          </tr>
          <tr>
            <td>è½»ç—‡æ‚£è€…</td>
            <td class="highlight-cell">93% (93/100)</td>
            <td>87% (87/100)</td>
            <td style="color: #4ade80;">A</td>
          </tr>
          <tr>
            <td>é‡ç—‡æ‚£è€…</td>
            <td class="highlight-cell">73% (73/100)</td>
            <td>69% (69/100)</td>
            <td style="color: #4ade80;">A</td>
          </tr>
          <tr style="background: rgba(248,113,113,0.1);">
            <td><strong>æ€»ä½“</strong></td>
            <td class="warning-cell">78% (156/200)</td>
            <td class="highlight-cell">83% (166/200)</td>
            <td style="color: #f87171;"><strong>B !</strong></td>
          </tr>
        </table>
        
        <div style="text-align: center; margin: 20px 0;">
          <button class="btn btn-primary" onclick="generateSimpsonData()">ğŸ² ç”Ÿæˆæ–°æ•°æ®</button>
          <button class="btn btn-secondary" onclick="showSimpsonExplanation()">ğŸ’¡ æ­ç§˜åŸå› </button>
        </div>
        
        <div id="simpsonExplanation" style="display: none; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; margin-top: 15px;">
          <p style="color: rgba(255,255,255,0.9); line-height: 1.8;">
            <strong style="color: #f5af19;">å…³é”®ï¼š</strong>åˆ†ç»„æ¯”ä¾‹ä¸åŒï¼<br><br>
            è¯ç‰©Aï¼šè½»ç—‡100äºº + é‡ç—‡100äºº = 200äºº<br>
            è¯ç‰©Bï¼šè½»ç—‡<span class="highlight">20äºº</span> + é‡ç—‡<span class="highlight">180äºº</span> = 200äºº<br><br>
            è¯ç‰©Bä¸»è¦ç”¨äºé‡ç—‡æ‚£è€…ï¼ˆåŸºæ•°å¤§ï¼‰ï¼Œè€Œé‡ç—‡æœ¬èº«æ²»æ„ˆç‡ä½ï¼Œæ‹‰ä½äº†æ€»ä½“æ•°æ®ã€‚<br>
            è¿™å°±æ˜¯<span class="success">ã€Œæ··æ‚å˜é‡ã€</span>çš„å¨åŠ›ï¼
          </p>
        </div>
      </div>
      
      <div class="explanation">
        <h3>ğŸ¤” ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</h3>
        <p>è¾›æ™®æ£®æ‚–è®ºçš„æœ¬è´¨æ˜¯<strong>æ··æ‚å˜é‡</strong>ï¼ˆConfounding Variableï¼‰çš„å½±å“ã€‚</p>
        <p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œã€Œç—…æƒ…ä¸¥é‡ç¨‹åº¦ã€æ˜¯æ··æ‚å˜é‡ï¼š</p>
        <div class="formula">
          1. ç—…æƒ…å½±å“æ²»æ„ˆç‡ï¼ˆé‡ç—‡æ›´éš¾æ²»ï¼‰<br>
          2. ç—…æƒ…å½±å“è¯ç‰©é€‰æ‹©ï¼ˆé‡ç—‡æ›´å¤šç”¨Bï¼‰<br>
          â†’ å¯¼è‡´æ€»ä½“æ•°æ®äº§ç”Ÿè¯¯å¯¼
        </div>
        <p><strong>ç°å®å¯ç¤ºï¼š</strong></p>
        <p>â€¢ çœ‹åˆ°ã€ŒXXäº§å“ç”¨æˆ·æ»¡æ„åº¦æ›´é«˜ã€æ—¶ï¼Œè¦é—®ï¼šç”¨æˆ·ç¾¤ä½“ä¸€æ ·å—ï¼Ÿ</p>
        <p>â€¢ çœ‹åˆ°ã€ŒXXå­¦æ ¡å‡å­¦ç‡æ›´é«˜ã€æ—¶ï¼Œè¦é—®ï¼šç”Ÿæºè´¨é‡ä¸€æ ·å—ï¼Ÿ</p>
        <p>â€¢ <span class="highlight">ç›¸å…³æ€§ â‰  å› æœæ€§</span>ï¼Œæ•°æ®ä¼šéª—äººï¼</p>
      </div>
    </div>
    
    <!-- 5. è´ç‰¹æœ—æ‚–è®º -->
    <div class="card" id="bertrand">
      <div class="card-header">
        <div class="card-icon">ğŸ“</div>
        <div>
          <div class="card-title">è´ç‰¹æœ—æ‚–è®º</div>
          <div class="card-subtitle">åŒä¸€ä¸ªé—®é¢˜ï¼Œä¸‰ç§ã€Œæ­£ç¡®ã€ç­”æ¡ˆ</div>
        </div>
      </div>
      
      <div class="question-box">
        <strong>é—®é¢˜ï¼š</strong>åœ¨åœ†å†…éšæœºç”»ä¸€æ¡å¼¦ï¼Œå¼¦é•¿è¶…è¿‡å†…æ¥ç­‰è¾¹ä¸‰è§’å½¢è¾¹é•¿çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ<br><br>
        <strong>ç­”æ¡ˆ1ï¼š</strong>1/3ï¼ˆéšæœºé€‰ä¸¤ç‚¹ï¼‰<br>
        <strong>ç­”æ¡ˆ2ï¼š</strong>1/2ï¼ˆéšæœºé€‰åŠå¾„ä¸Šçš„ç‚¹ï¼‰<br>
        <strong>ç­”æ¡ˆ3ï¼š</strong>1/4ï¼ˆéšæœºé€‰åœ†å†…çš„ç‚¹ä½œä¸ºå¼¦ä¸­ç‚¹ï¼‰<br><br>
        <strong>æ‚–è®ºï¼š</strong>ä¸‰ä¸ªç­”æ¡ˆéƒ½ã€Œæ­£ç¡®ã€ï¼Œå–å†³äºã€Œéšæœºã€çš„å®šä¹‰ï¼
      </div>
      
      <div class="interactive-area">
        <div style="text-align: center; margin-bottom: 15px;">
          <label style="color: rgba(255,255,255,0.7);">é€‰æ‹©éšæœºæ–¹æ³•ï¼š</label>
          <select id="bertrandMethod" style="padding: 8px 15px; border-radius: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);">
            <option value="1">æ–¹æ³•1: éšæœºé€‰åœ†å‘¨ä¸Šä¸¤ç‚¹</option>
            <option value="2">æ–¹æ³•2: éšæœºé€‰åŠå¾„ä¸Šä¸€ç‚¹</option>
            <option value="3">æ–¹æ³•3: éšæœºé€‰åœ†å†…ä¸€ç‚¹ä½œä¸ºå¼¦ä¸­ç‚¹</option>
          </select>
        </div>
        
        <div class="chord-visual">
          <svg id="bertrandSvg" viewBox="0 0 250 250">
            <circle cx="125" cy="125" r="100" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
            <!-- å†…æ¥ç­‰è¾¹ä¸‰è§’å½¢ -->
            <polygon points="125,25 38,175 212,175" fill="none" stroke="rgba(245,175,25,0.5)" stroke-width="1" stroke-dasharray="5,5"/>
            <!-- å¼¦ -->
            <line id="bertrandChord" x1="125" y1="25" x2="212" y2="175" stroke="#f093fb" stroke-width="2"/>
          </svg>
        </div>
        
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value" id="bertrandTotal">0</div>
            <div class="stat-label">æ€»å¼¦æ•°</div>
          </div>
          <div class="stat-box">
            <div class="stat-value green" id="bertrandLong">0</div>
            <div class="stat-label">é•¿å¼¦æ•°</div>
          </div>
          <div class="stat-box">
            <div class="stat-value blue" id="bertrandProb">-</div>
            <div class="stat-label">é•¿å¼¦æ¦‚ç‡</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="bertrandTheory">1/3</div>
            <div class="stat-label">ç†è®ºå€¼</div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="drawBertrandChord()">ğŸ² ç”»ä¸€æ¡å¼¦</button>
          <button class="btn btn-secondary" onclick="drawBertrandMany(500)">âš¡ ç”»500æ¡</button>
          <button class="btn btn-secondary" onclick="resetBertrand()">ğŸ”„ é‡ç½®</button>
        </div>
      </div>
      
      <div class="explanation">
        <h3>ğŸ¤” ä¸ºä»€ä¹ˆä¼šæœ‰ä¸‰ä¸ªç­”æ¡ˆï¼Ÿ</h3>
        <p>è¿™ä¸ªæ‚–è®ºæ­ç¤ºäº†ä¸€ä¸ªæ·±åˆ»çš„é—®é¢˜ï¼š<strong>ã€Œéšæœºã€æœ¬èº«éœ€è¦å®šä¹‰</strong>ã€‚</p>
        <div class="formula">
          æ–¹æ³•1: åœ¨åœ†å‘¨ä¸Šå‡åŒ€é€‰ç‚¹ â†’ P = 1/3<br>
          æ–¹æ³•2: åœ¨åŠå¾„ä¸Šå‡åŒ€é€‰ç‚¹ â†’ P = 1/2<br>
          æ–¹æ³•3: åœ¨åœ†é¢ä¸Šå‡åŒ€é€‰ç‚¹ â†’ P = 1/4
        </div>
        <p>ä¸‰ç§æ–¹æ³•å¯¹åº”ä¸‰ç§ä¸åŒçš„ã€Œå‡åŒ€åˆ†å¸ƒã€ï¼Œéƒ½æ˜¯åˆç†çš„ã€‚</p>
        <p><strong>å¯ç¤ºï¼š</strong>åœ¨æ¦‚ç‡é—®é¢˜ä¸­ï¼Œå¿…é¡»æ˜ç¡®å®šä¹‰æ ·æœ¬ç©ºé—´å’Œæ¦‚ç‡æµ‹åº¦ã€‚ã€Œéšæœºã€ä¸æ˜¯ä¸€ä¸ªè‡ªæ˜çš„æ¦‚å¿µï¼</p>
      </div>
    </div>
    
    <!-- 6. ç­‰å¾…æ—¶é—´æ‚–è®º -->
    <div class="card" id="waitingtime">
      <div class="card-header">
        <div class="card-icon">â±ï¸</div>
        <div>
          <div class="card-title">ç­‰å¾…æ—¶é—´æ‚–è®ºï¼ˆæ£€éªŒæ‚–è®ºï¼‰</div>
          <div class="card-subtitle">å…¬äº¤è½¦å¹³å‡10åˆ†é’Ÿä¸€ç­ï¼Œä½ å¹³å‡è¦ç­‰å¤šä¹…ï¼Ÿ</div>
        </div>
      </div>
      
      <div class="question-box">
        <strong>é—®é¢˜ï¼š</strong>å…¬äº¤è½¦å¹³å‡æ¯10åˆ†é’Ÿä¸€ç­ã€‚ä½ éšæœºåˆ°è¾¾è½¦ç«™ï¼Œå¹³å‡è¦ç­‰å¤šä¹…ï¼Ÿ<br><br>
        <strong>ç›´è§‰ç­”æ¡ˆï¼š</strong>5åˆ†é’Ÿï¼ˆ10åˆ†é’Ÿçš„ä¸€åŠï¼‰<br>
        <strong>çœŸå®ç­”æ¡ˆï¼š</strong>å¦‚æœå‘è½¦é—´éš”æœ‰æ³¢åŠ¨ï¼Œå¹³å‡ç­‰å¾…æ—¶é—´ <strong class="highlight">> 5åˆ†é’Ÿ</strong>ï¼<br><br>
        <strong>æç«¯æƒ…å†µï¼š</strong>å¦‚æœé—´éš”æœä»æŒ‡æ•°åˆ†å¸ƒï¼Œå¹³å‡ç­‰å¾…æ—¶é—´ = <strong class="highlight">10åˆ†é’Ÿ</strong>ï¼
      </div>
      
      <div class="interactive-area">
        <div style="text-align: center; margin-bottom: 20px;">
          <label style="color: rgba(255,255,255,0.7);">å‘è½¦é—´éš”åˆ†å¸ƒï¼š</label>
          <select id="busDistribution" style="padding: 8px 15px; border-radius: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2);" onchange="updateBusTheory()">
            <option value="fixed">å›ºå®šé—´éš”ï¼ˆæ¯10åˆ†é’Ÿä¸€ç­ï¼‰</option>
            <option value="uniform">å‡åŒ€åˆ†å¸ƒï¼ˆ5-15åˆ†é’Ÿï¼‰</option>
            <option value="exponential">æŒ‡æ•°åˆ†å¸ƒï¼ˆå¹³å‡10åˆ†é’Ÿï¼‰</option>
          </select>
        </div>
        
        <div class="progress-container">
          <div class="progress-label">
            <span>ç­‰å¾…æ—¶é—´åˆ†å¸ƒ</span>
            <span id="waitTimeDisplay">æ¨¡æ‹Ÿä¸­...</span>
          </div>
          <div class="progress-bar" style="height: 40px;">
            <div class="progress-fill blue" id="waitProgress" style="width: 0%;"></div>
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-value" id="busSimCount">0</div>
            <div class="stat-label">æ¨¡æ‹Ÿæ¬¡æ•°</div>
          </div>
          <div class="stat-box">
            <div class="stat-value blue" id="busAvgWait">-</div>
            <div class="stat-label">å¹³å‡ç­‰å¾…</div>
          </div>
          <div class="stat-box">
            <div class="stat-value green" id="busTheoryWait">5åˆ†é’Ÿ</div>
            <div class="stat-label">ç†è®ºå€¼</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="busMaxWait">-</div>
            <div class="stat-label">æœ€é•¿ç­‰å¾…</div>
          </div>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="simulateBusWait()">ğŸšŒ æ¨¡æ‹Ÿä¸€æ¬¡</button>
          <button class="btn btn-secondary" onclick="simulateBusWaitMany(1000)">âš¡ æ¨¡æ‹Ÿ1000æ¬¡</button>
          <button class="btn btn-secondary" onclick="resetBusWait()">ğŸ”„ é‡ç½®</button>
        </div>
      </div>
      
      <div class="explanation">
        <h3>ğŸ¤” ä¸ºä»€ä¹ˆç­‰å¾…æ—¶é—´ä¼šè¶…è¿‡ä¸€åŠï¼Ÿ</h3>
        <p>è¿™å«åš<strong>ã€Œæ£€éªŒæ‚–è®ºã€</strong>æˆ–<strong>ã€Œé•¿åº¦åå·®æŠ½æ ·ã€</strong>ã€‚</p>
        <p>å…³é”®æ´å¯Ÿï¼šä½ æ›´å¯èƒ½è½åœ¨<span class="highlight">è¾ƒé•¿çš„é—´éš”</span>ä¸­ï¼</p>
        <div class="formula">
          å‡è®¾æœ‰ä¸¤ç§é—´éš”ï¼š5åˆ†é’Ÿå’Œ15åˆ†é’Ÿå„å ä¸€åŠ<br>
          å¹³å‡é—´éš” = (5+15)/2 = 10åˆ†é’Ÿ<br><br>
          ä½†ä½ è½åœ¨15åˆ†é’Ÿé—´éš”çš„æ¦‚ç‡æ˜¯ 15/(5+15) = 75%<br>
          è½åœ¨5åˆ†é’Ÿé—´éš”çš„æ¦‚ç‡åªæœ‰ 25%<br><br>
          å¹³å‡ç­‰å¾… = 0.25Ã—2.5 + 0.75Ã—7.5 = <span class="highlight">6.25åˆ†é’Ÿ</span> > 5åˆ†é’Ÿ
        </div>
        <p><strong>æ•°å­¦å…¬å¼ï¼š</strong></p>
        <div class="formula">
          E[ç­‰å¾…æ—¶é—´] = E[é—´éš”]/2 + Var[é—´éš”]/(2Ã—E[é—´éš”])
        </div>
        <p>åªæœ‰å½“æ–¹å·®ä¸º0ï¼ˆå›ºå®šé—´éš”ï¼‰æ—¶ï¼Œç­‰å¾…æ—¶é—´æ‰ç­‰äºé—´éš”çš„ä¸€åŠã€‚</p>
      </div>
    </div>
    
    <!-- æ€»ç»“ -->
    <div class="conclusion-box">
      <h3>ğŸ’¡ æ¦‚ç‡è®ºçš„åç›´è§‰æœ¬è´¨</h3>
      <p>
        è¿™äº›æ‚–è®ºå‘Šè¯‰æˆ‘ä»¬ï¼š<br><br>
        1. <strong>ç›´è§‰æ˜¯ä¸å¯é çš„</strong> â€” äººè„‘ä¸æ“…é•¿å¤„ç†æ¦‚ç‡<br>
        2. <strong>å®šä¹‰å¾ˆé‡è¦</strong> â€” ã€Œéšæœºã€ã€Œå…¬å¹³ã€éœ€è¦ç²¾ç¡®å®šä¹‰<br>
        3. <strong>æ•°æ®ä¼šéª—äºº</strong> â€” ç›¸å…³æ€§â‰ å› æœæ€§ï¼Œè¦è­¦æƒ•æ··æ‚å˜é‡<br>
        4. <strong>æœŸæœ›å€¼ä¸æ˜¯ä¸€åˆ‡</strong> â€” è¿˜è¦è€ƒè™‘æ–¹å·®ã€æ•ˆç”¨ã€ç°å®çº¦æŸ<br><br>
        <span style="color: #f5af19;">æ¦‚ç‡è®ºçš„é­…åŠ›ï¼Œæ­£åœ¨äºå®ƒä¸æ–­æŒ‘æˆ˜æˆ‘ä»¬çš„ç›´è§‰ã€‚</span>
      </p>
    </div>
  </div>

  <script>
    // ========== æ ‡ç­¾åˆ‡æ¢ ==========
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });
    
    // ========== 1. ç”Ÿæ—¥æ‚–è®º ==========
    let birthdayStats = { total: 0, matches: 0 };
    
    function calculateBirthdayProbability(n) {
      let prob = 1;
      for (let i = 0; i < n; i++) {
        prob *= (365 - i) / 365;
      }
      return 1 - prob;
    }
    
    document.getElementById('peopleCount').addEventListener('input', function() {
      const n = parseInt(this.value);
      document.getElementById('peopleCountDisplay').textContent = n;
      document.getElementById('theoreticalProb').textContent = (calculateBirthdayProbability(n) * 100).toFixed(1) + '%';
      renderPeopleGrid(n);
    });
    
    function renderPeopleGrid(n, birthdays = null, matchIndices = []) {
      const grid = document.getElementById('peopleGrid');
      grid.innerHTML = '';
      for (let i = 0; i < n; i++) {
        const person = document.createElement('div');
        person.className = 'person' + (matchIndices.includes(i) ? ' match' : '');
        person.textContent = 'ğŸ‘¤';
        if (birthdays) {
          person.title = `ç”Ÿæ—¥: ${birthdays[i] + 1}`;
        }
        grid.appendChild(person);
      }
    }
    
    function simulateBirthday() {
      const n = parseInt(document.getElementById('peopleCount').value);
      const birthdays = [];
      const seen = new Set();
      let matchIndices = [];
      let hasMatch = false;
      
      for (let i = 0; i < n; i++) {
        const birthday = Math.floor(Math.random() * 365);
        birthdays.push(birthday);
        if (seen.has(birthday)) {
          hasMatch = true;
          matchIndices.push(i);
          // æ‰¾åˆ°ä¹‹å‰ç›¸åŒç”Ÿæ—¥çš„äºº
          for (let j = 0; j < i; j++) {
            if (birthdays[j] === birthday) matchIndices.push(j);
          }
        }
        seen.add(birthday);
      }
      
      birthdayStats.total++;
      if (hasMatch) birthdayStats.matches++;
      
      renderPeopleGrid(n, birthdays, matchIndices);
      document.getElementById('matchFound').textContent = hasMatch ? 'æœ‰é‡å¤!' : 'æ— é‡å¤';
      document.getElementById('matchFound').className = 'stat-value ' + (hasMatch ? 'green' : 'red');
      document.getElementById('simulatedProb').textContent = (birthdayStats.matches / birthdayStats.total * 100).toFixed(1) + '%';
    }
    
    function simulateBirthdayMany(times) {
      const n = parseInt(document.getElementById('peopleCount').value);
      for (let t = 0; t < times; t++) {
        const birthdays = [];
        const seen = new Set();
        let hasMatch = false;
        
        for (let i = 0; i < n; i++) {
          const birthday = Math.floor(Math.random() * 365);
          birthdays.push(birthday);
          if (seen.has(birthday)) hasMatch = true;
          seen.add(birthday);
        }
        
        birthdayStats.total++;
        if (hasMatch) birthdayStats.matches++;
      }
      
      document.getElementById('simulatedProb').textContent = (birthdayStats.matches / birthdayStats.total * 100).toFixed(1) + '%';
      document.getElementById('matchFound').textContent = `å·²æ¨¡æ‹Ÿ${birthdayStats.total}æ¬¡`;
    }
    
    function resetBirthday() {
      birthdayStats = { total: 0, matches: 0 };
      const n = parseInt(document.getElementById('peopleCount').value);
      renderPeopleGrid(n);
      document.getElementById('simulatedProb').textContent = '-';
      document.getElementById('matchFound').textContent = '-';
    }
    
    // åˆå§‹åŒ–
    renderPeopleGrid(23);
    
    // ========== 2. åœ£å½¼å¾—å ¡æ‚–è®º ==========
    let stpStats = { games: 0, totalWin: 0, maxWin: 0 };
    
    function playStPetersburg(animate = true) {
      let flips = 0;
      let prize = 1;
      
      const coin = document.getElementById('stpCoin');
      const result = document.getElementById('stpResult');
      const flipCount = document.getElementById('stpFlipCount');
      
      if (animate) {
        coin.classList.add('flipping');
        setTimeout(() => coin.classList.remove('flipping'), 500);
      }
      
      // æ¨¡æ‹ŸæŠ›ç¡¬å¸
      while (Math.random() < 0.5) {
        flips++;
        prize *= 2;
      }
      flips++;
      prize *= 2;
      
      stpStats.games++;
      stpStats.totalWin += prize;
      if (prize > stpStats.maxWin) stpStats.maxWin = prize;
      
      if (animate) {
        result.textContent = `ğŸ‰ ç¬¬${flips}æ¬¡æ­£é¢ï¼Œèµ¢å¾— Â¥${prize}`;
        result.className = 'flip-result win';
        flipCount.textContent = `æŠ›äº† ${flips} æ¬¡`;
        coin.textContent = flips > 10 ? 'ğŸ’°' : 'ğŸª™';
      }
      
      updateStPetersburgStats();
      return prize;
    }
    
    function playStPetersburgMany(times) {
      for (let i = 0; i < times; i++) {
        playStPetersburg(false);
      }
      document.getElementById('stpResult').textContent = `å·²å®Œæˆ ${times} å±€æ¨¡æ‹Ÿ`;
      document.getElementById('stpResult').className = 'flip-result';
    }
    
    function updateStPetersburgStats() {
      document.getElementById('stpGames').textContent = stpStats.games;
      document.getElementById('stpTotalWin').textContent = 'Â¥' + stpStats.totalWin.toLocaleString();
      document.getElementById('stpAvgWin').textContent = 'Â¥' + (stpStats.totalWin / stpStats.games).toFixed(2);
      document.getElementById('stpMaxWin').textContent = 'Â¥' + stpStats.maxWin.toLocaleString();
    }
    
    function resetStPetersburg() {
      stpStats = { games: 0, totalWin: 0, maxWin: 0 };
      document.getElementById('stpGames').textContent = '0';
      document.getElementById('stpTotalWin').textContent = 'Â¥0';
      document.getElementById('stpAvgWin').textContent = 'Â¥0';
      document.getElementById('stpMaxWin').textContent = 'Â¥0';
      document.getElementById('stpResult').textContent = 'ç‚¹å‡»å¼€å§‹æ¸¸æˆ';
      document.getElementById('stpResult').className = 'flip-result';
      document.getElementById('stpFlipCount').textContent = 'å·²æŠ›: 0 æ¬¡';
      document.getElementById('stpCoin').textContent = 'ğŸª™';
    }
    
    // ========== 3. ä¸¤ä¿¡å°æ‚–è®º ==========
    let envStats = { games: 0, switchTotal: 0, stayTotal: 0 };
    let envState = { small: 0, large: 0, selected: 0, phase: 'init' };
    
    function initEnvelope() {
      const base = Math.floor(Math.random() * 100) + 10;
      envState.small = base;
      envState.large = base * 2;
      envState.selected = 0;
      envState.phase = 'select';
      
      document.getElementById('env1').classList.remove('selected', 'disabled');
      document.getElementById('env2').classList.remove('selected', 'disabled');
      document.getElementById('env1Amount').textContent = '';
      document.getElementById('env2Amount').textContent = '';
      document.getElementById('envMessage').innerHTML = 'ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªä¿¡å°';
    }
    
    function selectEnvelope(num) {
      if (envState.phase !== 'select') return;
      
      envState.selected = num;
      envState.phase = 'decide';
      
      // éšæœºåˆ†é…é‡‘é¢
      const amounts = Math.random() < 0.5 ? [envState.small, envState.large] : [envState.large, envState.small];
      envState.amounts = amounts;
      
      document.getElementById(`env${num}`).classList.add('selected');
      document.getElementById(`env${num}Amount`).textContent = `Â¥${amounts[num-1]}`;
      
      document.getElementById('envMessage').innerHTML = `
        ä½ é€‰æ‹©äº†ä¿¡å°${num === 1 ? 'A' : 'B'}ï¼Œé‡Œé¢æœ‰ <strong style="color: #f5af19;">Â¥${amounts[num-1]}</strong><br>
        <button class="btn btn-primary" onclick="decideEnvelope(true)" style="margin: 10px 5px;">ğŸ”„ æ¢</button>
        <button class="btn btn-secondary" onclick="decideEnvelope(false)" style="margin: 10px 5px;">âœ‹ ä¸æ¢</button>
      `;
    }
    
    function decideEnvelope(switchEnv) {
      if (envState.phase !== 'decide') return;
      envState.phase = 'done';
      
      const other = envState.selected === 1 ? 2 : 1;
      const myAmount = envState.amounts[envState.selected - 1];
      const otherAmount = envState.amounts[other - 1];
      const finalAmount = switchEnv ? otherAmount : myAmount;
      
      envStats.games++;
      if (switchEnv) {
        envStats.switchTotal += finalAmount;
      } else {
        envStats.stayTotal += finalAmount;
      }
      
      // æ˜¾ç¤ºä¸¤ä¸ªä¿¡å°çš„é‡‘é¢
      document.getElementById('env1Amount').textContent = `Â¥${envState.amounts[0]}`;
      document.getElementById('env2Amount').textContent = `Â¥${envState.amounts[1]}`;
      document.getElementById('env1').classList.add('disabled');
      document.getElementById('env2').classList.add('disabled');
      
      const won = finalAmount === envState.large;
      document.getElementById('envMessage').innerHTML = `
        ${switchEnv ? 'æ¢äº†ï¼' : 'æ²¡æ¢ï¼'} ä½ å¾—åˆ° <strong style="color: ${won ? '#4ade80' : '#f87171'};">Â¥${finalAmount}</strong>
        ${won ? 'ï¼ˆæ‹¿åˆ°äº†å¤§çš„ï¼ï¼‰' : 'ï¼ˆæ‹¿åˆ°äº†å°çš„ï¼‰'}
      `;
      
      updateEnvelopeStats();
    }
    
    function simulateEnvelopeMany(times) {
      for (let i = 0; i < times; i++) {
        const base = Math.floor(Math.random() * 100) + 10;
        const small = base, large = base * 2;
        const amounts = Math.random() < 0.5 ? [small, large] : [large, small];
        const selected = Math.random() < 0.5 ? 0 : 1;
        const other = 1 - selected;
        
        envStats.games++;
        envStats.switchTotal += amounts[other];
        envStats.stayTotal += amounts[selected];
      }
      updateEnvelopeStats();
      document.getElementById('envMessage').innerHTML = `å·²æ¨¡æ‹Ÿ ${times} æ¬¡`;
    }
    
    function updateEnvelopeStats() {
      document.getElementById('envGames').textContent = envStats.games;
      if (envStats.games > 0) {
        const switchCount = envStats.games;
        const stayCount = envStats.games;
        document.getElementById('envSwitchAvg').textContent = 'Â¥' + (envStats.switchTotal / switchCount).toFixed(1);
        document.getElementById('envStayAvg').textContent = 'Â¥' + (envStats.stayTotal / stayCount).toFixed(1);
      }
    }
    
    initEnvelope();

    // ========== 4. è¾›æ™®æ£®æ‚–è®º ==========
    function generateSimpsonData() {
      // ç”Ÿæˆèƒ½äº§ç”Ÿè¾›æ™®æ£®æ‚–è®ºçš„æ•°æ®
      // è¯ç‰©A: è½»ç—‡å¤šï¼Œé‡ç—‡å°‘
      // è¯ç‰©B: è½»ç—‡å°‘ï¼Œé‡ç—‡å¤š
      const aLight = 100, aHeavy = 100;
      const bLight = 20, bHeavy = 180;
      
      // è½»ç—‡æ²»æ„ˆç‡é«˜ï¼Œé‡ç—‡æ²»æ„ˆç‡ä½
      // ä½†Aåœ¨ä¸¤ç»„éƒ½ç•¥é«˜
      const aLightRate = 0.90 + Math.random() * 0.08;
      const aHeavyRate = 0.70 + Math.random() * 0.08;
      const bLightRate = aLightRate - 0.03 - Math.random() * 0.05;
      const bHeavyRate = aHeavyRate - 0.02 - Math.random() * 0.05;
      
      const aLightCure = Math.round(aLight * aLightRate);
      const aHeavyCure = Math.round(aHeavy * aHeavyRate);
      const bLightCure = Math.round(bLight * bLightRate);
      const bHeavyCure = Math.round(bHeavy * bHeavyRate);
      
      const aTotal = aLight + aHeavy;
      const bTotal = bLight + bHeavy;
      const aTotalCure = aLightCure + aHeavyCure;
      const bTotalCure = bLightCure + bHeavyCure;
      
      const table = document.getElementById('simpsonTable');
      table.innerHTML = `
        <tr>
          <th>æ‚£è€…ç±»å‹</th>
          <th>è¯ç‰©Aæ²»æ„ˆç‡</th>
          <th>è¯ç‰©Bæ²»æ„ˆç‡</th>
          <th>æ›´ä¼˜</th>
        </tr>
        <tr>
          <td>è½»ç—‡æ‚£è€…</td>
          <td class="highlight-cell">${(aLightCure/aLight*100).toFixed(0)}% (${aLightCure}/${aLight})</td>
          <td>${(bLightCure/bLight*100).toFixed(0)}% (${bLightCure}/${bLight})</td>
          <td style="color: #4ade80;">A</td>
        </tr>
        <tr>
          <td>é‡ç—‡æ‚£è€…</td>
          <td class="highlight-cell">${(aHeavyCure/aHeavy*100).toFixed(0)}% (${aHeavyCure}/${aHeavy})</td>
          <td>${(bHeavyCure/bHeavy*100).toFixed(0)}% (${bHeavyCure}/${bHeavy})</td>
          <td style="color: #4ade80;">A</td>
        </tr>
        <tr style="background: rgba(248,113,113,0.1);">
          <td><strong>æ€»ä½“</strong></td>
          <td class="warning-cell">${(aTotalCure/aTotal*100).toFixed(0)}% (${aTotalCure}/${aTotal})</td>
          <td class="highlight-cell">${(bTotalCure/bTotal*100).toFixed(0)}% (${bTotalCure}/${bTotal})</td>
          <td style="color: #f87171;"><strong>B !</strong></td>
        </tr>
      `;
    }
    
    function showSimpsonExplanation() {
      const el = document.getElementById('simpsonExplanation');
      el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }
    
    // ========== 5. è´ç‰¹æœ—æ‚–è®º ==========
    let bertrandStats = { total: 0, long: 0 };
    const triangleSide = Math.sqrt(3) * 100; // å†…æ¥ç­‰è¾¹ä¸‰è§’å½¢è¾¹é•¿
    
    function drawBertrandChord(animate = true) {
      const method = document.getElementById('bertrandMethod').value;
      const svg = document.getElementById('bertrandSvg');
      const chord = document.getElementById('bertrandChord');
      
      let x1, y1, x2, y2, chordLength;
      const cx = 125, cy = 125, r = 100;
      
      if (method === '1') {
        // æ–¹æ³•1: éšæœºé€‰åœ†å‘¨ä¸Šä¸¤ç‚¹
        const angle1 = Math.random() * 2 * Math.PI;
        const angle2 = Math.random() * 2 * Math.PI;
        x1 = cx + r * Math.cos(angle1);
        y1 = cy + r * Math.sin(angle1);
        x2 = cx + r * Math.cos(angle2);
        y2 = cy + r * Math.sin(angle2);
      } else if (method === '2') {
        // æ–¹æ³•2: éšæœºé€‰åŠå¾„ä¸Šä¸€ç‚¹ä½œä¸ºå¼¦ä¸­ç‚¹
        const angle = Math.random() * 2 * Math.PI;
        const dist = Math.random() * r;
        const midX = cx + dist * Math.cos(angle);
        const midY = cy + dist * Math.sin(angle);
        // å¼¦å‚ç›´äºåŠå¾„
        const halfLen = Math.sqrt(r*r - dist*dist);
        const perpAngle = angle + Math.PI/2;
        x1 = midX + halfLen * Math.cos(perpAngle);
        y1 = midY + halfLen * Math.sin(perpAngle);
        x2 = midX - halfLen * Math.cos(perpAngle);
        y2 = midY - halfLen * Math.sin(perpAngle);
      } else {
        // æ–¹æ³•3: éšæœºé€‰åœ†å†…ä¸€ç‚¹ä½œä¸ºå¼¦ä¸­ç‚¹
        let px, py;
        do {
          px = (Math.random() - 0.5) * 2 * r;
          py = (Math.random() - 0.5) * 2 * r;
        } while (px*px + py*py > r*r);
        
        const midX = cx + px;
        const midY = cy + py;
        const dist = Math.sqrt(px*px + py*py);
        
        if (dist < 0.01) {
          // ä¸­ç‚¹åœ¨åœ†å¿ƒï¼Œå¼¦æ˜¯ç›´å¾„
          const angle = Math.random() * Math.PI;
          x1 = cx + r * Math.cos(angle);
          y1 = cy + r * Math.sin(angle);
          x2 = cx - r * Math.cos(angle);
          y2 = cy - r * Math.sin(angle);
        } else {
          const halfLen = Math.sqrt(r*r - dist*dist);
          const perpAngle = Math.atan2(py, px) + Math.PI/2;
          x1 = midX + halfLen * Math.cos(perpAngle);
          y1 = midY + halfLen * Math.sin(perpAngle);
          x2 = midX - halfLen * Math.cos(perpAngle);
          y2 = midY - halfLen * Math.sin(perpAngle);
        }
      }
      
      chordLength = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
      const isLong = chordLength > triangleSide;
      
      bertrandStats.total++;
      if (isLong) bertrandStats.long++;
      
      if (animate) {
        chord.setAttribute('x1', x1);
        chord.setAttribute('y1', y1);
        chord.setAttribute('x2', x2);
        chord.setAttribute('y2', y2);
        chord.setAttribute('stroke', isLong ? '#4ade80' : '#f87171');
      }
      
      updateBertrandStats();
    }
    
    function drawBertrandMany(times) {
      for (let i = 0; i < times; i++) {
        drawBertrandChord(false);
      }
      // æœ€åç”»ä¸€æ¡æ˜¾ç¤º
      drawBertrandChord(true);
    }
    
    function updateBertrandStats() {
      document.getElementById('bertrandTotal').textContent = bertrandStats.total;
      document.getElementById('bertrandLong').textContent = bertrandStats.long;
      if (bertrandStats.total > 0) {
        document.getElementById('bertrandProb').textContent = (bertrandStats.long / bertrandStats.total * 100).toFixed(1) + '%';
      }
      
      const method = document.getElementById('bertrandMethod').value;
      const theories = { '1': '1/3', '2': '1/2', '3': '1/4' };
      document.getElementById('bertrandTheory').textContent = theories[method];
    }
    
    function resetBertrand() {
      bertrandStats = { total: 0, long: 0 };
      document.getElementById('bertrandTotal').textContent = '0';
      document.getElementById('bertrandLong').textContent = '0';
      document.getElementById('bertrandProb').textContent = '-';
      const chord = document.getElementById('bertrandChord');
      chord.setAttribute('x1', 125);
      chord.setAttribute('y1', 25);
      chord.setAttribute('x2', 212);
      chord.setAttribute('y2', 175);
      chord.setAttribute('stroke', '#f093fb');
    }
    
    document.getElementById('bertrandMethod').addEventListener('change', resetBertrand);
    
    // ========== 6. ç­‰å¾…æ—¶é—´æ‚–è®º ==========
    let busStats = { total: 0, waitSum: 0, maxWait: 0 };
    
    function generateBusInterval() {
      const dist = document.getElementById('busDistribution').value;
      if (dist === 'fixed') {
        return 10;
      } else if (dist === 'uniform') {
        return 5 + Math.random() * 10;
      } else {
        // æŒ‡æ•°åˆ†å¸ƒï¼Œå¹³å‡10åˆ†é’Ÿ
        return -10 * Math.log(Math.random());
      }
    }
    
    function simulateBusWait(animate = true) {
      // ç”Ÿæˆä¸€å¤©çš„å…¬äº¤æ—¶åˆ»è¡¨ï¼ˆ24å°æ—¶ = 1440åˆ†é’Ÿï¼‰
      const intervals = [];
      let time = 0;
      while (time < 1440) {
        const interval = generateBusInterval();
        intervals.push(interval);
        time += interval;
      }
      
      // éšæœºåˆ°è¾¾æ—¶é—´
      const arrivalTime = Math.random() * 1440;
      
      // è®¡ç®—ç­‰å¾…æ—¶é—´
      let cumTime = 0;
      let waitTime = 0;
      for (const interval of intervals) {
        if (cumTime + interval > arrivalTime) {
          waitTime = cumTime + interval - arrivalTime;
          break;
        }
        cumTime += interval;
      }
      
      busStats.total++;
      busStats.waitSum += waitTime;
      if (waitTime > busStats.maxWait) busStats.maxWait = waitTime;
      
      if (animate) {
        document.getElementById('waitTimeDisplay').textContent = `æœ¬æ¬¡ç­‰å¾…: ${waitTime.toFixed(1)} åˆ†é’Ÿ`;
        const progress = Math.min(waitTime / 20 * 100, 100);
        document.getElementById('waitProgress').style.width = progress + '%';
      }
      
      updateBusStats();
    }
    
    function simulateBusWaitMany(times) {
      for (let i = 0; i < times; i++) {
        simulateBusWait(false);
      }
      document.getElementById('waitTimeDisplay').textContent = `å·²æ¨¡æ‹Ÿ ${times} æ¬¡`;
    }
    
    function updateBusStats() {
      document.getElementById('busSimCount').textContent = busStats.total;
      if (busStats.total > 0) {
        document.getElementById('busAvgWait').textContent = (busStats.waitSum / busStats.total).toFixed(1) + 'åˆ†é’Ÿ';
      }
      document.getElementById('busMaxWait').textContent = busStats.maxWait.toFixed(1) + 'åˆ†é’Ÿ';
    }
    
    function updateBusTheory() {
      const dist = document.getElementById('busDistribution').value;
      const theories = {
        'fixed': '5åˆ†é’Ÿ',
        'uniform': '5.83åˆ†é’Ÿ',
        'exponential': '10åˆ†é’Ÿ'
      };
      document.getElementById('busTheoryWait').textContent = theories[dist];
      resetBusWait();
    }
    
    function resetBusWait() {
      busStats = { total: 0, waitSum: 0, maxWait: 0 };
      document.getElementById('busSimCount').textContent = '0';
      document.getElementById('busAvgWait').textContent = '-';
      document.getElementById('busMaxWait').textContent = '-';
      document.getElementById('waitProgress').style.width = '0%';
      document.getElementById('waitTimeDisplay').textContent = 'æ¨¡æ‹Ÿä¸­...';
    }
  </script>
</body>
</html>
