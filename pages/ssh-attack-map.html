<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…¨çƒSSHæ”»å‡»åœ°å›¾ - è°åœ¨æ‰«ä½ çš„æœåŠ¡å™¨ï¼Ÿ</title>
  <script src="../components/header.js" defer></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: #0a0a0f;
      min-height: 100vh;
      color: #e4e4e4;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    
    .header { text-align: center; margin: 20px 0 30px; }
    .header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ff4444, #ff8800, #ff4444);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .header p { color: rgba(255,255,255,0.5); margin-top: 10px; font-size: 14px; }

    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .stat-card .value {
      font-size: 2rem;
      font-weight: 700;
      color: #ff4444;
      font-family: 'Monaco', 'Consolas', monospace;
    }
    .stat-card .label {
      color: rgba(255,255,255,0.5);
      font-size: 12px;
      margin-top: 5px;
    }
    .stat-card.highlight { border-color: rgba(255,136,0,0.3); }
    .stat-card.highlight .value { color: #ff8800; }

    /* åœ°å›¾ */
    .map-section {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    #map { height: 450px; background: #1a1a2e; }
    .leaflet-container { background: #1a1a2e; }
    .leaflet-popup-content-wrapper {
      background: rgba(20,20,30,0.95);
      color: #e4e4e4;
      border-radius: 10px;
      border: 1px solid rgba(255,68,68,0.3);
    }
    .leaflet-popup-tip { background: rgba(20,20,30,0.95); }
    .leaflet-popup-content { margin: 12px 15px; font-size: 13px; }

    /* åŒæ å¸ƒå±€ */
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    @media (max-width: 900px) {
      .two-col { grid-template-columns: 1fr; }
    }

    .card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
    }
    .card-title {
      color: #ff8800;
      font-size: 14px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* æ—¶é—´åˆ†å¸ƒå›¾ */
    .time-chart {
      display: flex;
      align-items: flex-end;
      height: 120px;
      gap: 2px;
    }
    .time-bar {
      flex: 1;
      background: linear-gradient(180deg, #ff4444, #ff8800);
      border-radius: 2px 2px 0 0;
      min-height: 2px;
      transition: height 0.5s;
      cursor: pointer;
    }
    .time-bar:hover { opacity: 0.7; }
    .time-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 11px;
      color: rgba(255,255,255,0.4);
    }

    /* å›½å®¶æ’è¡Œ */
    .country-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .country-item:last-child { border-bottom: none; }
    .country-item .rank {
      width: 20px;
      color: rgba(255,255,255,0.4);
      font-size: 12px;
    }
    .country-item .name {
      flex: 1;
      font-size: 13px;
    }
    .country-item .bar-bg {
      width: 100px;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }
    .country-item .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff4444, #ff8800);
      border-radius: 3px;
    }
    .country-item .count {
      width: 50px;
      text-align: right;
      color: #ff8800;
      font-size: 12px;
    }

    /* IPåˆ—è¡¨ */
    .list-section {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .search-box input {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 8px 15px;
      color: white;
      font-size: 13px;
      width: 200px;
    }
    .search-box input::placeholder { color: rgba(255,255,255,0.3); }
    .search-box input:focus { outline: none; border-color: rgba(255,68,68,0.5); }

    .ip-table { width: 100%; border-collapse: collapse; }
    .ip-table th {
      text-align: left;
      padding: 10px 12px;
      background: rgba(0,0,0,0.2);
      color: rgba(255,255,255,0.6);
      font-size: 12px;
      font-weight: 500;
    }
    .ip-table td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      font-size: 13px;
    }
    .ip-table tr:hover td { background: rgba(255,68,68,0.05); }
    .ip-table .ip { font-family: 'Monaco', 'Consolas', monospace; color: #ff4444; }
    .ip-table .count { color: #ff8800; font-weight: 600; }
    .ip-table .country { color: rgba(255,255,255,0.6); }
    .ip-table .time { color: rgba(255,255,255,0.4); }
    
    .table-container { max-height: 400px; overflow-y: auto; }
    .table-container::-webkit-scrollbar { width: 6px; }
    .table-container::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 3px; }
    .table-container::-webkit-scrollbar-thumb { background: rgba(255,68,68,0.3); border-radius: 3px; }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }
    .pagination button {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }
    .pagination button:hover:not(:disabled) { background: rgba(255,68,68,0.2); }
    .pagination button:disabled { opacity: 0.3; cursor: not-allowed; }
    .pagination .page-info { color: rgba(255,255,255,0.5); font-size: 13px; }

    /* è§£é‡Š */
    .explanation {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 25px;
      line-height: 1.8;
    }
    .explanation h3 { color: #ff8800; font-size: 16px; margin-bottom: 15px; }
    .explanation p { color: rgba(255,255,255,0.7); margin-bottom: 12px; font-size: 14px; }
    .explanation ul { color: rgba(255,255,255,0.7); margin: 10px 0 10px 20px; font-size: 14px; }
    .explanation li { margin-bottom: 8px; }
    .key-point {
      background: rgba(255,68,68,0.1);
      border-left: 3px solid #ff4444;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 10px 10px 0;
    }
    .key-point strong { color: #ff4444; }
    .code-block {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 13px;
      color: #4ade80;
      margin: 10px 0;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: rgba(255,255,255,0.5);
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255,68,68,0.2);
      border-top-color: #ff4444;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    @media (max-width: 600px) {
      .header h1 { font-size: 1.4rem; }
      .stat-card .value { font-size: 1.5rem; }
      .search-box { display: none; }
      #map { height: 300px; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸŒ å…¨çƒSSHæ”»å‡»å®æ—¶åœ°å›¾</h1>
    <p>å¯è§†åŒ–å±•ç¤ºæ­£åœ¨æ‰«ææœåŠ¡å™¨çš„IPæ¥æºåˆ†å¸ƒ</p>
  </div>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <div class="stats-row">
    <div class="stat-card highlight">
      <div class="value" id="totalIPs">-</div>
      <div class="label">æ”»å‡»IPæ€»æ•°</div>
    </div>
    <div class="stat-card">
      <div class="value" id="totalAttempts">-</div>
      <div class="label">æ€»å°è¯•æ¬¡æ•°</div>
    </div>
    <div class="stat-card">
      <div class="value" id="countryCount">-</div>
      <div class="label">æ¥æºå›½å®¶</div>
    </div>
    <div class="stat-card">
      <div class="value" id="avgAttempts">-</div>
      <div class="label">å¹³å‡å°è¯•/IP</div>
    </div>
    <div class="stat-card">
      <div class="value" id="todayCount">-</div>
      <div class="label">ä»Šæ—¥æ–°å¢</div>
    </div>
  </div>

  <!-- åœ°å›¾ -->
  <div class="map-section">
    <div id="map"></div>
  </div>

  <!-- åŒæ ï¼šè¶‹åŠ¿å›¾ + å›½å®¶æ’è¡Œ -->
  <div class="two-col">
    <div class="card">
      <div class="card-title">ğŸ“ˆ æœ€è¿‘30å¤©æ”»å‡»è¶‹åŠ¿</div>
      <div class="time-chart" id="timeChart"></div>
      <div class="time-labels">
        <span id="chartStart">-</span>
        <span id="chartEnd">ä»Šå¤©</span>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ† æ”»å‡»æ¥æºå›½å®¶ TOP 10</div>
      <div id="countryRank">
        <div class="loading"><div class="spinner"></div></div>
      </div>
    </div>
  </div>

  <!-- IPåˆ—è¡¨ -->
  <div class="list-section">
    <div class="list-header">
      <div class="card-title" style="margin:0;">ğŸ”¥ æ”»å‡»IPåˆ—è¡¨</div>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="æœç´¢IPåœ°å€...">
      </div>
    </div>
    <div class="table-container">
      <table class="ip-table">
        <thead>
          <tr>
            <th>IPåœ°å€</th>
            <th>å›½å®¶</th>
            <th>å°è¯•æ¬¡æ•°</th>
            <th>é¦–æ¬¡å‘ç°</th>
            <th>æœ€åæ´»åŠ¨</th>
          </tr>
        </thead>
        <tbody id="ipTableBody">
          <tr><td colspan="5"><div class="loading"><div class="spinner"></div>åŠ è½½ä¸­...</div></td></tr>
        </tbody>
      </table>
    </div>
    <div class="pagination">
      <button id="prevBtn" disabled>ä¸Šä¸€é¡µ</button>
      <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ</span>
      <button id="nextBtn">ä¸‹ä¸€é¡µ</button>
    </div>
  </div>

  <!-- è§£é‡Š -->
  <div class="explanation">
    <h3>ğŸ¤” ä¸ºä»€ä¹ˆä½ çš„æœåŠ¡å™¨æ€»è¢«æ‰«æï¼Ÿ</h3>
    <p><strong>å› ä¸ºä½ çš„IPæ˜¯å…¬å¼€çš„ï¼Œè€Œäº’è”ç½‘ä¸Šæœ‰æ— æ•°è‡ªåŠ¨åŒ–æ‰«æç¨‹åºåœ¨24å°æ—¶ä¸é—´æ–­åœ°æ‰«ææ•´ä¸ªIPv4åœ°å€ç©ºé—´ã€‚</strong></p>
    <div class="key-point">
      <strong>IPv4åªæœ‰çº¦43äº¿ä¸ªåœ°å€</strong>ï¼Œä»¥ç°ä»£ç½‘ç»œé€Ÿåº¦ï¼Œä¸€å°æœºå™¨å‡ å°æ—¶å°±èƒ½æ‰«å®Œæ•´ä¸ªäº’è”ç½‘çš„22ç«¯å£ã€‚æ‰€ä»¥ä¸æ˜¯"ä¸ºä»€ä¹ˆæ‰«ä½ "ï¼Œè€Œæ˜¯"æ‰€æœ‰äººéƒ½åœ¨è¢«æ‰«"ã€‚
    </div>
    <h3>ğŸ›¡ï¸ å¦‚ä½•ä¿æŠ¤ä½ çš„æœåŠ¡å™¨ï¼Ÿ</h3>
    <p><strong>1. ç¦ç”¨å¯†ç ç™»å½•ï¼Œåªç”¨SSHå¯†é’¥</strong></p>
    <div class="code-block">PasswordAuthentication no
PubkeyAuthentication yes</div>
    <p><strong>2. å®‰è£…fail2banè‡ªåŠ¨å°ç¦</strong></p>
    <div class="code-block">apt install fail2ban</div>
    <p><strong>3. ä¿®æ”¹é»˜è®¤ç«¯å£</strong>ï¼ˆå‡å°‘90%æ‰«ææ—¥å¿—ï¼‰</p>
  </div>
</div>

<script>
let map;
let serverList = [];
let filteredData = [];
let currentPage = 1;
const pageSize = 50;

// åˆå§‹åŒ–åœ°å›¾
function initMap() {
  map = L.map('map', {
    center: [25, 0],
    zoom: 2,
    minZoom: 2,
    maxZoom: 8
  });
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap &copy; CARTO',
    subdomains: 'abcd'
  }).addTo(map);
}

// åŠ è½½æ•°æ®
async function loadData() {
  try {
    const response = await fetch('https://demo-api-mockserver.runnable.run/blockip/stats');
    const data = await response.json();
    
    // æ›´æ–°ç»Ÿè®¡
    document.getElementById('totalIPs').textContent = data.stats.totalIPs.toLocaleString();
    document.getElementById('totalAttempts').textContent = data.stats.totalAttempts.toLocaleString();
    document.getElementById('avgAttempts').textContent = data.stats.avgAttempts;
    document.getElementById('todayCount').textContent = data.stats.todayCount;
    document.getElementById('countryCount').textContent = data.stats.countryCount || '-';
    
    // æ›´æ–°è¶‹åŠ¿å›¾
    renderChart(data.daily);
    
    // æ›´æ–°å›½å®¶æ’è¡Œ
    renderCountryRank(data.countryRank);
    
    // æ›´æ–°åœ°å›¾æ ‡è®°
    renderMapMarkers(data.markers);
    
    // æ›´æ–°IPåˆ—è¡¨
    serverList = data.list;
    filteredData = [...serverList];
    renderTable();
    
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error);
    document.getElementById('ipTableBody').innerHTML = 
      '<tr><td colspan="5" style="text-align:center;color:#ff4444;padding:30px;">æ•°æ®åŠ è½½å¤±è´¥</td></tr>';
  }
}

// æ¸²æŸ“è¶‹åŠ¿å›¾
function renderChart(daily) {
  const chart = document.getElementById('timeChart');
  if (!daily || daily.length === 0) return;
  
  const maxCount = Math.max(...daily.map(d => d.count), 1);
  chart.innerHTML = daily.map(item => {
    const height = (item.count / maxCount) * 110;
    return `<div class="time-bar" style="height:${Math.max(height,2)}px" title="${item.date.slice(5)}: ${item.count}ä¸ª"></div>`;
  }).join('');
  
  document.getElementById('chartStart').textContent = daily[0].date.slice(5);
}

// æ¸²æŸ“å›½å®¶æ’è¡Œ
function renderCountryRank(countryRank) {
  const container = document.getElementById('countryRank');
  if (!countryRank || countryRank.length === 0) {
    container.innerHTML = '<div style="color:rgba(255,255,255,0.4);text-align:center;">æš‚æ— æ•°æ®</div>';
    return;
  }
  
  const maxCount = countryRank[0].count;
  container.innerHTML = countryRank.slice(0, 10).map((item, i) => `
    <div class="country-item">
      <span class="rank">${i + 1}</span>
      <span class="name">${item.country}</span>
      <div class="bar-bg"><div class="bar-fill" style="width:${item.count/maxCount*100}%"></div></div>
      <span class="count">${item.count}</span>
    </div>
  `).join('');
}

// æ¸²æŸ“åœ°å›¾æ ‡è®°
function renderMapMarkers(markers) {
  if (!markers || markers.length === 0) return;
  
  const maxAttempts = Math.max(...markers.map(m => m.attempts), 1);
  
  markers.forEach(marker => {
    if (marker.lat && marker.lng) {
      const radius = Math.max(5, Math.min(25, (marker.attempts / maxAttempts) * 25 + 5));
      
      L.circleMarker([marker.lat, marker.lng], {
        radius: radius,
        fillColor: '#ff4444',
        color: '#ff8800',
        weight: 1,
        opacity: 0.8,
        fillOpacity: 0.5
      })
      .bindPopup(`
        <div>
          <strong style="color:#ff8800">${marker.country}</strong><br>
          IPæ•°é‡: ${marker.count}<br>
          å°è¯•æ¬¡æ•°: ${marker.attempts}
        </div>
      `)
      .addTo(map);
    }
  });
}

// æ¸²æŸ“è¡¨æ ¼
function renderTable() {
  const start = (currentPage - 1) * pageSize;
  const pageData = filteredData.slice(start, start + pageSize);
  
  const tbody = document.getElementById('ipTableBody');
  if (pageData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:rgba(255,255,255,0.4);padding:30px;">æ²¡æœ‰åŒ¹é…çš„IP</td></tr>';
    return;
  }
  
  tbody.innerHTML = pageData.map(item => `
    <tr>
      <td class="ip">${item.ip}</td>
      <td class="country">${item.country || '-'}</td>
      <td class="count">${item.count}</td>
      <td class="time">${item.first}</td>
      <td class="time">${item.last}</td>
    </tr>
  `).join('');
  
  const totalPages = Math.ceil(filteredData.length / pageSize);
  document.getElementById('pageInfo').textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`;
  document.getElementById('prevBtn').disabled = currentPage === 1;
  document.getElementById('nextBtn').disabled = currentPage >= totalPages;
}

// æœç´¢
document.getElementById('searchInput').addEventListener('input', (e) => {
  const query = e.target.value.trim();
  filteredData = query ? serverList.filter(item => item.ip.includes(query)) : [...serverList];
  currentPage = 1;
  renderTable();
});

// åˆ†é¡µ
document.getElementById('prevBtn').addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderTable(); } });
document.getElementById('nextBtn').addEventListener('click', () => {
  if (currentPage < Math.ceil(filteredData.length / pageSize)) { currentPage++; renderTable(); }
});

// åˆå§‹åŒ–
initMap();
loadData();
</script>

</body>
</html>
