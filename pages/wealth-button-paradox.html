<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>50%è´¢å¯ŒæŒ‰é’®æ‚–è®º - è¯¥ä¸è¯¥æŒ‰ï¼Ÿ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .back-link {
      display: inline-block;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }
    .back-link:hover { text-decoration: underline; }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.8rem;
      background: linear-gradient(135deg, #ff6b6b, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      text-align: center;
      color: rgba(255,255,255,0.7);
      margin-bottom: 25px;
      font-size: 0.95rem;
    }
    .card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .question-box {
      background: linear-gradient(135deg, rgba(255,107,107,0.2), rgba(255,215,0,0.1));
      border-left: 4px solid #ff6b6b;
      padding: 15px 20px;
      border-radius: 0 12px 12px 0;
      margin-bottom: 20px;
      font-size: 1.05rem;
      line-height: 1.8;
    }
    .question-box strong { color: #ffd700; }
    
    /* æŒ‰é’®åŒºåŸŸ */
    .button-area {
      text-align: center;
      padding: 30px;
    }
    .big-button {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
      box-shadow: 0 10px 40px rgba(255, 107, 107, 0.4),
                  inset 0 -5px 20px rgba(0,0,0,0.2),
                  inset 0 5px 20px rgba(255,255,255,0.2);
      cursor: pointer;
      font-size: 1.3rem;
      font-weight: bold;
      color: white;
      transition: all 0.15s;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    .big-button:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 50px rgba(255, 107, 107, 0.5),
                  inset 0 -5px 20px rgba(0,0,0,0.2),
                  inset 0 5px 20px rgba(255,255,255,0.2);
    }
    .big-button:active {
      transform: scale(0.95);
      box-shadow: 0 5px 20px rgba(255, 107, 107, 0.3),
                  inset 0 5px 20px rgba(0,0,0,0.3);
    }
    .big-button:disabled {
      background: #666;
      box-shadow: none;
      cursor: not-allowed;
    }
    
    /* èµ„äº§æ˜¾ç¤º */
    .wealth-display {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .wealth-box {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 20px 30px;
      text-align: center;
      min-width: 200px;
    }
    .wealth-label {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      margin-bottom: 8px;
    }
    .wealth-value {
      font-size: 2rem;
      font-weight: bold;
      color: #4ade80;
      transition: all 0.3s;
    }
    .wealth-value.danger { color: #ff6b6b; }
    .wealth-value.warning { color: #ffd700; }
    
    /* å†å²è®°å½• */
    .history {
      max-height: 150px;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 0.9rem;
    }
    .history-item:last-child { border-bottom: none; }
    .history-item.win { color: #4ade80; }
    .history-item.lose { color: #ff6b6b; }
    
    /* ç»Ÿè®¡ */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      .stats { grid-template-columns: repeat(2, 1fr); }
    }
    .stat-box {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #ffd700;
    }
    .stat-label {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.5);
      margin-top: 5px;
    }
    
    /* æ§åˆ¶æŒ‰é’® */
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn-secondary:hover { background: rgba(255,255,255,0.2); }
    
    /* è¾“å…¥åŒº */
    .input-row {
      display: flex;
      gap: 15px;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .input-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .input-group label {
      color: rgba(255,255,255,0.7);
      font-size: 0.9rem;
    }
    .input-group input {
      width: 120px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      color: white;
      font-size: 1rem;
    }
    .input-group input:focus {
      outline: none;
      border-color: #ffd700;
    }
    
    /* å›¾è¡¨ */
    .chart-container {
      position: relative;
      height: 250px;
      margin-top: 20px;
    }
    
    /* æ‰¹é‡æ¨¡æ‹Ÿ */
    .batch-results {
      display: none;
      margin-top: 20px;
    }
    .batch-results.show { display: block; }
    .result-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    @media (max-width: 500px) {
      .result-grid { grid-template-columns: 1fr; }
    }
    .result-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .result-card h4 {
      color: rgba(255,255,255,0.6);
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    .result-card .big-num {
      font-size: 2.5rem;
      font-weight: bold;
    }
    .result-card .big-num.red { color: #ff6b6b; }
    .result-card .big-num.green { color: #4ade80; }
    .result-card .big-num.gold { color: #ffd700; }
    
    /* åˆ†æåŒº */
    .analysis {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }
    .analysis h3 {
      color: #ffd700;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    .analysis p {
      color: rgba(255,255,255,0.85);
      line-height: 1.8;
      margin-bottom: 12px;
    }
    .analysis .formula {
      background: rgba(255,255,255,0.1);
      padding: 12px 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      margin: 12px 0;
      overflow-x: auto;
    }
    .analysis .highlight { color: #ff6b6b; font-weight: bold; }
    .analysis .safe { color: #4ade80; font-weight: bold; }
    
    /* ç»“è®ºå¡ç‰‡ */
    .conclusion {
      background: linear-gradient(135deg, rgba(255,107,107,0.2), rgba(255,215,0,0.1));
      border: 2px solid #ff6b6b;
      border-radius: 16px;
      padding: 25px;
      text-align: center;
      margin-top: 20px;
    }
    .conclusion h3 {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: #ff6b6b;
    }
    .conclusion p {
      color: rgba(255,255,255,0.9);
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
    <h1>ğŸ”´ 50%è´¢å¯ŒæŒ‰é’®æ‚–è®º</h1>
    <p class="subtitle">æœŸæœ›å€¼ä¸ºæ­£ï¼Œä½†ä½ æ•¢æŒ‰å—ï¼Ÿ</p>
    
    <div class="card">
      <div class="question-box">
        <strong>é—®é¢˜ï¼š</strong>æœ‰ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰ä¸‹åï¼š<br>
        â€¢ <strong>50%</strong> æ¦‚ç‡ï¼šä½ çš„æ‰€æœ‰èµ„äº§ <strong>Ã—9</strong>ï¼ˆç¿»9å€ï¼‰<br>
        â€¢ <strong>50%</strong> æ¦‚ç‡ï¼šä½ çš„æ‰€æœ‰èµ„äº§ <strong>Ã—0.1</strong>ï¼ˆåªå‰©1/10ï¼‰<br><br>
        æœŸæœ›å€¼ = 0.5Ã—9 + 0.5Ã—0.1 = <strong>4.55</strong>ï¼Œæ˜¯æ­£çš„ï¼<br>
        ç†è®ºä¸Šæ— é™æŒ‰ä¸‹å»ï¼Œæ”¶ç›Šè¶‹å‘æ­£æ— ç©·ã€‚<br><br>
        <strong>é‚£ä¹ˆï¼Œè¿™ä¸ªæŒ‰é’®åº”è¯¥æŒ‰å—ï¼Ÿ</strong>
      </div>
      
      <div class="input-row">
        <div class="input-group">
          <label>åˆå§‹èµ„äº§ï¼š</label>
          <input type="number" id="initialWealth" value="100000" min="1">
          <span style="color: rgba(255,255,255,0.5);">å…ƒ</span>
        </div>
      </div>
      
      <div class="button-area">
        <button class="big-button" id="pressBtn" onclick="pressButton()">
          æŒ‰ä¸‹æŒ‰é’®<br>ğŸ°
        </button>
      </div>
      
      <div class="wealth-display">
        <div class="wealth-box">
          <div class="wealth-label">å½“å‰èµ„äº§</div>
          <div class="wealth-value" id="currentWealth">Â¥100,000</div>
        </div>
        <div class="wealth-box">
          <div class="wealth-label">ç´¯è®¡æ”¶ç›Šç‡</div>
          <div class="wealth-value" id="totalReturn">0%</div>
        </div>
      </div>
      
      <div class="stats">
        <div class="stat-box">
          <div class="stat-value" id="pressCount">0</div>
          <div class="stat-label">æŒ‰ä¸‹æ¬¡æ•°</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="winCount">0</div>
          <div class="stat-label">Ã—9 æ¬¡æ•°</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="loseCount">0</div>
          <div class="stat-label">Ã—0.1 æ¬¡æ•°</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="winRate">-</div>
          <div class="stat-label">å®é™…èƒœç‡</div>
        </div>
      </div>
      
      <div class="history" id="history">
        <div style="color: rgba(255,255,255,0.5); text-align: center;">æŒ‰ä¸‹æŒ‰é’®å¼€å§‹...</div>
      </div>
      
      <div class="controls">
        <button class="btn btn-secondary" onclick="pressMultiple(10)">è¿æŒ‰ 10 æ¬¡</button>
        <button class="btn btn-secondary" onclick="pressMultiple(50)">è¿æŒ‰ 50 æ¬¡</button>
        <button class="btn btn-secondary" onclick="resetGame()">ğŸ”„ é‡ç½®</button>
      </div>
      
      <div class="chart-container">
        <canvas id="wealthChart"></canvas>
      </div>
    </div>
    
    <div class="card">
      <h2 style="margin-bottom: 15px; color: #ffd700;">ğŸ² è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿï¼š1000ä¸ªäººå„æŒ‰100æ¬¡</h2>
      <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
        è®©æˆ‘ä»¬æ¨¡æ‹Ÿ1000ä¸ªäººï¼Œæ¯äººåˆå§‹10ä¸‡ï¼Œå„æŒ‰100æ¬¡æŒ‰é’®ï¼Œçœ‹çœ‹æœ€ç»ˆç»“æœåˆ†å¸ƒ
      </p>
      
      <div class="controls">
        <button class="btn btn-secondary" onclick="runBatchSimulation()" id="batchBtn">ğŸš€ è¿è¡Œæ¨¡æ‹Ÿ</button>
      </div>
      
      <div class="batch-results" id="batchResults">
        <div class="result-grid">
          <div class="result-card">
            <h4>ğŸ’€ ç ´äº§ç‡ï¼ˆèµ„äº§<1å…ƒï¼‰</h4>
            <div class="big-num red" id="bankruptRate">-</div>
          </div>
          <div class="result-card">
            <h4>ğŸ“ˆ ç›ˆåˆ©ç‡ï¼ˆèµ„äº§>åˆå§‹ï¼‰</h4>
            <div class="big-num green" id="profitRate">-</div>
          </div>
          <div class="result-card">
            <h4>ğŸ’° ä¸­ä½æ•°èµ„äº§</h4>
            <div class="big-num gold" id="medianWealth">-</div>
          </div>
          <div class="result-card">
            <h4>ğŸ¯ å¹³å‡èµ„äº§</h4>
            <div class="big-num gold" id="avgWealth">-</div>
          </div>
        </div>
        
        <div class="chart-container" style="height: 200px; margin-top: 20px;">
          <canvas id="distributionChart"></canvas>
        </div>
      </div>
    </div>

    <div class="card analysis">
      <h3>ğŸ“ æ•°å­¦åˆ†æï¼šä¸ºä»€ä¹ˆæœŸæœ›å€¼éª—äº†ä½ </h3>
      
      <p><strong>1. ç®—æœ¯æœŸæœ› vs å‡ ä½•æœŸæœ›</strong></p>
      <p>
        ç®—æœ¯æœŸæœ›ï¼ˆä½ ç®—çš„é‚£ä¸ªï¼‰ï¼šE = 0.5Ã—9 + 0.5Ã—0.1 = <span class="safe">4.55</span><br>
        çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œæ¯æŒ‰ä¸€æ¬¡"å¹³å‡"èƒ½èµš3.55å€ï¼
      </p>
      
      <p><strong>2. ä½†è´¢å¯Œæ˜¯ä¹˜æ³•ç´¯ç§¯çš„</strong></p>
      <p>
        æŒ‰ä¸¤æ¬¡çš„å¯èƒ½ç»“æœï¼š<br>
        â€¢ 9Ã—9 = 81ï¼ˆæ¦‚ç‡25%ï¼‰<br>
        â€¢ 9Ã—0.1 = 0.9ï¼ˆæ¦‚ç‡25%ï¼‰<br>
        â€¢ 0.1Ã—9 = 0.9ï¼ˆæ¦‚ç‡25%ï¼‰<br>
        â€¢ 0.1Ã—0.1 = 0.01ï¼ˆæ¦‚ç‡25%ï¼‰
      </p>
      <div class="formula">
        å‡ ä½•æœŸæœ› = (9 Ã— 0.1)^0.5 = 0.9^0.5 â‰ˆ <span class="highlight">0.949</span>
      </div>
      <p>
        å‡ ä½•æœŸæœ› < 1ï¼è¿™æ„å‘³ç€<span class="highlight">æ¯æŒ‰ä¸€æ¬¡ï¼Œä½ çš„è´¢å¯Œä¸­ä½æ•°éƒ½åœ¨ç¼©æ°´</span>ã€‚
      </p>
      
      <p><strong>3. å‡¯åˆ©å…¬å¼çš„åˆ¤æ–­</strong></p>
      <p>å‡¯åˆ©å…¬å¼ç”¨äºåˆ¤æ–­ä¸€ä¸ªèµŒå±€æ˜¯å¦å€¼å¾—ä¸‹æ³¨ï¼š</p>
      <div class="formula">
        f* = (p Ã— b - q) / b<br>
        å…¶ä¸­ p=0.5ï¼ˆèµ¢çš„æ¦‚ç‡ï¼‰ï¼Œb=8ï¼ˆå‡€èµ”ç‡ï¼Œèµ¢äº†èµš8å€ï¼‰ï¼Œq=0.5ï¼ˆè¾“çš„æ¦‚ç‡ï¼‰<br>
        f* = (0.5 Ã— 8 - 0.5) / 8 = 0.4375
      </div>
      <p>
        å‡¯åˆ©å…¬å¼å»ºè®®ä½ åªæŠ¼ <span class="safe">43.75%</span> çš„èµ„äº§ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ï¼<br>
        ä½†è¿™ä¸ªæŒ‰é’®å¼ºåˆ¶ä½ æŠ¼ä¸Š100%ï¼Œè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ã€‚
      </p>
      
      <p><strong>4. å¤§æ•°å®šå¾‹çš„é™·é˜±</strong></p>
      <p>
        æŒ‰ n æ¬¡åï¼ŒæœŸæœ›èµ¢ n/2 æ¬¡ï¼Œè¾“ n/2 æ¬¡ã€‚<br>
        æœ€ç»ˆèµ„äº§ = åˆå§‹ Ã— 9^(n/2) Ã— 0.1^(n/2) = åˆå§‹ Ã— <span class="highlight">0.9^n</span>
      </p>
      <div class="formula">
        æŒ‰10æ¬¡ï¼š0.9^10 â‰ˆ 0.35ï¼ˆå‰©35%ï¼‰<br>
        æŒ‰50æ¬¡ï¼š0.9^50 â‰ˆ 0.005ï¼ˆå‰©0.5%ï¼‰<br>
        æŒ‰100æ¬¡ï¼š0.9^100 â‰ˆ 0.00003ï¼ˆå‡ ä¹å½’é›¶ï¼‰
      </div>
    </div>
    
    <div class="card conclusion">
      <h3>ğŸ¯ ç»“è®ºï¼šä¸è¯¥æŒ‰</h3>
      <p>
        è¿™ä¸ªæŒ‰é’®æ˜¯ä¸€ä¸ªç»å…¸çš„<strong>ã€ŒæœŸæœ›å€¼é™·é˜±ã€</strong>ã€‚<br><br>
        ç®—æœ¯æœŸæœ›ä¸ºæ­£ï¼Œä½†å‡ ä½•æœŸæœ›ä¸ºè´Ÿã€‚<br>
        å°‘æ•°äººä¼šæš´å¯Œï¼ˆè¿ç»­Ã—9ï¼‰ï¼Œä½†<strong>ç»å¤§å¤šæ•°äººä¼šç ´äº§</strong>ã€‚<br><br>
        å¹³å‡å€¼è¢«æå°‘æ•°å¹¸è¿å„¿æ‹‰é«˜ï¼Œä½†ä½ å¤§æ¦‚ç‡ä¸æ˜¯é‚£ä¸ªå¹¸è¿å„¿ã€‚<br>
        è¿™å°±æ˜¯ä¸ºä»€ä¹ˆèµŒåœºæ°¸è¿œèµ¢â€”â€”ä»–ä»¬ç©çš„æ˜¯å¤§æ•°å®šå¾‹ï¼Œè€Œä½ åªæœ‰ä¸€æ¡å‘½ã€‚<br><br>
        <span style="color: #ffd700;">ã€ŒæœŸæœ›å€¼ä¸ºæ­£ã€â‰ ã€Œåº”è¯¥å‚ä¸ã€</span><br>
        <span style="color: rgba(255,255,255,0.6);">å½“èµŒæ³¨æ˜¯ä½ çš„å…¨éƒ¨æ—¶ï¼Œä¸­ä½æ•°æ¯”å¹³å‡æ•°æ›´é‡è¦ã€‚</span>
      </p>
    </div>
  </div>

  <script>
    let wealth = 100000;
    let initialWealth = 100000;
    let pressCount = 0;
    let winCount = 0;
    let loseCount = 0;
    let history = [];
    let wealthHistory = [100000];
    let chart = null;
    let distributionChart = null;
    
    function formatMoney(num) {
      if (num >= 1e12) return 'Â¥' + (num/1e12).toFixed(2) + 'ä¸‡äº¿';
      if (num >= 1e8) return 'Â¥' + (num/1e8).toFixed(2) + 'äº¿';
      if (num >= 1e4) return 'Â¥' + (num/1e4).toFixed(2) + 'ä¸‡';
      if (num >= 1) return 'Â¥' + num.toFixed(2);
      if (num >= 0.01) return 'Â¥' + num.toFixed(4);
      return 'Â¥' + num.toExponential(2);
    }
    
    function updateDisplay() {
      const wealthEl = document.getElementById('currentWealth');
      wealthEl.textContent = formatMoney(wealth);
      
      // é¢œè‰²å˜åŒ–
      wealthEl.classList.remove('danger', 'warning');
      if (wealth < initialWealth * 0.1) {
        wealthEl.classList.add('danger');
      } else if (wealth < initialWealth) {
        wealthEl.classList.add('warning');
      }
      
      // æ”¶ç›Šç‡
      const returnRate = ((wealth / initialWealth - 1) * 100);
      const returnEl = document.getElementById('totalReturn');
      if (returnRate >= 0) {
        returnEl.textContent = '+' + returnRate.toFixed(2) + '%';
        returnEl.classList.remove('danger');
      } else {
        returnEl.textContent = returnRate.toFixed(2) + '%';
        returnEl.classList.add('danger');
      }
      
      document.getElementById('pressCount').textContent = pressCount;
      document.getElementById('winCount').textContent = winCount;
      document.getElementById('loseCount').textContent = loseCount;
      document.getElementById('winRate').textContent = pressCount > 0 
        ? (winCount / pressCount * 100).toFixed(1) + '%' 
        : '-';
      
      updateChart();
    }
    
    function pressButton() {
      const win = Math.random() < 0.5;
      const oldWealth = wealth;
      
      if (win) {
        wealth *= 9;
        winCount++;
        history.unshift({ win: true, before: oldWealth, after: wealth, round: pressCount + 1 });
      } else {
        wealth *= 0.1;
        loseCount++;
        history.unshift({ win: false, before: oldWealth, after: wealth, round: pressCount + 1 });
      }
      
      pressCount++;
      wealthHistory.push(wealth);
      
      updateDisplay();
      renderHistory();
      
      // æŒ‰é’®åŠ¨ç”»
      const btn = document.getElementById('pressBtn');
      btn.style.background = win 
        ? 'linear-gradient(145deg, #4ade80, #22c55e)' 
        : 'linear-gradient(145deg, #ff6b6b, #ee5a5a)';
      setTimeout(() => {
        btn.style.background = 'linear-gradient(145deg, #ff6b6b, #ee5a5a)';
      }, 300);
    }
    
    function pressMultiple(times) {
      for (let i = 0; i < times; i++) {
        pressButton();
      }
    }
    
    function renderHistory() {
      const container = document.getElementById('history');
      if (history.length === 0) {
        container.innerHTML = '<div style="color: rgba(255,255,255,0.5); text-align: center;">æŒ‰ä¸‹æŒ‰é’®å¼€å§‹...</div>';
        return;
      }
      
      container.innerHTML = history.slice(0, 20).map(h => `
        <div class="history-item ${h.win ? 'win' : 'lose'}">
          <span>ç¬¬${h.round}æ¬¡ï¼š${h.win ? 'Ã—9 ğŸ‰' : 'Ã—0.1 ğŸ’€'}</span>
          <span>${formatMoney(h.before)} â†’ ${formatMoney(h.after)}</span>
        </div>
      `).join('');
    }
    
    function updateChart() {
      const ctx = document.getElementById('wealthChart').getContext('2d');
      
      if (chart) chart.destroy();
      
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: wealthHistory.map((_, i) => i),
          datasets: [{
            label: 'èµ„äº§',
            data: wealthHistory,
            borderColor: '#ffd700',
            backgroundColor: 'rgba(255, 215, 0, 0.1)',
            fill: true,
            tension: 0.1,
            pointRadius: wealthHistory.length > 50 ? 0 : 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: {
              title: { display: true, text: 'æŒ‰ä¸‹æ¬¡æ•°', color: 'rgba(255,255,255,0.5)' },
              grid: { color: 'rgba(255,255,255,0.05)' },
              ticks: { color: 'rgba(255,255,255,0.4)' }
            },
            y: {
              type: 'logarithmic',
              title: { display: true, text: 'èµ„äº§ï¼ˆå¯¹æ•°ï¼‰', color: 'rgba(255,255,255,0.5)' },
              grid: { color: 'rgba(255,255,255,0.05)' },
              ticks: { 
                color: 'rgba(255,255,255,0.4)',
                callback: v => formatMoney(v)
              }
            }
          }
        }
      });
    }
    
    function resetGame() {
      initialWealth = parseFloat(document.getElementById('initialWealth').value) || 100000;
      wealth = initialWealth;
      pressCount = 0;
      winCount = 0;
      loseCount = 0;
      history = [];
      wealthHistory = [initialWealth];
      updateDisplay();
      renderHistory();
    }
    
    function runBatchSimulation() {
      const btn = document.getElementById('batchBtn');
      btn.disabled = true;
      btn.textContent = 'æ¨¡æ‹Ÿä¸­...';
      
      setTimeout(() => {
        const people = 1000;
        const presses = 100;
        const initial = 100000;
        const results = [];
        
        for (let i = 0; i < people; i++) {
          let w = initial;
          for (let j = 0; j < presses; j++) {
            w *= Math.random() < 0.5 ? 9 : 0.1;
          }
          results.push(w);
        }
        
        results.sort((a, b) => a - b);
        
        const bankruptCount = results.filter(w => w < 1).length;
        const profitCount = results.filter(w => w > initial).length;
        const median = results[Math.floor(people / 2)];
        const avg = results.reduce((a, b) => a + b, 0) / people;
        
        document.getElementById('bankruptRate').textContent = (bankruptCount / people * 100).toFixed(1) + '%';
        document.getElementById('profitRate').textContent = (profitCount / people * 100).toFixed(1) + '%';
        document.getElementById('medianWealth').textContent = formatMoney(median);
        document.getElementById('avgWealth').textContent = formatMoney(avg);
        
        document.getElementById('batchResults').classList.add('show');
        
        // ç»˜åˆ¶åˆ†å¸ƒå›¾
        drawDistribution(results, initial);
        
        btn.disabled = false;
        btn.textContent = 'ğŸš€ é‡æ–°æ¨¡æ‹Ÿ';
      }, 100);
    }
    
    function drawDistribution(results, initial) {
      const ctx = document.getElementById('distributionChart').getContext('2d');
      
      if (distributionChart) distributionChart.destroy();
      
      // åˆ†æ¡¶ç»Ÿè®¡
      const buckets = {
        'ç ´äº§(<1)': 0,
        'æƒ¨æ·¡(1-1k)': 0,
        'äºæŸ(1k-10w)': 0,
        'ä¿æœ¬(10w-100w)': 0,
        'å°èµš(100w-1kw)': 0,
        'å¤§èµš(>1kw)': 0
      };
      
      results.forEach(w => {
        if (w < 1) buckets['ç ´äº§(<1)']++;
        else if (w < 1000) buckets['æƒ¨æ·¡(1-1k)']++;
        else if (w < 100000) buckets['äºæŸ(1k-10w)']++;
        else if (w < 1000000) buckets['ä¿æœ¬(10w-100w)']++;
        else if (w < 10000000) buckets['å°èµš(100w-1kw)']++;
        else buckets['å¤§èµš(>1kw)']++;
      });
      
      distributionChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(buckets),
          datasets: [{
            data: Object.values(buckets),
            backgroundColor: [
              '#ff6b6b',
              '#ff8c8c',
              '#ffd700',
              '#90EE90',
              '#4ade80',
              '#22c55e'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { color: 'rgba(255,255,255,0.6)', font: { size: 10 } }
            },
            y: {
              grid: { color: 'rgba(255,255,255,0.05)' },
              ticks: { color: 'rgba(255,255,255,0.4)' }
            }
          }
        }
      });
    }
    
    // åˆå§‹åŒ–
    document.getElementById('initialWealth').addEventListener('change', resetGame);
    updateDisplay();
    renderHistory();
  </script>
</body>
</html>
