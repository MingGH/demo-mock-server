<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1/100 vs 6/600ï¼šæ¦‚ç‡çœŸçš„ä¸€æ ·å—ï¼Ÿ</title>
  <script src="../components/header.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      padding: 20px;
      color: #e0e0e0;
    }

    .container { max-width: 1200px; margin: 0 auto; }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 30px 20px;
    }

    .header h1 {
      font-size: 2.5em;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes shimmer { to { background-position: 200% center; } }

    .header p { font-size: 1.1em; color: #b0b0b0; line-height: 1.6; }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .card h2 { color: #ffd700; margin-bottom: 20px; font-size: 1.5em; }

    .simulator {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .simulator { grid-template-columns: 1fr; }
      .header h1 { font-size: 1.8em; }
      .lottery-compare { grid-template-columns: 1fr !important; }
    }

    .control-panel {
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
    }

    .control-group { margin-bottom: 20px; }

    .control-group label {
      display: block;
      margin-bottom: 8px;
      color: #ffd700;
      font-weight: 500;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: #ffd700;
      cursor: pointer;
    }

    .value-display { color: #fff; font-size: 1.1em; margin-top: 5px; }

    button {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #1a1a2e;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      width: 100%;
      margin-top: 10px;
    }

    button:hover { transform: translateY(-2px); }
    button:active { transform: translateY(0); }

    .btn-blue {
      background: linear-gradient(135deg, #4a90e2, #357abd);
      color: white;
    }

    .chart-container {
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
      height: 400px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-box {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-label { color: #b0b0b0; font-size: 0.9em; margin-bottom: 5px; }
    .stat-value { color: #ffd700; font-size: 1.5em; font-weight: bold; }
    .stat-value.negative { color: #ff4444; }
    .stat-value.positive { color: #44ff44; }

    .insight {
      background: rgba(255, 215, 0, 0.1);
      border-left: 4px solid #ffd700;
      padding: 15px;
      margin-top: 20px;
      border-radius: 5px;
    }

    .insight-title { color: #ffd700; font-weight: bold; margin-bottom: 10px; }
    .insight-text { color: #e0e0e0; line-height: 1.6; }

    /* å½©ç¥¨å¯¹æ¯”å¡ç‰‡ */
    .lottery-compare {
      display: grid;
      grid-template-columns: 1fr 60px 1fr;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
    }

    .lottery-card {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid transparent;
      transition: border-color 0.3s;
    }

    .lottery-card.a { border-color: rgba(255, 107, 107, 0.5); }
    .lottery-card.b { border-color: rgba(78, 205, 196, 0.5); }

    .lottery-card h3 { font-size: 1.3em; margin-bottom: 10px; }
    .lottery-card.a h3 { color: #ff6b6b; }
    .lottery-card.b h3 { color: #4ecdc4; }

    .lottery-fraction {
      font-size: 2.5em;
      font-weight: bold;
      margin: 15px 0;
    }

    .lottery-card.a .lottery-fraction { color: #ff6b6b; }
    .lottery-card.b .lottery-fraction { color: #4ecdc4; }

    .lottery-percent { font-size: 1.2em; color: #b0b0b0; }

    .vs-badge {
      font-size: 1.5em;
      font-weight: bold;
      color: #ffd700;
      text-align: center;
    }

    .lottery-result {
      font-size: 1.1em;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .lottery-result .wins { font-size: 1.8em; font-weight: bold; }
    .lottery-card.a .wins { color: #ff6b6b; }
    .lottery-card.b .wins { color: #4ecdc4; }

    /* ç³–æœç½å®éªŒ */
    .jar-experiment {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .jar-experiment { grid-template-columns: 1fr; }
    }

    .jar {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .jar:hover { transform: translateY(-3px); border-color: rgba(255, 215, 0, 0.5); }
    .jar.selected { border-color: #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }

    .jar h3 { color: #ffd700; margin-bottom: 10px; }

    .candy-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 4px;
      margin: 15px 0;
      min-height: 60px;
    }

    .candy {
      width: 20px; height: 20px;
      border-radius: 50%;
      background: #666;
      transition: all 0.3s;
    }

    .candy.winner { background: #ff4444; box-shadow: 0 0 6px rgba(255, 68, 68, 0.5); }

    .jar-info { color: #b0b0b0; font-size: 0.95em; margin-top: 10px; }

    .jar-result {
      text-align: center;
      padding: 15px;
      font-size: 1.2em;
      min-height: 50px;
    }

    .jar-result .result-text { color: #ffd700; font-weight: bold; }

    /* åŠ¨ç”» */
    .draw-animation {
      display: inline-block;
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ² 1/100 vs 6/600</h1>
      <p>æ¦‚ç‡çœŸçš„ä¸€æ ·å—ï¼Ÿç”¨æ¨¡æ‹Ÿæ¥éªŒè¯ä½ çš„ç›´è§‰</p>
    </div>

    <!-- æ¨¡å—ä¸€ï¼šå½©ç¥¨å¯¹æ¯”æ¨¡æ‹Ÿ -->
    <div class="card">
      <h2>ğŸ° å®éªŒä¸€ï¼šä¸¤ç§å½©ç¥¨ï¼Œè°æ›´å®¹æ˜“ä¸­ï¼Ÿ</h2>
      <p style="color:#b0b0b0; margin-bottom:20px;">å½©ç¥¨Aï¼š100å¼ é‡Œæœ‰1å¼ ä¸­å¥– &nbsp;|&nbsp; å½©ç¥¨Bï¼š600å¼ é‡Œæœ‰6å¼ ä¸­å¥– &nbsp;|&nbsp; å„ä¹°Næ¬¡ï¼Œçœ‹è°ä¸­å¾—å¤š</p>

      <div class="lottery-compare">
        <div class="lottery-card a">
          <h3>å½©ç¥¨ A</h3>
          <div class="lottery-fraction">1/100</div>
          <div class="lottery-percent">= 1.00%</div>
          <div class="lottery-result">
            <div>ä¸­å¥–æ¬¡æ•°</div>
            <div class="wins" id="winsA">-</div>
          </div>
        </div>
        <div class="vs-badge">VS</div>
        <div class="lottery-card b">
          <h3>å½©ç¥¨ B</h3>
          <div class="lottery-fraction">6/600</div>
          <div class="lottery-percent">= 1.00%</div>
          <div class="lottery-result">
            <div>ä¸­å¥–æ¬¡æ•°</div>
            <div class="wins" id="winsB">-</div>
          </div>
        </div>
      </div>

      <div class="control-panel">
        <div class="control-group">
          <label>æ¯ç§å½©ç¥¨å„ä¹°å¤šå°‘æ¬¡ï¼Ÿ</label>
          <input type="range" id="lotteryTrials" min="1000" max="100000" value="10000" step="1000">
          <div class="value-display"><span id="lotteryTrialsValue">10000</span> æ¬¡</div>
        </div>
        <button onclick="runLotterySimulation()">å¼€å§‹æ¨¡æ‹Ÿ</button>
        <button class="btn-blue" onclick="runLotteryBatch()">é‡å¤100è½®çœ‹åˆ†å¸ƒ</button>
      </div>

      <div class="stats" id="lotteryStats" style="display:none;">
        <div class="stat-box">
          <div class="stat-label">A ä¸­å¥–ç‡</div>
          <div class="stat-value" id="rateA">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">B ä¸­å¥–ç‡</div>
          <div class="stat-value" id="rateB">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">å·®å¼‚</div>
          <div class="stat-value" id="rateDiff">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">ç»“è®º</div>
          <div class="stat-value" id="rateConclusion">-</div>
        </div>
      </div>

      <div style="margin-top:20px;">
        <div class="chart-container" id="lotteryChartBox" style="display:none;">
          <canvas id="lotteryChart"></canvas>
        </div>
      </div>

      <div class="insight">
        <div class="insight-title">ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿ</div>
        <div class="insight-text" id="insight1">ç‚¹å‡»"å¼€å§‹æ¨¡æ‹Ÿ"äº²çœ¼éªŒè¯ä¸¤ç§å½©ç¥¨çš„ä¸­å¥–ç‡æ˜¯å¦ä¸€æ ·</div>
      </div>
    </div>

    <!-- æ¨¡å—äºŒï¼šè‡ªå®šä¹‰æ¦‚ç‡å¯¹æ¯” -->
    <div class="card">
      <h2>ğŸ”¬ å®éªŒäºŒï¼šè‡ªå®šä¹‰åˆ†æ•°å¯¹æ¯”</h2>
      <p style="color:#b0b0b0; margin-bottom:20px;">è‡ªå·±è®¾å®šä¸¤ä¸ªåˆ†æ•°ï¼Œçœ‹çœ‹æ¦‚ç‡æ˜¯å¦çœŸçš„ä¸€æ ·</p>

      <div class="simulator">
        <div class="control-panel">
          <div class="control-group">
            <label>åˆ†æ•° Aï¼šåˆ†å­ï¼ˆä¸­å¥–æ•°ï¼‰</label>
            <input type="range" id="numA" min="1" max="20" value="1" step="1">
            <div class="value-display"><span id="numAValue">1</span></div>
          </div>
          <div class="control-group">
            <label>åˆ†æ•° Aï¼šåˆ†æ¯ï¼ˆæ€»æ•°ï¼‰</label>
            <input type="range" id="denA" min="10" max="2000" value="100" step="10">
            <div class="value-display"><span id="denAValue">100</span></div>
          </div>
          <div style="text-align:center; color:#ff6b6b; font-size:1.3em; font-weight:bold; margin-bottom:15px;">
            A = <span id="fracADisplay">1/100</span> = <span id="pctADisplay">1.00%</span>
          </div>

          <div class="control-group">
            <label>åˆ†æ•° Bï¼šåˆ†å­ï¼ˆä¸­å¥–æ•°ï¼‰</label>
            <input type="range" id="numB" min="1" max="120" value="6" step="1">
            <div class="value-display"><span id="numBValue">6</span></div>
          </div>
          <div class="control-group">
            <label>åˆ†æ•° Bï¼šåˆ†æ¯ï¼ˆæ€»æ•°ï¼‰</label>
            <input type="range" id="denB" min="10" max="12000" value="600" step="10">
            <div class="value-display"><span id="denBValue">600</span></div>
          </div>
          <div style="text-align:center; color:#4ecdc4; font-size:1.3em; font-weight:bold; margin-bottom:15px;">
            B = <span id="fracBDisplay">6/600</span> = <span id="pctBDisplay">1.00%</span>
          </div>

          <div class="control-group">
            <label>æ¨¡æ‹Ÿæ¬¡æ•°</label>
            <input type="range" id="customTrials" min="1000" max="100000" value="10000" step="1000">
            <div class="value-display"><span id="customTrialsValue">10000</span> æ¬¡</div>
          </div>

          <button onclick="runCustomSimulation()">å¼€å§‹å¯¹æ¯”æ¨¡æ‹Ÿ</button>
        </div>

        <div class="chart-container">
          <canvas id="customChart"></canvas>
        </div>
      </div>

      <div class="stats" id="customStats" style="display:none;">
        <div class="stat-box">
          <div class="stat-label">A ç†è®ºæ¦‚ç‡</div>
          <div class="stat-value" id="theoryA">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">A å®é™…ä¸­å¥–ç‡</div>
          <div class="stat-value" id="actualA">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">B ç†è®ºæ¦‚ç‡</div>
          <div class="stat-value" id="theoryB">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">B å®é™…ä¸­å¥–ç‡</div>
          <div class="stat-value" id="actualB">-</div>
        </div>
      </div>

      <div class="insight">
        <div class="insight-title">ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿ</div>
        <div class="insight-text" id="insight2">è°ƒæ•´åˆ†å­åˆ†æ¯ï¼Œçœ‹çœ‹ä¸åŒå†™æ³•çš„æ¦‚ç‡æ¨¡æ‹Ÿç»“æœ</div>
      </div>
    </div>

    <!-- æ¨¡å—ä¸‰ï¼šç³–æœç½å®éªŒ -->
    <div class="card">
      <h2>ğŸ¬ å®éªŒä¸‰ï¼šç»å…¸ç³–æœç½å®éªŒ</h2>
      <p style="color:#b0b0b0; margin-bottom:20px;">
        å¿ƒç†å­¦ç»å…¸å®éªŒé‡ç°ï¼šä¸¤ä¸ªç½å­ï¼Œæ¦‚ç‡ä¸€æ ·ï¼Œä½ ä¼šé€‰å“ªä¸ªï¼Ÿ<br>
        ç‚¹å‡»ä¸€ä¸ªç½å­æ¥æŠ½å–ï¼Œçœ‹çœ‹ä½ çš„ç›´è§‰å¯¹ä¸å¯¹
      </p>

      <div class="jar-experiment">
        <div class="jar" id="jarSmall" onclick="pickFromJar('small')">
          <h3>ğŸ«™ å°ç½</h3>
          <div class="candy-grid" id="smallJarGrid"></div>
          <div class="jar-info">10 é¢—ç³–ï¼Œ<strong style="color:#ff4444;">1 é¢—</strong>çº¢è‰²ä¸­å¥–</div>
          <div class="jar-info">æ¦‚ç‡ = 10%</div>
        </div>
        <div class="jar" id="jarBig" onclick="pickFromJar('big')">
          <h3>ğŸº å¤§ç½</h3>
          <div class="candy-grid" id="bigJarGrid"></div>
          <div class="jar-info">100 é¢—ç³–ï¼Œ<strong style="color:#ff4444;">10 é¢—</strong>çº¢è‰²ä¸­å¥–</div>
          <div class="jar-info">æ¦‚ç‡ = 10%</div>
        </div>
      </div>

      <div class="jar-result" id="jarResult">
        <span style="color:#b0b0b0;">ç‚¹å‡»ä¸€ä¸ªç½å­æ¥æŠ½å–ç³–æœ</span>
      </div>

      <div class="stats">
        <div class="stat-box">
          <div class="stat-label">å°ç½æŠ½å–æ¬¡æ•°</div>
          <div class="stat-value" id="smallPicks">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">å°ç½ä¸­å¥–æ¬¡æ•°</div>
          <div class="stat-value" id="smallWins">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">å¤§ç½æŠ½å–æ¬¡æ•°</div>
          <div class="stat-value" id="bigPicks">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">å¤§ç½ä¸­å¥–æ¬¡æ•°</div>
          <div class="stat-value" id="bigWins">0</div>
        </div>
      </div>

      <div style="text-align:center; margin-top:15px;">
        <button onclick="autoPickJar(100)" style="width:auto; padding:10px 25px; font-size:0.9em;">è‡ªåŠ¨æŠ½100æ¬¡å¯¹æ¯”</button>
        <button onclick="resetJar()" style="width:auto; padding:10px 25px; font-size:0.9em; background:rgba(255,255,255,0.1); color:#e0e0e0;">é‡ç½®</button>
      </div>

      <div class="insight">
        <div class="insight-title">ğŸ’¡ æ¯”ç‡åå·®ï¼ˆRatio Biasï¼‰</div>
        <div class="insight-text" id="insight3">
          1994å¹´ Denes-Raj å’Œ Epstein çš„å®éªŒå‘ç°ï¼šå³ä½¿æ¦‚ç‡ç›¸åŒï¼Œäººä»¬å€¾å‘äºé€‰æ‹©"ä¸­å¥–æ•°é‡æ›´å¤š"çš„é€‰é¡¹ã€‚<br>
          ä½ çš„å¤§è„‘åœ¨æ¯”è¾ƒ"10é¢—çº¢è‰²" vs "1é¢—çº¢è‰²"ï¼Œè€Œä¸æ˜¯åœ¨æ¯”è¾ƒæ¦‚ç‡æœ¬èº«ã€‚è¿™æ˜¯è¿›åŒ–ç•™ç»™æˆ‘ä»¬çš„ç›´è§‰â€”â€”åœ¨è¿œå¤æ—¶ä»£ï¼Œç»å¯¹æ•°é‡æ¯”æ¦‚ç‡æ›´æœ‰ç”¨ã€‚
        </div>
      </div>
    </div>

  </div>

  <script>
    let lotteryChart, customChart;

    // ========== åˆå§‹åŒ– ==========
    function initCharts() {
      const baseOpts = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { labels: { color: '#e0e0e0' } } },
        scales: {
          x: { ticks: { color: '#b0b0b0' }, grid: { color: 'rgba(255,255,255,0.1)' } },
          y: { ticks: { color: '#b0b0b0' }, grid: { color: 'rgba(255,255,255,0.1)' } }
        }
      };

      lotteryChart = new Chart(document.getElementById('lotteryChart').getContext('2d'), {
        type: 'bar', data: { labels: [], datasets: [] }, options: { ...baseOpts }
      });

      customChart = new Chart(document.getElementById('customChart').getContext('2d'), {
        type: 'bar', data: { labels: [], datasets: [] }, options: { ...baseOpts }
      });
    }

    function initJars() {
      const smallGrid = document.getElementById('smallJarGrid');
      const bigGrid = document.getElementById('bigJarGrid');
      smallGrid.innerHTML = '';
      bigGrid.innerHTML = '';

      for (let i = 0; i < 10; i++) {
        const c = document.createElement('div');
        c.className = 'candy' + (i < 1 ? ' winner' : '');
        smallGrid.appendChild(c);
      }
      // å¤§ç½åªæ˜¾ç¤ºå‰50é¢—ç¤ºæ„
      for (let i = 0; i < 50; i++) {
        const c = document.createElement('div');
        c.className = 'candy' + (i < 5 ? ' winner' : '');
        c.style.width = '12px';
        c.style.height = '12px';
        bigGrid.appendChild(c);
      }
    }

    // ========== æ»‘å—ç»‘å®š ==========
    function bindSlider(id, displayId, suffix, callback) {
      const el = document.getElementById(id);
      el.oninput = function() {
        document.getElementById(displayId).textContent = this.value;
        if (callback) callback();
      };
    }

    function updateFractionDisplays() {
      const nA = parseInt(document.getElementById('numA').value);
      const dA = parseInt(document.getElementById('denA').value);
      const nB = parseInt(document.getElementById('numB').value);
      const dB = parseInt(document.getElementById('denB').value);
      document.getElementById('fracADisplay').textContent = nA + '/' + dA;
      document.getElementById('pctADisplay').textContent = (nA / dA * 100).toFixed(2) + '%';
      document.getElementById('fracBDisplay').textContent = nB + '/' + dB;
      document.getElementById('pctBDisplay').textContent = (nB / dB * 100).toFixed(2) + '%';
    }

    bindSlider('lotteryTrials', 'lotteryTrialsValue');
    bindSlider('numA', 'numAValue', '', updateFractionDisplays);
    bindSlider('denA', 'denAValue', '', updateFractionDisplays);
    bindSlider('numB', 'numBValue', '', updateFractionDisplays);
    bindSlider('denB', 'denBValue', '', updateFractionDisplays);
    bindSlider('customTrials', 'customTrialsValue');

    // ========== æ¨¡å—ä¸€ï¼šå½©ç¥¨å¯¹æ¯” ==========
    function simulateLottery(numerator, denominator, trials) {
      const prob = numerator / denominator;
      let wins = 0;
      for (let i = 0; i < trials; i++) {
        if (Math.random() < prob) wins++;
      }
      return wins;
    }

    function runLotterySimulation() {
      const trials = parseInt(document.getElementById('lotteryTrials').value);
      const wA = simulateLottery(1, 100, trials);
      const wB = simulateLottery(6, 600, trials);

      document.getElementById('winsA').textContent = wA;
      document.getElementById('winsB').textContent = wB;

      document.getElementById('lotteryStats').style.display = 'grid';
      const rA = (wA / trials * 100).toFixed(2);
      const rB = (wB / trials * 100).toFixed(2);
      const diff = Math.abs(rA - rB).toFixed(2);

      document.getElementById('rateA').textContent = rA + '%';
      document.getElementById('rateB').textContent = rB + '%';
      document.getElementById('rateDiff').textContent = diff + '%';
      document.getElementById('rateConclusion').textContent = diff < 0.5 ? 'å‡ ä¹ä¸€æ ·' : 'éšæœºæ³¢åŠ¨';
      document.getElementById('rateConclusion').className = 'stat-value positive';

      document.getElementById('insight1').textContent =
        `å½©ç¥¨Aä¸­äº†${wA}æ¬¡(${rA}%)ï¼Œå½©ç¥¨Bä¸­äº†${wB}æ¬¡(${rB}%)ï¼Œå·®å¼‚ä»…${diff}%ã€‚` +
        `è¿™ç‚¹å·®å¼‚å®Œå…¨æ˜¯éšæœºæ³¢åŠ¨ï¼Œå¤šæ¨¡æ‹Ÿå‡ æ¬¡ä½ ä¼šå‘ç°è°å¤šè°å°‘æ˜¯éšæœºçš„ã€‚1/100 å’Œ 6/600 çš„ä¸­å¥–æ¦‚ç‡ç¡®å®å®Œå…¨ä¸€æ ·ã€‚`;
    }

    function runLotteryBatch() {
      const trials = parseInt(document.getElementById('lotteryTrials').value);
      const rounds = 100;
      const diffsA = [];
      const diffsB = [];

      for (let r = 0; r < rounds; r++) {
        diffsA.push(simulateLottery(1, 100, trials) / trials * 100);
        diffsB.push(simulateLottery(6, 600, trials) / trials * 100);
      }

      // ç”»åˆ†å¸ƒå¯¹æ¯”
      document.getElementById('lotteryChartBox').style.display = 'block';

      // åˆ†æ¡¶
      const allVals = [...diffsA, ...diffsB];
      const min = Math.floor(Math.min(...allVals) * 10) / 10;
      const max = Math.ceil(Math.max(...allVals) * 10) / 10;
      const step = Math.max(0.1, (max - min) / 15);
      const bins = [];
      for (let v = min; v < max; v += step) bins.push(v);
      bins.push(max);

      function histogram(data) {
        const counts = new Array(bins.length - 1).fill(0);
        data.forEach(v => {
          for (let i = 0; i < bins.length - 1; i++) {
            if (v >= bins[i] && v < bins[i + 1]) { counts[i]++; break; }
          }
        });
        return counts;
      }

      const histA = histogram(diffsA);
      const histB = histogram(diffsB);
      const labels = bins.slice(0, -1).map((v, i) => v.toFixed(2) + '%');

      lotteryChart.data.labels = labels;
      lotteryChart.data.datasets = [
        { label: 'å½©ç¥¨A (1/100)', data: histA, backgroundColor: 'rgba(255,107,107,0.5)', borderColor: '#ff6b6b', borderWidth: 1 },
        { label: 'å½©ç¥¨B (6/600)', data: histB, backgroundColor: 'rgba(78,205,196,0.5)', borderColor: '#4ecdc4', borderWidth: 1 }
      ];
      lotteryChart.options.scales.x.title = { display: true, text: 'å®é™…ä¸­å¥–ç‡', color: '#b0b0b0' };
      lotteryChart.options.scales.y.title = { display: true, text: 'å‡ºç°æ¬¡æ•°ï¼ˆå…±100è½®ï¼‰', color: '#b0b0b0' };
      lotteryChart.update();

      const avgA = (diffsA.reduce((s, v) => s + v, 0) / rounds).toFixed(3);
      const avgB = (diffsB.reduce((s, v) => s + v, 0) / rounds).toFixed(3);

      document.getElementById('insight1').textContent =
        `100è½®æ¨¡æ‹Ÿï¼šAå¹³å‡ä¸­å¥–ç‡${avgA}%ï¼ŒBå¹³å‡ä¸­å¥–ç‡${avgB}%ã€‚ä¸¤æ¡åˆ†å¸ƒå‡ ä¹å®Œå…¨é‡å ï¼Œè¯´æ˜1/100å’Œ6/600åœ¨ç»Ÿè®¡ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ä½ è§‰å¾—6/600æ›´å®¹æ˜“ä¸­ï¼Œçº¯ç²¹æ˜¯å¤§è„‘çš„"æ¯”ç‡åå·®"åœ¨ä½œæ€ªã€‚`;
    }

    // ========== æ¨¡å—äºŒï¼šè‡ªå®šä¹‰å¯¹æ¯” ==========
    function runCustomSimulation() {
      const nA = parseInt(document.getElementById('numA').value);
      const dA = parseInt(document.getElementById('denA').value);
      const nB = parseInt(document.getElementById('numB').value);
      const dB = parseInt(document.getElementById('denB').value);
      const trials = parseInt(document.getElementById('customTrials').value);

      const probA = nA / dA;
      const probB = nB / dB;

      // é€æ­¥ç´¯è®¡ä¸­å¥–ç‡
      const step = Math.max(1, Math.floor(trials / 200));
      const labelsArr = [];
      const cumA = [];
      const cumB = [];
      let wA = 0, wB = 0;

      for (let i = 1; i <= trials; i++) {
        if (Math.random() < probA) wA++;
        if (Math.random() < probB) wB++;
        if (i % step === 0 || i === trials) {
          labelsArr.push(i);
          cumA.push(wA / i * 100);
          cumB.push(wB / i * 100);
        }
      }

      customChart.config.type = 'line';
      customChart.data.labels = labelsArr;
      customChart.data.datasets = [
        { label: `A (${nA}/${dA})`, data: cumA, borderColor: '#ff6b6b', backgroundColor: 'transparent', tension: 0.3, pointRadius: 0 },
        { label: `B (${nB}/${dB})`, data: cumB, borderColor: '#4ecdc4', backgroundColor: 'transparent', tension: 0.3, pointRadius: 0 },
        { label: `A ç†è®ºå€¼ (${(probA*100).toFixed(2)}%)`, data: labelsArr.map(() => probA * 100), borderColor: 'rgba(255,107,107,0.3)', borderDash: [5,5], pointRadius: 0 },
        { label: `B ç†è®ºå€¼ (${(probB*100).toFixed(2)}%)`, data: labelsArr.map(() => probB * 100), borderColor: 'rgba(78,205,196,0.3)', borderDash: [5,5], pointRadius: 0 }
      ];
      customChart.options.scales.x.title = { display: true, text: 'æ¨¡æ‹Ÿæ¬¡æ•°', color: '#b0b0b0' };
      customChart.options.scales.y.title = { display: true, text: 'ç´¯è®¡ä¸­å¥–ç‡ (%)', color: '#b0b0b0' };
      customChart.update();

      document.getElementById('customStats').style.display = 'grid';
      document.getElementById('theoryA').textContent = (probA * 100).toFixed(2) + '%';
      document.getElementById('actualA').textContent = cumA[cumA.length - 1].toFixed(2) + '%';
      document.getElementById('theoryB').textContent = (probB * 100).toFixed(2) + '%';
      document.getElementById('actualB').textContent = cumB[cumB.length - 1].toFixed(2) + '%';

      const sameProbability = Math.abs(probA - probB) < 0.0001;
      if (sameProbability) {
        document.getElementById('insight2').textContent =
          `ä¸¤ä¸ªåˆ†æ•° ${nA}/${dA} å’Œ ${nB}/${dB} çš„æ¦‚ç‡å®Œå…¨ç›¸åŒï¼ˆéƒ½æ˜¯${(probA*100).toFixed(2)}%ï¼‰ã€‚éšç€æ¨¡æ‹Ÿæ¬¡æ•°å¢åŠ ï¼Œä¸¤æ¡æ›²çº¿è¶Šæ¥è¶Šæ¥è¿‘ï¼Œæœ€ç»ˆæ”¶æ•›åˆ°åŒä¸€ä¸ªå€¼ã€‚åˆ†å­åˆ†æ¯çš„å¤§å°ä¸å½±å“æœ€ç»ˆæ¦‚ç‡ã€‚`;
      } else {
        const bigger = probA > probB ? 'A' : 'B';
        document.getElementById('insight2').textContent =
          `æ³¨æ„ï¼šè¿™ä¸¤ä¸ªåˆ†æ•°çš„æ¦‚ç‡ä¸åŒï¼A=${(probA*100).toFixed(2)}%ï¼ŒB=${(probB*100).toFixed(2)}%ã€‚${bigger}çš„æ¦‚ç‡æ›´å¤§ï¼Œæ¨¡æ‹Ÿç»“æœä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹ã€‚åªæœ‰å½“åˆ†æ•°çº¦åˆ†åç›¸ç­‰æ—¶ï¼Œæ¦‚ç‡æ‰ä¸€æ ·ã€‚`;
      }
    }

    // ========== æ¨¡å—ä¸‰ï¼šç³–æœç½ ==========
    let jarStats = { small: { picks: 0, wins: 0 }, big: { picks: 0, wins: 0 } };

    function pickFromJar(jar) {
      const prob = 0.1; // éƒ½æ˜¯10%
      const won = Math.random() < prob;
      jarStats[jar].picks++;
      if (won) jarStats[jar].wins++;

      // é«˜äº®é€‰ä¸­çš„ç½å­
      document.getElementById('jarSmall').classList.toggle('selected', jar === 'small');
      document.getElementById('jarBig').classList.toggle('selected', jar === 'big');

      // æ˜¾ç¤ºç»“æœ
      const resultEl = document.getElementById('jarResult');
      const jarName = jar === 'small' ? 'å°ç½' : 'å¤§ç½';
      if (won) {
        resultEl.innerHTML = `<span class="draw-animation result-text">ğŸ‰ ä»${jarName}æŠ½åˆ°äº†çº¢è‰²ç³–æœï¼ä¸­å¥–ï¼</span>`;
      } else {
        resultEl.innerHTML = `<span class="draw-animation" style="color:#888;">ä»${jarName}æŠ½åˆ°äº†ç°è‰²ç³–æœï¼Œæ²¡ä¸­å¥–</span>`;
      }

      updateJarStats();
    }

    function autoPickJar(times) {
      jarStats = { small: { picks: 0, wins: 0 }, big: { picks: 0, wins: 0 } };
      for (let i = 0; i < times; i++) {
        const wonSmall = Math.random() < 0.1;
        const wonBig = Math.random() < 0.1;
        jarStats.small.picks++;
        jarStats.big.picks++;
        if (wonSmall) jarStats.small.wins++;
        if (wonBig) jarStats.big.wins++;
      }

      updateJarStats();
      const sRate = (jarStats.small.wins / jarStats.small.picks * 100).toFixed(1);
      const bRate = (jarStats.big.wins / jarStats.big.picks * 100).toFixed(1);
      document.getElementById('jarResult').innerHTML =
        `<span class="result-text">è‡ªåŠ¨æŠ½å–${times}æ¬¡å®Œæˆï¼å°ç½ä¸­å¥–ç‡ ${sRate}%ï¼Œå¤§ç½ä¸­å¥–ç‡ ${bRate}%</span>`;
    }

    function resetJar() {
      jarStats = { small: { picks: 0, wins: 0 }, big: { picks: 0, wins: 0 } };
      updateJarStats();
      document.getElementById('jarResult').innerHTML = '<span style="color:#b0b0b0;">ç‚¹å‡»ä¸€ä¸ªç½å­æ¥æŠ½å–ç³–æœ</span>';
      document.getElementById('jarSmall').classList.remove('selected');
      document.getElementById('jarBig').classList.remove('selected');
    }

    function updateJarStats() {
      document.getElementById('smallPicks').textContent = jarStats.small.picks;
      document.getElementById('smallWins').textContent = jarStats.small.wins;
      document.getElementById('bigPicks').textContent = jarStats.big.picks;
      document.getElementById('bigWins').textContent = jarStats.big.wins;
    }

    // ========== åˆå§‹åŒ– ==========
    window.onload = function() {
      initCharts();
      initJars();
    };
  </script>
</body>
</html>
