<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ³Šæ¾åˆ†å¸ƒå¯è§†åŒ– - ä¸ºä»€ä¹ˆç”Ÿæ´»ä¸­å¤„å¤„æ˜¯æ³Šæ¾ï¼Ÿ</title>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 30px 20px;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    
    .header { text-align: center; margin: 20px 0 40px; }
    .header h1 {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(90deg, #4ade80, #22d3ee, #a78bfa);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .header p { color: rgba(255,255,255,0.6); margin-top: 12px; font-size: 15px; line-height: 1.6; }

    .card {
      background: rgba(255,255,255,0.03);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 30px;
      margin-bottom: 30px;
    }
    .card-title {
      color: #ffd700;
      font-size: 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* åœºæ™¯é€‰æ‹© */
    .scenarios {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .scenario-btn {
      background: rgba(0,0,0,0.2);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }
    .scenario-btn:hover {
      border-color: rgba(74,222,128,0.5);
      background: rgba(74,222,128,0.1);
    }
    .scenario-btn.active {
      border-color: #4ade80;
      background: rgba(74,222,128,0.15);
    }
    .scenario-btn .icon { font-size: 24px; margin-bottom: 8px; }
    .scenario-btn .name { color: white; font-weight: 600; font-size: 14px; }
    .scenario-btn .desc { color: rgba(255,255,255,0.5); font-size: 12px; margin-top: 5px; }

    /* Î» æ»‘å— */
    .lambda-control {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
    }
    .lambda-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .lambda-label span { color: rgba(255,255,255,0.7); font-size: 14px; }
    .lambda-value {
      font-size: 2rem;
      font-weight: 700;
      color: #4ade80;
    }
    .lambda-slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      outline: none;
    }
    .lambda-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #4ade80, #22d3ee);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(74,222,128,0.5);
    }
    .lambda-meaning {
      color: rgba(255,255,255,0.5);
      font-size: 13px;
      margin-top: 10px;
      text-align: center;
    }

    /* å›¾è¡¨åŒºåŸŸ */
    .chart-container {
      position: relative;
      height: 300px;
      margin: 20px 0;
    }
    .chart {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      height: 250px;
      gap: 4px;
      padding: 0 10px;
    }
    .bar-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      max-width: 50px;
    }
    .bar {
      width: 100%;
      background: linear-gradient(180deg, #4ade80, #22d3ee);
      border-radius: 4px 4px 0 0;
      transition: height 0.5s ease;
      min-height: 2px;
    }
    .bar-label {
      color: rgba(255,255,255,0.6);
      font-size: 11px;
      margin-top: 8px;
    }
    .bar-prob {
      color: rgba(255,255,255,0.4);
      font-size: 10px;
      margin-top: 2px;
    }

    /* ç»Ÿè®¡ä¿¡æ¯ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    .stat-item {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }
    .stat-item .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #22d3ee;
    }
    .stat-item .label {
      color: rgba(255,255,255,0.5);
      font-size: 12px;
      margin-top: 5px;
    }

    /* æ¨¡æ‹ŸåŒºåŸŸ */
    .sim-section {
      background: linear-gradient(135deg, rgba(74,222,128,0.1), rgba(34,211,238,0.1));
      border: 1px solid rgba(74,222,128,0.2);
    }
    .sim-controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .btn {
      padding: 12px 25px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #4ade80, #22d3ee);
      color: #1a1a2e;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn:hover { transform: translateY(-2px); }

    .sim-result {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      min-height: 60px;
      padding: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
    }
    .event-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #4ade80;
      animation: pop 0.3s ease;
    }
    @keyframes pop {
      0% { transform: scale(0); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .sim-stats {
      text-align: center;
      margin-top: 15px;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
    }

    /* å…¬å¼åŒºåŸŸ */
    .formula-box {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin: 20px 0;
      font-family: 'Times New Roman', serif;
      font-size: 1.3rem;
      color: #ffd700;
    }

    /* è§£é‡ŠåŒºåŸŸ */
    .explanation { line-height: 1.8; }
    .explanation h3 {
      color: #4ade80;
      font-size: 16px;
      margin: 25px 0 15px;
    }
    .explanation h3:first-child { margin-top: 0; }
    .explanation p {
      color: rgba(255,255,255,0.75);
      margin-bottom: 12px;
      font-size: 14px;
    }
    .key-point {
      background: rgba(74,222,128,0.1);
      border-left: 3px solid #4ade80;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 10px 10px 0;
    }
    .key-point strong { color: #4ade80; }

    .example-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    .example-item {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
    }
    .example-item .icon { font-size: 20px; margin-bottom: 8px; }
    .example-item .title { color: white; font-weight: 600; font-size: 13px; }
    .example-item .detail { color: rgba(255,255,255,0.5); font-size: 12px; margin-top: 5px; }

    @media (max-width: 600px) {
      .header h1 { font-size: 1.5rem; }
      .stats-row { grid-template-columns: 1fr; }
      .chart { height: 200px; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ“Š æ³Šæ¾åˆ†å¸ƒï¼šç”Ÿæ´»ä¸­çš„éšæœºè§„å¾‹</h1>
    <p>ä¸ºä»€ä¹ˆæ’é˜Ÿã€æ¥ç”µã€è½¦ç¥¸ã€æ‰“å­—é”™è¯¯...éƒ½æœä»åŒä¸€ä¸ªåˆ†å¸ƒï¼Ÿ</p>
  </div>

  <!-- åœºæ™¯é€‰æ‹© -->
  <div class="card">
    <div class="card-title">ğŸ¯ é€‰æ‹©ä¸€ä¸ªç”Ÿæ´»åœºæ™¯</div>
    <div class="scenarios" id="scenarios">
      <div class="scenario-btn active" data-lambda="3" data-name="å’–å•¡åº—é¡¾å®¢" data-unit="äºº/å°æ—¶">
        <div class="icon">â˜•</div>
        <div class="name">å’–å•¡åº—é¡¾å®¢</div>
        <div class="desc">å¹³å‡æ¯å°æ—¶3ä½é¡¾å®¢</div>
      </div>
      <div class="scenario-btn" data-lambda="5" data-name="å®¢æœæ¥ç”µ" data-unit="é€š/å°æ—¶">
        <div class="icon">ğŸ“</div>
        <div class="name">å®¢æœæ¥ç”µ</div>
        <div class="desc">å¹³å‡æ¯å°æ—¶5é€šç”µè¯</div>
      </div>
      <div class="scenario-btn" data-lambda="2" data-name="ç½‘ç«™Bug" data-unit="ä¸ª/å‘¨">
        <div class="icon">ğŸ›</div>
        <div class="name">ç½‘ç«™Bug</div>
        <div class="desc">å¹³å‡æ¯å‘¨2ä¸ªBug</div>
      </div>
      <div class="scenario-btn" data-lambda="4" data-name="åœ°é“è¿›ç«™" data-unit="äºº/åˆ†é’Ÿ">
        <div class="icon">ğŸš‡</div>
        <div class="name">åœ°é“è¿›ç«™</div>
        <div class="desc">å¹³å‡æ¯åˆ†é’Ÿ4äººè¿›ç«™</div>
      </div>
      <div class="scenario-btn" data-lambda="1" data-name="äº¤é€šäº‹æ•…" data-unit="èµ·/å¤©">
        <div class="icon">ğŸš—</div>
        <div class="name">è·¯å£äº‹æ•…</div>
        <div class="desc">å¹³å‡æ¯å¤©1èµ·äº‹æ•…</div>
      </div>
      <div class="scenario-btn" data-lambda="7" data-name="æ‰“å­—é”™è¯¯" data-unit="ä¸ª/é¡µ">
        <div class="icon">âŒ¨ï¸</div>
        <div class="name">æ‰“å­—é”™è¯¯</div>
        <div class="desc">å¹³å‡æ¯é¡µ7ä¸ªé”™å­—</div>
      </div>
    </div>

    <!-- Î» æ§åˆ¶ -->
    <div class="lambda-control">
      <div class="lambda-label">
        <span>Î» (lambda) = å¹³å‡å‘ç”Ÿæ¬¡æ•°</span>
        <div class="lambda-value">Î» = <span id="lambdaDisplay">3</span></div>
      </div>
      <input type="range" class="lambda-slider" id="lambdaSlider" min="0.5" max="15" step="0.5" value="3">
      <div class="lambda-meaning" id="lambdaMeaning">å¹³å‡æ¯å°æ—¶æœ‰ 3 ä½é¡¾å®¢</div>
    </div>

    <!-- æ¦‚ç‡åˆ†å¸ƒå›¾ -->
    <div class="chart-container">
      <div class="chart" id="chart"></div>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats-row">
      <div class="stat-item">
        <div class="value" id="statMean">3.00</div>
        <div class="label">æœŸæœ›å€¼ E(X) = Î»</div>
      </div>
      <div class="stat-item">
        <div class="value" id="statVar">3.00</div>
        <div class="label">æ–¹å·® Var(X) = Î»</div>
      </div>
      <div class="stat-item">
        <div class="value" id="statMode">2-3</div>
        <div class="label">æœ€å¯èƒ½å‡ºç°çš„å€¼</div>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ‹ŸåŒºåŸŸ -->
  <div class="card sim-section">
    <div class="card-title">ğŸ² è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ</div>
    <p style="color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; text-align: center;">
      æ¨¡æ‹Ÿ"è¿™ä¸€å°æ—¶æ¥äº†å¤šå°‘é¡¾å®¢"ï¼Œæ¯ä¸ªç»¿ç‚¹ä»£è¡¨ä¸€ä½é¡¾å®¢
    </p>
    <div class="sim-controls">
      <button class="btn btn-primary" id="simOnce">æ¨¡æ‹Ÿä¸€æ¬¡</button>
      <button class="btn btn-secondary" id="sim100">æ¨¡æ‹Ÿ100æ¬¡</button>
      <button class="btn btn-secondary" id="sim1000">æ¨¡æ‹Ÿ1000æ¬¡</button>
      <button class="btn btn-secondary" id="resetSim">é‡ç½®</button>
    </div>
    <div class="sim-result" id="simResult">
      <span style="color: rgba(255,255,255,0.4);">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ¨¡æ‹Ÿ</span>
    </div>
    <div class="sim-stats" id="simStats"></div>
  </div>

  <!-- å…¬å¼ -->
  <div class="card">
    <div class="card-title">ğŸ“ æ³Šæ¾åˆ†å¸ƒå…¬å¼</div>
    <div class="formula-box">
      P(X = k) = (Î»<sup>k</sup> Ã— e<sup>-Î»</sup>) / k!
    </div>
    <p style="color: rgba(255,255,255,0.6); font-size: 13px; text-align: center;">
      X = k è¡¨ç¤ºäº‹ä»¶å‘ç”Ÿ k æ¬¡çš„æ¦‚ç‡ï¼ŒÎ» æ˜¯å¹³å‡å‘ç”Ÿæ¬¡æ•°ï¼Œe â‰ˆ 2.718
    </p>
  </div>

  <!-- è§£é‡Š -->
  <div class="card explanation">
    <h3>ğŸ¤” ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šç°è±¡éƒ½æœä»æ³Šæ¾åˆ†å¸ƒï¼Ÿ</h3>
    
    <p>æ³Šæ¾åˆ†å¸ƒæè¿°çš„æ˜¯ï¼š<strong>åœ¨å›ºå®šæ—¶é—´/ç©ºé—´å†…ï¼Œéšæœºäº‹ä»¶å‘ç”Ÿæ¬¡æ•°çš„æ¦‚ç‡åˆ†å¸ƒ</strong>ã€‚</p>
    
    <p>å®ƒæœ‰ä¸‰ä¸ªå…³é”®å‰æï¼š</p>
    <div class="key-point">
      <strong>1. ç‹¬ç«‹æ€§ï¼š</strong>æ¯æ¬¡äº‹ä»¶çš„å‘ç”Ÿäº’ä¸å½±å“ï¼ˆè¿™ä¸ªé¡¾å®¢æ¥ä¸æ¥ï¼Œä¸å½±å“ä¸‹ä¸€ä¸ªï¼‰<br>
      <strong>2. ç¨³å®šæ€§ï¼š</strong>å¹³å‡å‘ç”Ÿç‡åœ¨è§‚å¯ŸæœŸå†…ä¿æŒç¨³å®š<br>
      <strong>3. ç¨€ç–æ€§ï¼š</strong>åœ¨æçŸ­æ—¶é—´å†…ï¼Œæœ€å¤šå‘ç”Ÿä¸€æ¬¡äº‹ä»¶
    </div>

    <p>ç°å®ä¸­å¤§é‡ç°è±¡æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥æ³Šæ¾åˆ†å¸ƒæ— å¤„ä¸åœ¨ï¼š</p>

    <div class="example-list">
      <div class="example-item">
        <div class="icon">ğŸ“</div>
        <div class="title">å‘¼å«ä¸­å¿ƒæ¥ç”µ</div>
        <div class="detail">æ¯ä¸ªäººæ‰“ç”µè¯æ˜¯ç‹¬ç«‹çš„ï¼Œå¹³å‡æ¥ç”µç‡ç¨³å®š</div>
      </div>
      <div class="example-item">
        <div class="icon">ğŸš—</div>
        <div class="title">äº¤é€šäº‹æ•…</div>
        <div class="detail">æ¯èµ·äº‹æ•…ç‹¬ç«‹å‘ç”Ÿï¼ŒåŒä¸€ç¬é—´ä¸ä¼šæœ‰ä¸¤èµ·</div>
      </div>
      <div class="example-item">
        <div class="icon">âš¡</div>
        <div class="title">æœåŠ¡å™¨è¯·æ±‚</div>
        <div class="detail">ç”¨æˆ·è¯·æ±‚ç›¸äº’ç‹¬ç«‹ï¼ŒQPSç›¸å¯¹ç¨³å®š</div>
      </div>
      <div class="example-item">
        <div class="icon">â˜¢ï¸</div>
        <div class="title">æ”¾å°„æ€§è¡°å˜</div>
        <div class="detail">æ¯ä¸ªåŸå­è¡°å˜ç‹¬ç«‹ï¼Œè¡°å˜ç‡æ’å®š</div>
      </div>
      <div class="example-item">
        <div class="icon">ğŸ›</div>
        <div class="title">ä»£ç Bugæ•°é‡</div>
        <div class="detail">æ¯ä¸ªBugç‹¬ç«‹äº§ç”Ÿï¼Œå¹³å‡Bugç‡ç›¸å¯¹ç¨³å®š</div>
      </div>
      <div class="example-item">
        <div class="icon">âŒ¨ï¸</div>
        <div class="title">æ‰“å­—é”™è¯¯</div>
        <div class="detail">æ¯ä¸ªé”™è¯¯ç‹¬ç«‹å‘ç”Ÿï¼Œé”™è¯¯ç‡ç›¸å¯¹æ’å®š</div>
      </div>
    </div>

    <h3>ğŸ’¡ æ³Šæ¾åˆ†å¸ƒçš„ç›´è§‰ç†è§£</h3>
    
    <p>æƒ³è±¡ä½ åœ¨å’–å•¡åº—å·¥ä½œï¼Œå¹³å‡æ¯å°æ—¶æ¥3ä¸ªé¡¾å®¢ï¼ˆÎ»=3ï¼‰ã€‚</p>
    
    <p>é‚£ä¹ˆè¿™ä¸€å°æ—¶ï¼š</p>
    <p>â€¢ æ¥0ä¸ªäººçš„æ¦‚ç‡ â‰ˆ 5%ï¼ˆè¿æ°”ä¸å¥½ï¼Œä¸€ä¸ªéƒ½æ²¡æœ‰ï¼‰</p>
    <p>â€¢ æ¥3ä¸ªäººçš„æ¦‚ç‡ â‰ˆ 22%ï¼ˆæœ€å¯èƒ½çš„æƒ…å†µï¼‰</p>
    <p>â€¢ æ¥10ä¸ªäººçš„æ¦‚ç‡ â‰ˆ 0.08%ï¼ˆçªç„¶çˆ†æ»¡ï¼Œå¾ˆç½•è§ï¼‰</p>

    <p>æ³Šæ¾åˆ†å¸ƒå‘Šè¯‰æˆ‘ä»¬ï¼š<strong>å³ä½¿å¹³å‡å€¼æ˜¯3ï¼Œå®é™…å€¼ä¹Ÿä¼šåœ¨0-7ä¹‹é—´æ³¢åŠ¨</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åº—é‡Œç©ºæ— ä¸€äººï¼Œæœ‰æ—¶å€™çªç„¶æ’èµ·é•¿é˜Ÿâ€”â€”è¿™ä¸æ˜¯è¿æ°”ï¼Œæ˜¯æ•°å­¦è§„å¾‹ã€‚</p>

    <h3>ğŸ”— æ³Šæ¾åˆ†å¸ƒä¸äºŒé¡¹åˆ†å¸ƒçš„å…³ç³»</h3>
    
    <p>æ³Šæ¾åˆ†å¸ƒå…¶å®æ˜¯äºŒé¡¹åˆ†å¸ƒçš„æé™æƒ…å†µï¼š</p>
    
    <div class="key-point">
      å½“ n â†’ âˆï¼Œp â†’ 0ï¼Œä½† np = Î» ä¿æŒä¸å˜æ—¶ï¼Œ<br>
      äºŒé¡¹åˆ†å¸ƒ B(n, p) â†’ æ³Šæ¾åˆ†å¸ƒ Poisson(Î»)
    </div>

    <p>æ¯”å¦‚ï¼šä¸€å°æ—¶æœ‰3600ç§’ï¼Œæ¯ç§’æœ‰é¡¾å®¢è¿›é—¨çš„æ¦‚ç‡æ˜¯ 3/3600 = 0.083%ã€‚</p>
    <p>è¿™å°±æ˜¯"å¤§é‡ç‹¬ç«‹å°æ¦‚ç‡äº‹ä»¶"çš„ç´¯ç§¯â€”â€”æ³Šæ¾åˆ†å¸ƒçš„æœ¬è´¨ã€‚</p>

    <h3>ğŸ› ï¸ å®é™…åº”ç”¨</h3>
    
    <p>â€¢ <strong>æ’é˜Ÿè®ºï¼š</strong>é“¶è¡Œã€åŒ»é™¢ã€å®¢æœä¸­å¿ƒç”¨æ³Šæ¾åˆ†å¸ƒé¢„æµ‹å®¢æµï¼Œå†³å®šå¼€å‡ ä¸ªçª—å£</p>
    <p>â€¢ <strong>ä¿é™©ç²¾ç®—ï¼š</strong>é¢„æµ‹ç†èµ”æ¬¡æ•°ï¼Œè®¡ç®—ä¿è´¹</p>
    <p>â€¢ <strong>è´¨é‡æ§åˆ¶ï¼š</strong>é¢„æµ‹äº§å“ç¼ºé™·æ•°é‡</p>
    <p>â€¢ <strong>ç½‘ç»œå·¥ç¨‹ï¼š</strong>é¢„æµ‹æœåŠ¡å™¨è´Ÿè½½ï¼Œåšå®¹é‡è§„åˆ’</p>
    <p>â€¢ <strong>æµè¡Œç—…å­¦ï¼š</strong>é¢„æµ‹ç–¾ç—…å‘ç—…æ•°</p>
  </div>
</div>

<script>
let lambda = 3;
let scenarioName = 'å’–å•¡åº—é¡¾å®¢';
let scenarioUnit = 'äºº/å°æ—¶';
let simHistory = [];

// è®¡ç®—æ³Šæ¾æ¦‚ç‡
function poissonPMF(k, lambda) {
  return Math.pow(lambda, k) * Math.exp(-lambda) / factorial(k);
}

function factorial(n) {
  if (n <= 1) return 1;
  let result = 1;
  for (let i = 2; i <= n; i++) result *= i;
  return result;
}

// ç”Ÿæˆæ³Šæ¾éšæœºæ•°
function poissonRandom(lambda) {
  const L = Math.exp(-lambda);
  let k = 0;
  let p = 1;
  do {
    k++;
    p *= Math.random();
  } while (p > L);
  return k - 1;
}

// æ›´æ–°å›¾è¡¨
function updateChart() {
  const chart = document.getElementById('chart');
  chart.innerHTML = '';
  
  const maxK = Math.max(15, Math.ceil(lambda * 2.5));
  let maxProb = 0;
  
  // å…ˆæ‰¾æœ€å¤§æ¦‚ç‡
  for (let k = 0; k <= maxK; k++) {
    const prob = poissonPMF(k, lambda);
    if (prob > maxProb) maxProb = prob;
  }
  
  // ç»˜åˆ¶æŸ±çŠ¶å›¾
  for (let k = 0; k <= maxK; k++) {
    const prob = poissonPMF(k, lambda);
    const height = (prob / maxProb) * 220;
    
    const wrapper = document.createElement('div');
    wrapper.className = 'bar-wrapper';
    
    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.style.height = Math.max(2, height) + 'px';
    
    const label = document.createElement('div');
    label.className = 'bar-label';
    label.textContent = k;
    
    const probLabel = document.createElement('div');
    probLabel.className = 'bar-prob';
    probLabel.textContent = (prob * 100).toFixed(1) + '%';
    
    wrapper.appendChild(bar);
    wrapper.appendChild(label);
    wrapper.appendChild(probLabel);
    chart.appendChild(wrapper);
  }
  
  // æ›´æ–°ç»Ÿè®¡
  document.getElementById('statMean').textContent = lambda.toFixed(2);
  document.getElementById('statVar').textContent = lambda.toFixed(2);
  
  // ä¼—æ•°
  const mode = lambda >= 1 ? Math.floor(lambda) : 0;
  const modeText = lambda % 1 === 0 && lambda >= 1 ? `${mode-1}-${mode}` : mode.toString();
  document.getElementById('statMode').textContent = modeText;
}

// æ›´æ–° Î» æ˜¾ç¤º
function updateLambdaDisplay() {
  document.getElementById('lambdaDisplay').textContent = lambda;
  document.getElementById('lambdaMeaning').textContent = 
    `å¹³å‡æ¯${scenarioUnit.split('/')[1]}æœ‰ ${lambda} ${scenarioUnit.split('/')[0]}`;
}

// åœºæ™¯é€‰æ‹©
document.getElementById('scenarios').addEventListener('click', (e) => {
  const btn = e.target.closest('.scenario-btn');
  if (!btn) return;
  
  document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  lambda = parseFloat(btn.dataset.lambda);
  scenarioName = btn.dataset.name;
  scenarioUnit = btn.dataset.unit;
  
  document.getElementById('lambdaSlider').value = lambda;
  updateLambdaDisplay();
  updateChart();
  resetSimulation();
});

// Î» æ»‘å—
document.getElementById('lambdaSlider').addEventListener('input', (e) => {
  lambda = parseFloat(e.target.value);
  document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
  updateLambdaDisplay();
  updateChart();
});

// æ¨¡æ‹Ÿ
function simulate(count = 1) {
  const results = [];
  for (let i = 0; i < count; i++) {
    results.push(poissonRandom(lambda));
  }
  simHistory.push(...results);
  
  // æ˜¾ç¤ºæœ€åä¸€æ¬¡ç»“æœ
  const lastResult = results[results.length - 1];
  const resultDiv = document.getElementById('simResult');
  resultDiv.innerHTML = '';
  
  for (let i = 0; i < lastResult; i++) {
    const dot = document.createElement('div');
    dot.className = 'event-dot';
    dot.style.animationDelay = (i * 0.05) + 's';
    resultDiv.appendChild(dot);
  }
  
  if (lastResult === 0) {
    resultDiv.innerHTML = '<span style="color: rgba(255,255,255,0.4);">è¿™æ¬¡ä¸€ä¸ªéƒ½æ²¡æœ‰ ğŸ˜…</span>';
  }
  
  // æ›´æ–°ç»Ÿè®¡
  const avg = simHistory.reduce((a, b) => a + b, 0) / simHistory.length;
  const variance = simHistory.reduce((sum, x) => sum + Math.pow(x - avg, 2), 0) / simHistory.length;
  
  document.getElementById('simStats').innerHTML = 
    `å…±æ¨¡æ‹Ÿ <strong>${simHistory.length}</strong> æ¬¡ | ` +
    `æœ¬æ¬¡: <strong>${lastResult}</strong> | ` +
    `å¹³å‡å€¼: <strong>${avg.toFixed(2)}</strong> | ` +
    `æ–¹å·®: <strong>${variance.toFixed(2)}</strong> ` +
    `<span style="color: rgba(255,255,255,0.4)">(ç†è®ºå€¼: Î»=${lambda})</span>`;
}

function resetSimulation() {
  simHistory = [];
  document.getElementById('simResult').innerHTML = 
    '<span style="color: rgba(255,255,255,0.4);">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ¨¡æ‹Ÿ</span>';
  document.getElementById('simStats').innerHTML = '';
}

document.getElementById('simOnce').addEventListener('click', () => simulate(1));
document.getElementById('sim100').addEventListener('click', () => simulate(100));
document.getElementById('sim1000').addEventListener('click', () => simulate(1000));
document.getElementById('resetSim').addEventListener('click', resetSimulation);

// åˆå§‹åŒ–
updateChart();
updateLambdaDisplay();
</script>

</body>
</html>
