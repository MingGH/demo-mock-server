<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤åˆ©çš„å¨åŠ› - ä¸ºä»€ä¹ˆè¶Šæ—©å¼€å§‹è¶Šå¥½ï¼Ÿ</title>
  <script src="../components/header.js" defer></script>
  <script src="./compound-power-logic.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 30px 20px;
    }

    .container { max-width: 1000px; margin: 0 auto; }

    .header { text-align: center; margin: 20px 0 40px; }
    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(90deg, #fbbf24, #f59e0b, #fbbf24);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .header p { color: rgba(255,255,255,0.5); margin-top: 12px; font-size: 15px; }

    /* æ§åˆ¶é¢æ¿ */
    .controls-card {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 25px;
    }
    
    .mode-switch {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
      background: rgba(0,0,0,0.3);
      padding: 5px;
      border-radius: 30px;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    .mode-btn {
      padding: 8px 25px;
      border-radius: 25px;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }
    .mode-btn.active {
      background: #fbbf24;
      color: #1a1a2e;
      font-weight: 600;
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    .input-item label {
      display: block;
      color: rgba(255,255,255,0.6);
      font-size: 13px;
      margin-bottom: 8px;
    }
    .input-wrapper {
      position: relative;
    }
    .input-wrapper input {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 12px 15px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      transition: border-color 0.3s;
    }
    .input-wrapper input:focus {
      outline: none;
      border-color: #fbbf24;
    }
    .input-wrapper .unit {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.3);
      font-size: 12px;
    }

    /* å›¾è¡¨åŒºåŸŸ */
    .chart-container {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
      height: 400px;
      margin-bottom: 25px;
    }

    /* ç»“è®ºå¡ç‰‡ */
    .insights {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .insight-card {
      background: linear-gradient(135deg, rgba(251,191,36,0.1), rgba(245,158,11,0.05));
      border: 1px solid rgba(251,191,36,0.2);
      border-radius: 16px;
      padding: 25px;
    }
    .insight-card.highlight {
      background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(5,150,105,0.05));
      border-color: rgba(16,185,129,0.2);
    }
    .insight-title {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .insight-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #fbbf24;
      margin-bottom: 5px;
    }
    .insight-card.highlight .insight-value { color: #4ade80; }
    .insight-desc {
      color: rgba(255,255,255,0.5);
      font-size: 13px;
      line-height: 1.5;
    }
    .insight-desc strong { color: white; }

    /* æ»‘å—æ ·å¼ */
    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      margin-top: 10px;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: #fbbf24;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(251,191,36,0.5);
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸš€ å¤åˆ©çš„å¨åŠ›å¯è§†åŒ–</h1>
    <p>äººç±»ç¬¬å…«å¤§å¥‡è¿¹ï¼Ÿè®©æ•°æ®å‘Šè¯‰ä½ çœŸç›¸</p>
  </div>

  <div class="controls-card">
    <div class="mode-switch">
      <button class="mode-btn active" onclick="switchMode('simple-vs-compound')">å•åˆ© vs å¤åˆ©</button>
      <button class="mode-btn" onclick="switchMode('early-vs-late')">æ—©æŠ• vs æ™šæŠ•</button>
    </div>

    <!-- æ¨¡å¼1ï¼šå•åˆ© vs å¤åˆ© -->
    <div id="controls-mode1" class="input-grid">
      <div class="input-item">
        <label>åˆå§‹æœ¬é‡‘</label>
        <div class="input-wrapper">
          <input type="number" id="p1-principal" value="100000" oninput="updateChart()">
          <span class="unit">å…ƒ</span>
        </div>
      </div>
      <div class="input-item">
        <label>å¹´åŒ–æ”¶ç›Šç‡ <span id="p1-rate-val" style="color:#fbbf24">10%</span></label>
        <input type="range" id="p1-rate" min="1" max="30" value="10" step="0.5" oninput="updateChart()">
      </div>
      <div class="input-item">
        <label>æŠ•èµ„å¹´é™ <span id="p1-years-val" style="color:#fbbf24">30å¹´</span></label>
        <input type="range" id="p1-years" min="5" max="50" value="30" oninput="updateChart()">
      </div>
    </div>

    <!-- æ¨¡å¼2ï¼šæ—©æŠ• vs æ™šæŠ• -->
    <div id="controls-mode2" class="input-grid" style="display:none">
      <div class="input-item">
        <label>æ¯å¹´å®šæŠ•é‡‘é¢</label>
        <div class="input-wrapper">
          <input type="number" id="p2-amount" value="50000" oninput="updateChart()">
          <span class="unit">å…ƒ/å¹´</span>
        </div>
      </div>
      <div class="input-item">
        <label>å¹´åŒ–æ”¶ç›Šç‡ <span id="p2-rate-val" style="color:#fbbf24">8%</span></label>
        <input type="range" id="p2-rate" min="1" max="20" value="8" step="0.5" oninput="updateChart()">
      </div>
      <div class="input-item">
        <label>æ—©æŠ•è€…(A)æå‰å‡ å¹´? <span id="p2-gap-val" style="color:#fbbf24">10å¹´</span></label>
        <input type="range" id="p2-gap" min="1" max="20" value="10" oninput="updateChart()">
      </div>
    </div>
  </div>

  <div class="chart-container" id="mainChart"></div>

  <div class="insights" id="insights">
    <!-- åŠ¨æ€ç”Ÿæˆ -->
  </div>
</div>

<script>
  let myChart = echarts.init(document.getElementById('mainChart'));
  let currentMode = 'simple-vs-compound';

  // æ ¼å¼åŒ–é‡‘é¢
  const formatMoney = (num) => {
    if (num >= 100000000) return (num / 100000000).toFixed(2) + ' äº¿';
    if (num >= 10000) return (num / 10000).toFixed(1) + ' ä¸‡';
    return Math.round(num).toLocaleString();
  };

  function switchMode(mode) {
    currentMode = mode;
    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('controls-mode1').style.display = mode === 'simple-vs-compound' ? 'grid' : 'none';
    document.getElementById('controls-mode2').style.display = mode === 'early-vs-late' ? 'grid' : 'none';
    
    updateChart();
  }

  function updateChart() {
    if (currentMode === 'simple-vs-compound') {
      calculateMode1();
    } else {
      calculateMode2();
    }
  }

  function calculateMode1() {
    const principal = Number(document.getElementById('p1-principal').value);
    const rate = Number(document.getElementById('p1-rate').value) / 100;
    const years = Number(document.getElementById('p1-years').value);

    // æ›´æ–°æ»‘å—æ˜¾ç¤º
    document.getElementById('p1-rate-val').innerText = (rate * 100).toFixed(1) + '%';
    document.getElementById('p1-years-val').innerText = years + 'å¹´';

    const result = CompoundLogic.calculateSimpleVsCompound(principal, rate, years);
    const { simpleData, compoundData, yearsLabel } = result;

    const finalSimple = simpleData[years];
    const finalCompound = compoundData[years];
    const diff = finalCompound - finalSimple;
    const multiple = (finalCompound / finalSimple).toFixed(1);

    // æ›´æ–°å›¾è¡¨
    const option = {
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'axis',
        backgroundColor: 'rgba(0,0,0,0.8)',
        borderColor: '#fbbf24',
        textStyle: { color: '#fff' },
        formatter: function(params) {
          let res = params[0].name + '<br/>';
          params.forEach(param => {
            res += param.marker + param.seriesName + ': ' + formatMoney(param.value) + '<br/>';
          });
          return res;
        }
      },
      legend: {
        data: ['å•åˆ©å¢é•¿', 'å¤åˆ©å¢é•¿'],
        textStyle: { color: '#ccc' },
        bottom: 0
      },
      grid: { left: '3%', right: '4%', bottom: '10%', containLabel: true },
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: yearsLabel,
        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
        axisLabel: { color: 'rgba(255,255,255,0.5)' }
      },
      yAxis: {
        type: 'value',
        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
        axisLabel: { color: 'rgba(255,255,255,0.5)', formatter: (v) => formatMoney(v) }
      },
      series: [
        {
          name: 'å•åˆ©å¢é•¿',
          type: 'line',
          data: simpleData,
          lineStyle: { color: '#94a3b8', width: 2, type: 'dashed' },
          itemStyle: { color: '#94a3b8' },
          symbol: 'none'
        },
        {
          name: 'å¤åˆ©å¢é•¿',
          type: 'line',
          data: compoundData,
          lineStyle: { color: '#fbbf24', width: 4 },
          itemStyle: { color: '#fbbf24' },
          areaStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: 'rgba(251,191,36,0.3)' },
              { offset: 1, color: 'rgba(251,191,36,0)' }
            ])
          },
          symbol: 'none'
        }
      ]
    };
    myChart.setOption(option);

    // æ›´æ–°ç»“è®º
    document.getElementById('insights').innerHTML = `
      <div class="insight-card">
        <div class="insight-title">ğŸ“ å•åˆ©ç»ˆå€¼</div>
        <div class="insight-value">${formatMoney(finalSimple)}</div>
        <div class="insight-desc">å¦‚æœæ”¶ç›Šä¸å¤æŠ•ï¼Œä½ çš„è´¢å¯Œçº¿æ€§å¢é•¿</div>
      </div>
      <div class="insight-card highlight">
        <div class="insight-title">ğŸš€ å¤åˆ©ç»ˆå€¼</div>
        <div class="insight-value">${formatMoney(finalCompound)}</div>
        <div class="insight-desc">æ˜¯å•åˆ©çš„ <strong>${multiple}å€</strong>ï¼å·®è·ä¸º <strong>${formatMoney(diff)}</strong></div>
      </div>
      <div class="insight-card">
        <div class="insight-title">ğŸ’¡ å…³é”®æ´å¯Ÿ</div>
        <div class="insight-desc">åœ¨å‰1/3çš„æ—¶é—´é‡Œï¼Œä¸¤è€…å·®è·ä¸å¤§ã€‚ä½†ä¸€æ—¦è·¨è¿‡<strong>æ‹ç‚¹</strong>ï¼Œå¤åˆ©æ›²çº¿å°†å‘ˆç°æŒ‡æ•°çº§çˆ†å‘ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦â€œé•¿æœŸä¸»ä¹‰â€ã€‚</div>
      </div>
    `;
  }

  function calculateMode2() {
    const annualAmount = Number(document.getElementById('p2-amount').value);
    const rate = Number(document.getElementById('p2-rate').value) / 100;
    const gapYears = Number(document.getElementById('p2-gap').value);
    const totalYears = 40; // å‡è®¾å¯¹æ¯”40å¹´å‘¨æœŸ

    // æ›´æ–°æ»‘å—
    document.getElementById('p2-rate-val').innerText = (rate * 100).toFixed(1) + '%';
    document.getElementById('p2-gap-val').innerText = gapYears + 'å¹´';

    const result = CompoundLogic.calculateEarlyVsLate(annualAmount, rate, gapYears, totalYears);
    const { earlyData, lateData, yearsLabel, investedA, investedB } = result;

    const finalA = earlyData[totalYears];
    const finalB = lateData[totalYears];

    const option = {
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'axis',
        backgroundColor: 'rgba(0,0,0,0.8)',
        borderColor: '#fbbf24',
        textStyle: { color: '#fff' },
        formatter: function(params) {
          let res = 'ç¬¬ ' + params[0].name + '<br/>';
          params.forEach(param => {
            res += param.marker + param.seriesName + ': ' + formatMoney(param.value) + '<br/>';
          });
          return res;
        }
      },
      legend: {
        data: ['æ—©é¸ŸA (åªæŠ•å‰'+gapYears+'å¹´)', 'æ™šé¸ŸB (ä¸€ç›´æŠ•)'],
        textStyle: { color: '#ccc' },
        bottom: 0
      },
      grid: { left: '3%', right: '4%', bottom: '10%', containLabel: true },
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: yearsLabel,
        axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
        axisLabel: { color: 'rgba(255,255,255,0.5)' }
      },
      yAxis: {
        type: 'value',
        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
        axisLabel: { color: 'rgba(255,255,255,0.5)', formatter: (v) => formatMoney(v) }
      },
      series: [
        {
          name: 'æ—©é¸ŸA (åªæŠ•å‰'+gapYears+'å¹´)',
          type: 'line',
          data: earlyData,
          lineStyle: { color: '#fbbf24', width: 4 },
          itemStyle: { color: '#fbbf24' },
          symbol: 'none'
        },
        {
          name: 'æ™šé¸ŸB (ä¸€ç›´æŠ•)',
          type: 'line',
          data: lateData,
          lineStyle: { color: '#3b82f6', width: 3 },
          itemStyle: { color: '#3b82f6' },
          symbol: 'none'
        }
      ]
    };
    myChart.setOption(option);

    // ç»“è®º
    let winnerText = '';
    if (finalA > finalB) {
      winnerText = `æ—©é¸Ÿ A èµ¢äº†ï¼å°½ç®¡ä»–æœ¬é‡‘åªæŠ•äº† ${formatMoney(investedA)}ï¼Œè€Œæ™šé¸Ÿ B æŠ•äº† ${formatMoney(investedB)}ã€‚`;
    } else {
      winnerText = `æ™šé¸Ÿ B ç»ˆäºè¿½ä¸Šäº†ï¼Œä½†ä»–å¤šæŠ•å…¥äº† ${formatMoney(investedB - investedA)} çš„æœ¬é‡‘æ‰å‹‰å¼ºèµ¶ä¸Šã€‚`;
    }

    document.getElementById('insights').innerHTML = `
      <div class="insight-card highlight">
        <div class="insight-title">ğŸ¦… æ—©é¸Ÿ A (èººå¹³æµ)</div>
        <div class="insight-value">${formatMoney(finalA)}</div>
        <div class="insight-desc">åªè¾›è‹¦äº† ${gapYears} å¹´ï¼Œæœ¬é‡‘æŠ•å…¥ <strong>${formatMoney(investedA)}</strong></div>
      </div>
      <div class="insight-card">
        <div class="insight-title">ğŸ¢ æ™šé¸Ÿ B (å¥‹æ–—æµ)</div>
        <div class="insight-value">${formatMoney(finalB)}</div>
        <div class="insight-desc">è¾›è‹¦äº† ${totalYears - gapYears} å¹´ï¼Œæœ¬é‡‘æŠ•å…¥ <strong>${formatMoney(investedB)}</strong></div>
      </div>
      <div class="insight-card">
        <div class="insight-title">ğŸ’¡ éœ‡æ’¼ç»“è®º</div>
        <div class="insight-desc">${winnerText} <br><strong>æ—¶é—´</strong>æ¯”åŠªåŠ›æ›´é‡è¦ã€‚</div>
      </div>
    `;
  }

  // åˆå§‹åŒ–
  updateChart();
  
  // å“åº”å¼
  window.addEventListener('resize', function() {
    myChart.resize();
  });
</script>
</body>
</html>
