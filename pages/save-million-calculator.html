<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­˜100ä¸‡æœ‰å¤šéš¾ï¼Ÿ- æ‰“å·¥äººæ”’é’±è®¡ç®—å™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 30px 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .header { text-align: center; margin: 20px 0 40px; }
    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(90deg, #f59e0b, #ef4444, #f59e0b);
      background-size: 300% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient 6s ease infinite;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .header p { color: rgba(255,255,255,0.5); margin-top: 12px; font-size: 15px; }

    .section-title {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      margin-bottom: 15px;
      padding-left: 5px;
      border-left: 3px solid #f59e0b;
    }
    .input-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .input-card {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 15px;
    }
    .input-card label {
      display: block;
      color: rgba(255,255,255,0.6);
      font-size: 12px;
      margin-bottom: 8px;
    }
    .input-card input, .input-card select {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px 12px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      outline: none;
      transition: border-color 0.3s;
    }
    .input-card input:focus, .input-card select:focus { border-color: #f59e0b; }
    .input-card select option { background: #1e293b; }
    .input-card .unit { color: rgba(255,255,255,0.4); font-size: 11px; margin-top: 4px; }
    .controls { display: flex; justify-content: center; margin: 30px 0; }
    .btn {
      padding: 14px 40px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s;
      background: linear-gradient(135deg, #f59e0b, #ef4444);
      color: white;
      box-shadow: 0 5px 25px rgba(245, 158, 11, 0.3);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 35px rgba(245, 158, 11, 0.4);
    }

    .results { display: none; }
    .results.show { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .result-hero {
      background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(239,68,68,0.15));
      border-radius: 20px;
      border: 1px solid rgba(245,158,11,0.3);
      padding: 40px;
      text-align: center;
      margin-bottom: 25px;
    }
    .result-hero .label { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 10px; }
    .result-hero .amount {
      font-size: 3.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #f59e0b, #ef4444);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .result-hero .amount span { font-size: 1.5rem; }
    .result-hero .sub { color: rgba(255,255,255,0.5); font-size: 13px; margin-top: 10px; }
    .result-hero.impossible { border-color: rgba(239,68,68,0.5); background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(127,29,29,0.2)); }
    .breakdown {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .breakdown-card {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
      text-align: center;
    }
    .breakdown-card .icon { font-size: 24px; margin-bottom: 8px; }
    .breakdown-card .value { font-size: 1.3rem; font-weight: 700; color: #f59e0b; }
    .breakdown-card .label { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 5px; }
    .breakdown-card.negative .value { color: #ef4444; }
    .breakdown-card.positive .value { color: #22c55e; }

    .chart-section {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 25px;
    }
    .chart-section h3 { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; text-align: center; }
    .chart-container { position: relative; height: 300px; }
    .timeline {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 25px;
    }
    .timeline h3 { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; }
    .timeline-bar {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      height: 40px;
      position: relative;
      overflow: hidden;
      margin-bottom: 15px;
    }
    .timeline-fill {
      height: 100%;
      border-radius: 10px;
      background: linear-gradient(90deg, #22c55e, #f59e0b, #ef4444);
      transition: width 1s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }
    .timeline-labels {
      display: flex;
      justify-content: space-between;
      color: rgba(255,255,255,0.4);
      font-size: 12px;
    }
    .life-stages {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .stage-card {
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      border-left: 3px solid #f59e0b;
    }
    .stage-card .age { color: #f59e0b; font-weight: 600; font-size: 14px; }
    .stage-card .event { color: rgba(255,255,255,0.7); font-size: 13px; margin-top: 5px; }
    .stage-card .impact { color: rgba(255,255,255,0.4); font-size: 12px; margin-top: 5px; }

    .reality-check {
      background: rgba(239,68,68,0.1);
      border-radius: 12px;
      border: 1px solid rgba(239,68,68,0.2);
      padding: 20px;
      margin-bottom: 25px;
    }
    .reality-check h3 { color: #ef4444; font-size: 14px; margin-bottom: 12px; }
    .reality-check ul { list-style: none; }
    .reality-check li { color: rgba(255,255,255,0.7); font-size: 13px; line-height: 1.8; padding-left: 20px; position: relative; }
    .reality-check li::before { content: 'âš ï¸'; position: absolute; left: 0; }
    .comparison {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 25px;
    }
    .comparison h3 { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; }
    .comparison-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .comparison-item:last-child { border-bottom: none; }
    .comparison-item .icon { width: 40px; font-size: 20px; }
    .comparison-item .desc { flex: 1; color: rgba(255,255,255,0.7); font-size: 13px; }
    .comparison-item .years { font-weight: 600; color: #f59e0b; min-width: 80px; text-align: right; }
    .formula {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 20px;
      font-size: 13px;
      color: rgba(255,255,255,0.4);
    }
    .formula summary { cursor: pointer; color: rgba(255,255,255,0.6); }
    .formula p { margin-top: 10px; line-height: 1.8; }
    .formula code { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; }
    @media (max-width: 600px) {
      .result-hero .amount { font-size: 2.5rem; }
      .header h1 { font-size: 1.6rem; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ’° å­˜100ä¸‡æœ‰å¤šéš¾ï¼Ÿ</h1>
    <p>æ‰“å·¥äººæ”’é’±çœŸç›¸è®¡ç®—å™¨</p>
  </div>

  <div class="section-title">ğŸ’¼ æ”¶å…¥æƒ…å†µ</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ’µ æœˆè–ªï¼ˆç¨åï¼‰</label>
      <input type="number" id="salary" value="5000" min="0" step="500">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ å¹´ç»ˆå¥–</label>
      <input type="number" id="bonus" value="5000" min="0" step="1000">
      <div class="unit">å…ƒ/å¹´ï¼ˆç¨åï¼‰</div>
    </div>
    <div class="input-card">
      <label>ğŸ“ˆ é¢„æœŸå¹´æ¶¨è–ª</label>
      <select id="salaryGrowth">
        <option value="0">0% - èººå¹³ä¸æ¶¨</option>
        <option value="0.03">3% - è·Ÿä¸Šé€šèƒ€</option>
        <option value="0.05" selected>5% - æ­£å¸¸æ¶¨å¹…</option>
        <option value="0.08">8% - è¡¨ç°ä¼˜ç§€</option>
        <option value="0.10">10% - è·³æ§½è¾¾äºº</option>
      </select>
    </div>
    <div class="input-card">
      <label>ğŸ‚ å½“å‰å¹´é¾„</label>
      <input type="number" id="currentAge" value="25" min="18" max="60">
      <div class="unit">å²</div>
    </div>
  </div>

  <div class="section-title">ğŸ  å›ºå®šæ”¯å‡º</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ  æˆ¿ç§Ÿ/æˆ¿è´·</label>
      <input type="number" id="housing" value="1500" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸœ åƒé¥­</label>
      <input type="number" id="food" value="1500" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸš‡ äº¤é€š</label>
      <input type="number" id="transport" value="300" min="0" step="50">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ“± è¯è´¹ç½‘è´¹</label>
      <input type="number" id="telecom" value="150" min="0" step="50">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
  </div>

  <div class="section-title">ğŸ® å¼¹æ€§æ”¯å‡º</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ‘• è´­ç‰©å¨±ä¹</label>
      <input type="number" id="shopping" value="500" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å­æ•¬çˆ¶æ¯</label>
      <input type="number" id="parents" value="500" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ‰ ç¤¾äº¤äººæƒ…</label>
      <input type="number" id="social" value="300" min="0" step="100">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ“¦ å…¶ä»–æ‚é¡¹</label>
      <input type="number" id="misc" value="250" min="0" step="50">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
  </div>

  <div class="section-title">âš™ï¸ è®¡ç®—è®¾ç½®</div>
  <div class="input-section">
    <div class="input-card">
      <label>ğŸ¯ ç›®æ ‡é‡‘é¢</label>
      <select id="targetAmount">
        <option value="300000">30ä¸‡ - å°ç›®æ ‡</option>
        <option value="500000">50ä¸‡ - é¦–ä»˜é’±</option>
        <option value="1000000" selected>100ä¸‡ - äººç”Ÿç¬¬ä¸€æ¡¶é‡‘</option>
        <option value="2000000">200ä¸‡ - ä¸­äº§é—¨æ§›</option>
        <option value="3000000">300ä¸‡ - ä¸€çº¿é¦–ä»˜</option>
      </select>
    </div>
    <div class="input-card">
      <label>ğŸ“ˆ ç†è´¢æ”¶ç›Šç‡</label>
      <select id="investReturn">
        <option value="0">0% - æ”¾é“¶è¡Œæ´»æœŸ</option>
        <option value="0.02">2% - è´§å¸åŸºé‡‘</option>
        <option value="0.035" selected>3.5% - å¤§é¢å­˜å•</option>
        <option value="0.05">5% - ç¨³å¥ç†è´¢</option>
        <option value="0.07">7% - åŸºé‡‘å®šæŠ•</option>
      </select>
    </div>
    <div class="input-card">
      <label>ğŸ“Š é€šèƒ€ç‡</label>
      <select id="inflation">
        <option value="0.02">2% - å®˜æ–¹CPI</option>
        <option value="0.03" selected>3% - å®é™…æ„Ÿå—</option>
        <option value="0.05">5% - ä½“æ„Ÿé€šèƒ€</option>
      </select>
    </div>
    <div class="input-card">
      <label>ğŸ’ æ˜¯å¦è€ƒè™‘ç»“å©š</label>
      <select id="marriage">
        <option value="0">ä¸è€ƒè™‘</option>
        <option value="100000">10ä¸‡ - ç®€å•åŠ</option>
        <option value="200000" selected>20ä¸‡ - æ­£å¸¸æ°´å¹³</option>
        <option value="300000">30ä¸‡ - ä½“é¢ä¸€ç‚¹</option>
      </select>
    </div>
  </div>

  <div class="controls">
    <button class="btn" onclick="calculate()">ğŸ§® ç®—ç®—è¦å¤šä¹…</button>
  </div>

  <div class="results" id="results">
    <div class="result-hero" id="resultHero">
      <div class="label">ğŸ¯ å­˜åˆ°ç›®æ ‡é‡‘é¢éœ€è¦</div>
      <div class="amount" id="yearsNeeded">0<span>å¹´</span></div>
      <div class="sub" id="resultSub">ä»ç°åœ¨å¼€å§‹ï¼Œä¸åƒä¸å–ä¹Ÿè¦...</div>
    </div>

    <div class="breakdown">
      <div class="breakdown-card">
        <div class="icon">ğŸ’°</div>
        <div class="value" id="monthlyIncome">0</div>
        <div class="label">æœˆæ”¶å…¥</div>
      </div>
      <div class="breakdown-card negative">
        <div class="icon">ğŸ’¸</div>
        <div class="value" id="monthlyExpense">0</div>
        <div class="label">æœˆæ”¯å‡º</div>
      </div>
      <div class="breakdown-card" id="savingCard">
        <div class="icon">ğŸ·</div>
        <div class="value" id="monthlySaving">0</div>
        <div class="label">æœˆç»“ä½™</div>
      </div>
      <div class="breakdown-card">
        <div class="icon">ğŸ“Š</div>
        <div class="value" id="savingRate">0%</div>
        <div class="label">å‚¨è“„ç‡</div>
      </div>
      <div class="breakdown-card">
        <div class="icon">ğŸ‚</div>
        <div class="value" id="targetAge">0</div>
        <div class="label">è¾¾æˆå¹´é¾„</div>
      </div>
      <div class="breakdown-card">
        <div class="icon">ğŸ“…</div>
        <div class="value" id="totalYearIncome">0</div>
        <div class="label">30å¹´æ€»æ”¶å…¥</div>
      </div>
    </div>

    <div class="timeline">
      <h3>â° äººç”Ÿè¿›åº¦æ¡ï¼ˆå·¥ä½œ30å¹´ï¼‰</h3>
      <div class="timeline-bar">
        <div class="timeline-fill" id="timelineFill">0%</div>
      </div>
      <div class="timeline-labels">
        <span>25å²å¼€å§‹å·¥ä½œ</span>
        <span id="targetMark">?å²å­˜åˆ°100ä¸‡</span>
        <span>55å²é€€ä¼‘</span>
      </div>
      <div class="life-stages" id="lifeStages"></div>
    </div>

    <div class="chart-section">
      <h3>ğŸ“ˆ è´¢å¯Œç§¯ç´¯æ›²çº¿</h3>
      <div class="chart-container">
        <canvas id="wealthChart"></canvas>
      </div>
    </div>

    <div class="chart-section">
      <h3>ğŸ’¸ æ”¶å…¥ vs æ”¯å‡ºæ„æˆ</h3>
      <div class="chart-container">
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <div class="comparison">
      <h3>ğŸ”„ ä¸åŒåœºæ™¯å¯¹æ¯”</h3>
      <div id="comparisonList"></div>
    </div>

    <div class="reality-check" id="realityCheck">
      <h3>âš ï¸ æ‰å¿ƒçœŸç›¸</h3>
      <ul id="realityList"></ul>
    </div>

    <details class="formula">
      <summary>ğŸ“ è®¡ç®—è¯´æ˜</summary>
      <p id="formulaText"></p>
    </details>
  </div>
</div>

<script>
let wealthChart = null;
let pieChart = null;

function calculate() {
  const salary = parseFloat(document.getElementById('salary').value) || 0;
  const bonus = parseFloat(document.getElementById('bonus').value) || 0;
  const salaryGrowth = parseFloat(document.getElementById('salaryGrowth').value);
  const currentAge = parseInt(document.getElementById('currentAge').value) || 25;
  
  const housing = parseFloat(document.getElementById('housing').value) || 0;
  const food = parseFloat(document.getElementById('food').value) || 0;
  const transport = parseFloat(document.getElementById('transport').value) || 0;
  const telecom = parseFloat(document.getElementById('telecom').value) || 0;
  const shopping = parseFloat(document.getElementById('shopping').value) || 0;
  const parents = parseFloat(document.getElementById('parents').value) || 0;
  const social = parseFloat(document.getElementById('social').value) || 0;
  const misc = parseFloat(document.getElementById('misc').value) || 0;
  
  const targetAmount = parseFloat(document.getElementById('targetAmount').value);
  const investReturn = parseFloat(document.getElementById('investReturn').value);
  const inflation = parseFloat(document.getElementById('inflation').value);
  const marriageCost = parseFloat(document.getElementById('marriage').value);
  
  const monthlyExpense = housing + food + transport + telecom + shopping + parents + social + misc;
  const monthlyIncome = salary;
  const yearlyIncome = salary * 12 + bonus;
  const monthlySaving = monthlyIncome - monthlyExpense;
  const savingRate = monthlyIncome > 0 ? (monthlySaving / monthlyIncome * 100) : 0;

  // æ¨¡æ‹Ÿé€å¹´ç§¯ç´¯
  let wealth = 0;
  let yearsNeeded = -1;
  const wealthData = [0];
  const labels = [currentAge];
  let totalIncome30Years = 0;
  let currentSalary = salary;
  let marriageDeducted = false;
  
  for (let year = 1; year <= 40; year++) {
    const age = currentAge + year;
    const yearlyExpense = monthlyExpense * 12 * Math.pow(1 + inflation, year);
    currentSalary = salary * Math.pow(1 + salaryGrowth, year);
    const yearIncome = currentSalary * 12 + bonus * Math.pow(1 + salaryGrowth, year);
    const yearlySaving = yearIncome - yearlyExpense;
    
    if (year <= 30) totalIncome30Years += yearIncome;
    
    // ç»“å©šæ”¯å‡ºï¼ˆå‡è®¾30å²ç»“å©šï¼‰
    if (marriageCost > 0 && age === 30 && !marriageDeducted) {
      wealth -= marriageCost;
      marriageDeducted = true;
    }
    
    wealth = wealth * (1 + investReturn) + yearlySaving;
    wealthData.push(Math.max(0, wealth));
    labels.push(age);
    
    if (wealth >= targetAmount && yearsNeeded === -1) {
      yearsNeeded = year;
    }
  }
  
  const impossible = yearsNeeded === -1;
  const targetAge = impossible ? 'æ— æ³•è¾¾æˆ' : (currentAge + yearsNeeded);
  
  // æ˜¾ç¤ºç»“æœ
  document.getElementById('results').classList.add('show');
  const heroEl = document.getElementById('resultHero');
  heroEl.classList.toggle('impossible', impossible);
  
  if (impossible) {
    document.getElementById('yearsNeeded').innerHTML = 'âˆ<span>å¹´</span>';
    document.getElementById('resultSub').textContent = 'æŒ‰å½“å‰æ”¶æ”¯ï¼Œ40å¹´å†…æ— æ³•è¾¾æˆç›®æ ‡...';
  } else {
    document.getElementById('yearsNeeded').innerHTML = yearsNeeded + '<span>å¹´</span>';
    document.getElementById('resultSub').textContent = `${currentAge}å²å¼€å§‹ï¼Œ${targetAge}å²å­˜åˆ°${(targetAmount/10000).toFixed(0)}ä¸‡`;
  }
  
  document.getElementById('monthlyIncome').textContent = monthlyIncome.toLocaleString() + 'å…ƒ';
  document.getElementById('monthlyExpense').textContent = monthlyExpense.toLocaleString() + 'å…ƒ';
  document.getElementById('monthlySaving').textContent = monthlySaving.toLocaleString() + 'å…ƒ';
  document.getElementById('savingRate').textContent = savingRate.toFixed(1) + '%';
  document.getElementById('targetAge').textContent = targetAge + (typeof targetAge === 'number' ? 'å²' : '');
  document.getElementById('totalYearIncome').textContent = (totalIncome30Years / 10000).toFixed(0) + 'ä¸‡';
  
  const savingCard = document.getElementById('savingCard');
  savingCard.classList.toggle('negative', monthlySaving < 0);
  savingCard.classList.toggle('positive', monthlySaving > 0);

  // æ—¶é—´çº¿
  const progress = impossible ? 100 : Math.min(100, (yearsNeeded / 30) * 100);
  document.getElementById('timelineFill').style.width = progress + '%';
  document.getElementById('timelineFill').textContent = impossible ? 'è¶…å‡ºå·¥ä½œå¹´é™' : yearsNeeded + 'å¹´';
  document.getElementById('targetMark').textContent = impossible ? '40å¹´å†…æ— æ³•è¾¾æˆ' : `${targetAge}å²å­˜åˆ°${(targetAmount/10000).toFixed(0)}ä¸‡`;
  
  // äººç”Ÿé˜¶æ®µ
  showLifeStages(currentAge, yearsNeeded, marriageCost);
  
  // å›¾è¡¨
  drawWealthChart(labels, wealthData, targetAmount, yearsNeeded, currentAge);
  drawPieChart(monthlyIncome, { housing, food, transport, telecom, shopping, parents, social, misc });
  
  // å¯¹æ¯”
  showComparison(salary, monthlyExpense, targetAmount, investReturn, inflation, salaryGrowth, bonus);
  
  // æ‰å¿ƒçœŸç›¸
  showReality(monthlySaving, savingRate, yearsNeeded, totalIncome30Years, targetAmount, impossible);
  
  // å…¬å¼
  showFormula(monthlyIncome, monthlyExpense, monthlySaving, savingRate, investReturn, inflation, salaryGrowth);
  
  document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function showLifeStages(currentAge, yearsNeeded, marriageCost) {
  const stages = [];
  if (marriageCost > 0) {
    stages.push({ age: '30å²', event: 'ç»“å©š', impact: `-${(marriageCost/10000).toFixed(0)}ä¸‡` });
  }
  stages.push({ age: '35å²', event: 'å¯èƒ½æœ‰å¨ƒ', impact: 'æ”¯å‡ºå¤§å¢' });
  stages.push({ age: '40å²', event: 'ä¸Šæœ‰è€ä¸‹æœ‰å°', impact: 'å‹åŠ›æœ€å¤§' });
  stages.push({ age: '50å²', event: 'å­å¥³æ•™è‚²é«˜å³°', impact: 'å­¦è´¹æƒŠäºº' });
  
  document.getElementById('lifeStages').innerHTML = stages.map(s => `
    <div class="stage-card">
      <div class="age">${s.age}</div>
      <div class="event">${s.event}</div>
      <div class="impact">${s.impact}</div>
    </div>
  `).join('');
}

function drawWealthChart(labels, data, target, yearsNeeded, currentAge) {
  const ctx = document.getElementById('wealthChart').getContext('2d');
  if (wealthChart) wealthChart.destroy();
  
  const targetLine = new Array(labels.length).fill(target);
  
  wealthChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels.map(age => age + 'å²'),
      datasets: [{
        label: 'ç´¯è®¡è´¢å¯Œ',
        data: data,
        borderColor: '#f59e0b',
        backgroundColor: 'rgba(245, 158, 11, 0.1)',
        fill: true,
        tension: 0.3,
        pointRadius: 0,
        borderWidth: 3
      }, {
        label: 'ç›®æ ‡é‡‘é¢',
        data: targetLine,
        borderColor: '#ef4444',
        borderDash: [5, 5],
        pointRadius: 0,
        borderWidth: 2,
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { intersect: false, mode: 'index' },
      plugins: {
        legend: { labels: { color: 'rgba(255,255,255,0.7)' } },
        tooltip: {
          callbacks: {
            label: ctx => ctx.dataset.label + ': ' + (ctx.raw / 10000).toFixed(1) + 'ä¸‡'
          }
        }
      },
      scales: {
        x: { ticks: { color: 'rgba(255,255,255,0.5)' }, grid: { color: 'rgba(255,255,255,0.05)' } },
        y: {
          ticks: {
            color: 'rgba(255,255,255,0.5)',
            callback: v => (v / 10000).toFixed(0) + 'ä¸‡'
          },
          grid: { color: 'rgba(255,255,255,0.05)' }
        }
      }
    }
  });
}

function drawPieChart(income, expenses) {
  const ctx = document.getElementById('pieChart').getContext('2d');
  if (pieChart) pieChart.destroy();
  
  const expenseLabels = ['æˆ¿ç§Ÿ/æˆ¿è´·', 'åƒé¥­', 'äº¤é€š', 'è¯è´¹', 'è´­ç‰©å¨±ä¹', 'å­æ•¬çˆ¶æ¯', 'ç¤¾äº¤', 'å…¶ä»–'];
  const expenseValues = [expenses.housing, expenses.food, expenses.transport, expenses.telecom, 
                         expenses.shopping, expenses.parents, expenses.social, expenses.misc];
  const totalExpense = expenseValues.reduce((a, b) => a + b, 0);
  const saving = income - totalExpense;
  
  pieChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: [...expenseLabels.filter((_, i) => expenseValues[i] > 0), saving > 0 ? 'ç»“ä½™' : ''],
      datasets: [{
        data: [...expenseValues.filter(v => v > 0), saving > 0 ? saving : 0].filter(v => v > 0),
        backgroundColor: ['#ef4444', '#f97316', '#eab308', '#22c55e', '#14b8a6', '#3b82f6', '#8b5cf6', '#ec4899', '#10b981'],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'right', labels: { color: 'rgba(255,255,255,0.7)', padding: 10, font: { size: 11 } } },
        tooltip: {
          callbacks: {
            label: ctx => {
              const pct = (ctx.raw / income * 100).toFixed(1);
              return `${ctx.label}: ${ctx.raw}å…ƒ (${pct}%)`;
            }
          }
        }
      }
    }
  });
}

function showComparison(salary, expense, target, investReturn, inflation, growth, bonus) {
  const scenarios = [
    { icon: 'ğŸœ', desc: 'ä¸åƒä¸å–ï¼ˆ0æ”¯å‡ºï¼‰', saving: salary },
    { icon: 'ğŸ ', desc: 'å›è€å®¶ä½ï¼ˆçœæˆ¿ç§Ÿï¼‰', saving: salary - expense + parseFloat(document.getElementById('housing').value) },
    { icon: 'ğŸ“ˆ', desc: 'å·¥èµ„ç¿»å€', saving: salary * 2 - expense },
    { icon: 'ğŸ’¼', desc: 'æä¸ªå‰¯ä¸šï¼ˆ+2000/æœˆï¼‰', saving: salary + 2000 - expense },
    { icon: 'ğŸ¯', desc: 'æé™çœé’±ï¼ˆåªèŠ±2000ï¼‰', saving: salary - 2000 }
  ];
  
  const html = scenarios.map(s => {
    let years = 'æ— æ³•è¾¾æˆ';
    if (s.saving > 0) {
      // ç®€åŒ–è®¡ç®—
      const yearlySaving = s.saving * 12 + bonus;
      if (investReturn > 0) {
        years = Math.ceil(Math.log(target * investReturn / yearlySaving + 1) / Math.log(1 + investReturn));
      } else {
        years = Math.ceil(target / yearlySaving);
      }
      years = years > 50 ? '50+' : years;
    }
    return `
      <div class="comparison-item">
        <div class="icon">${s.icon}</div>
        <div class="desc">${s.desc}ï¼ˆæœˆå­˜${s.saving > 0 ? s.saving.toLocaleString() : 0}å…ƒï¼‰</div>
        <div class="years">${typeof years === 'number' ? years + 'å¹´' : years}</div>
      </div>
    `;
  }).join('');
  
  document.getElementById('comparisonList').innerHTML = html;
}

function showReality(saving, rate, years, total30, target, impossible) {
  const truths = [];
  
  if (saving <= 0) {
    truths.push('æœˆå…‰æ—è­¦å‘Šï¼šä½ æ¯ä¸ªæœˆéƒ½åœ¨åƒè€æœ¬ï¼Œå­˜é’±ï¼Ÿå…ˆæ´»ä¸‹å»å†è¯´');
  } else if (rate < 20) {
    truths.push(`å‚¨è“„ç‡åªæœ‰${rate.toFixed(1)}%ï¼Œä½äº20%çš„å¥åº·çº¿ï¼Œæ”’é’±é€Ÿåº¦å ªå¿§`);
  }
  
  if (impossible) {
    truths.push('æŒ‰å½“å‰èŠ‚å¥ï¼Œå·¥ä½œåˆ°é€€ä¼‘ä¹Ÿå­˜ä¸åˆ°ç›®æ ‡é‡‘é¢ï¼Œéœ€è¦å¼€æºèŠ‚æµåŒç®¡é½ä¸‹');
  } else if (years > 20) {
    truths.push(`éœ€è¦${years}å¹´ï¼Œæ„å‘³ç€ä½ è¦ä¿æŒè¿™ä¸ªçŠ¶æ€åˆ°${years > 30 ? 'é€€ä¼‘ä»¥å' : 'ä¸­å¹´'}æ‰èƒ½è¾¾æˆ`);
  }
  
  truths.push(`30å¹´æ€»æ”¶å…¥çº¦${(total30/10000).toFixed(0)}ä¸‡ï¼Œçœ‹èµ·æ¥ä¸å°‘ï¼Œä½†æ‰£æ‰ç”Ÿæ´»å¼€æ”¯ã€ç»“å©šã€å…»å¨ƒã€åŒ»ç–—...`);
  truths.push('ä»¥ä¸Šè¿˜æ²¡ç®—ï¼šä¹°æˆ¿é¦–ä»˜ã€è£…ä¿®ã€ç”Ÿç—…ã€å¤±ä¸šã€çˆ¶æ¯å…»è€ã€å­©å­æ•™è‚²...');
  truths.push('é€šèƒ€æ˜¯éšå½¢æ€æ‰‹ï¼šä»Šå¤©çš„100ä¸‡ï¼Œ20å¹´åè´­ä¹°åŠ›å¯èƒ½åªå‰©50ä¸‡');
  
  if (target >= 1000000) {
    truths.push('100ä¸‡å¯¹æ™®é€šæ‰“å·¥äººæ¥è¯´ï¼ŒçœŸçš„æ˜¯ä¸€ä¸ªéœ€è¦åå¹´ä»¥ä¸Šæ‰èƒ½è§¦åŠçš„ç›®æ ‡');
  }
  
  document.getElementById('realityList').innerHTML = truths.map(t => `<li>${t}</li>`).join('');
}

function showFormula(income, expense, saving, rate, invest, inflation, growth) {
  document.getElementById('formulaText').innerHTML = `
    <strong>åŸºç¡€æ•°æ®ï¼š</strong><br>
    <code>æœˆæ”¶å…¥ ${income.toLocaleString()}å…ƒ - æœˆæ”¯å‡º ${expense.toLocaleString()}å…ƒ = æœˆç»“ä½™ ${saving.toLocaleString()}å…ƒ</code><br>
    <code>å‚¨è“„ç‡ = ${saving.toLocaleString()} / ${income.toLocaleString()} = ${rate.toFixed(1)}%</code><br><br>
    
    <strong>è®¡ç®—æ¨¡å‹ï¼š</strong><br>
    â€¢ æ¯å¹´å·¥èµ„æŒ‰ ${(growth*100).toFixed(0)}% å¢é•¿<br>
    â€¢ æ”¯å‡ºæŒ‰é€šèƒ€ç‡ ${(inflation*100).toFixed(0)}% å¢é•¿<br>
    â€¢ å­˜æ¬¾æŒ‰ ${(invest*100).toFixed(1)}% å¹´åŒ–æ”¶ç›Šå¤åˆ©<br>
    â€¢ 30å²æ‰£é™¤ç»“å©šè´¹ç”¨<br><br>
    
    <strong>å¤åˆ©å…¬å¼ï¼š</strong><br>
    <code>ç¬¬Nå¹´è´¢å¯Œ = ä¸Šå¹´è´¢å¯Œ Ã— (1 + æ”¶ç›Šç‡) + å½“å¹´ç»“ä½™</code><br><br>
    
    <strong>è¯´æ˜ï¼š</strong><br>
    â€¢ è¿™æ˜¯ç†æƒ³åŒ–æ¨¡å‹ï¼Œå®é™…ç”Ÿæ´»ä¸­è¿˜æœ‰å¾ˆå¤šæ„å¤–æ”¯å‡º<br>
    â€¢ æ²¡æœ‰è€ƒè™‘ï¼šä¹°æˆ¿ã€ç”Ÿç—…ã€å¤±ä¸šã€å…»å¨ƒç­‰å¤§é¢æ”¯å‡º<br>
    â€¢ å·¥èµ„å¢é•¿å‡è®¾æ¯”è¾ƒä¹è§‚ï¼Œå¾ˆå¤šäººå¯èƒ½æ¶¨ä¸äº†è¿™ä¹ˆå¤š
  `;
}

// è¾“å…¥å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
document.querySelectorAll('input, select').forEach(el => {
  el.addEventListener('change', () => {
    if (document.getElementById('results').classList.contains('show')) {
      calculate();
    }
  });
});
</script>
</body>
</html>
