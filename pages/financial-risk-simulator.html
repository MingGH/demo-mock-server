<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è´¢åŠ¡å†³ç­–é£é™©æ¨¡æ‹Ÿå™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 30px 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin: 20px 0 40px;
    }
    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #f472b6, #fb923c, #facc15, #f472b6);
      background-size: 300% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient 6s ease infinite;
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .header p {
      color: rgba(255,255,255,0.5);
      margin-top: 12px;
    }

    /* è¾“å…¥åŒºåŸŸ */
    .input-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .input-card {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
    }
    .input-card label {
      display: block;
      color: rgba(255,255,255,0.6);
      font-size: 13px;
      margin-bottom: 8px;
    }
    .input-card input {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 12px 15px;
      color: white;
      font-size: 18px;
      font-weight: 600;
      outline: none;
      transition: border-color 0.3s;
    }
    .input-card input:focus {
      border-color: #f472b6;
    }
    .input-card .unit {
      color: rgba(255,255,255,0.4);
      font-size: 12px;
      margin-top: 5px;
    }

    /* æŒ‰é’® */
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 14px 32px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #f472b6, #fb923c);
      color: white;
      box-shadow: 0 5px 25px rgba(244, 114, 182, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 35px rgba(244, 114, 182, 0.4);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ç»“æœåŒºåŸŸ */
    .results {
      display: none;
    }
    .results.show {
      display: block;
    }

    /* é£é™©å¡ç‰‡ */
    .risk-cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    @media (max-width: 700px) {
      .risk-cards { grid-template-columns: 1fr; }
    }

    .risk-card {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      text-align: center;
    }
    .risk-card h3 {
      font-size: 14px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 10px;
    }
    .risk-card .value {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    .risk-card .label {
      font-size: 13px;
      color: rgba(255,255,255,0.4);
    }
    .risk-card.buy .value { color: #f472b6; }
    .risk-card.nobuy .value { color: #4ade80; }

    /* å¯¹æ¯”æ¡ */
    .compare-bar {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 30px;
    }
    .compare-bar h3 {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      margin-bottom: 15px;
      text-align: center;
    }
    .bar-container {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .bar-item {
      flex: 1;
    }
    .bar-label {
      font-size: 12px;
      color: rgba(255,255,255,0.5);
      margin-bottom: 8px;
    }
    .bar {
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      transition: width 0.5s ease;
    }
    .bar.buy { background: linear-gradient(90deg, #f472b6, #fb923c); }
    .bar.nobuy { background: linear-gradient(90deg, #4ade80, #22d3ee); }

    /* å›¾è¡¨åŒºåŸŸ */
    .chart-section {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
      margin-bottom: 30px;
    }
    .chart-section h3 {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      margin-bottom: 20px;
      text-align: center;
    }
    .chart-container {
      position: relative;
      height: 300px;
    }

    /* è§£è¯» */
    .interpretation {
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 25px;
    }
    .interpretation h3 {
      color: #facc15;
      margin-bottom: 15px;
    }
    .interpretation p {
      color: rgba(255,255,255,0.7);
      line-height: 1.8;
      margin-bottom: 10px;
    }
    .interpretation .highlight {
      color: #f472b6;
      font-weight: 600;
    }
    .interpretation .safe {
      color: #4ade80;
      font-weight: 600;
    }

    /* æ–¹æ³•è¯´æ˜ */
    .method {
      margin-top: 30px;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      font-size: 13px;
      color: rgba(255,255,255,0.4);
    }
    .method summary {
      cursor: pointer;
      color: rgba(255,255,255,0.6);
    }
    .method p {
      margin-top: 10px;
      line-height: 1.6;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸ’° è´¢åŠ¡å†³ç­–é£é™©æ¨¡æ‹Ÿå™¨</h1>
    <p>ç”¨è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿï¼Œçœ‹çœ‹è¿™ç¬”æ¶ˆè´¹çš„çœŸå®é£é™©</p>
  </div>

  <div class="input-section">
    <div class="input-card">
      <label>ğŸ’µ å½“å‰å­˜æ¬¾</label>
      <input type="number" id="savings" value="50000" min="0" step="1000">
      <div class="unit">å…ƒ</div>
    </div>
    <div class="input-card">
      <label>ğŸ“ˆ æœˆæ”¶å…¥</label>
      <input type="number" id="income" value="5000" min="0" step="500">
      <div class="unit">å…ƒ/æœˆ</div>
    </div>
    <div class="input-card">
      <label>ğŸ“‰ æœˆæ”¯å‡º</label>
      <input type="number" id="expense" value="3500" min="0" step="500">
      <div class="unit">å…ƒ/æœˆï¼ˆæ—¥å¸¸å¼€é”€ï¼‰</div>
    </div>
    <div class="input-card">
      <label>ğŸ›ï¸ è®¡åˆ’æ¶ˆè´¹</label>
      <input type="number" id="purchase" value="20000" min="0" step="1000">
      <div class="unit">å…ƒï¼ˆé‚£ä¸ªåŒ…/ç”µè„‘/...ï¼‰</div>
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-primary" onclick="runSimulation()">ğŸ² è¿è¡Œ 1000 æ¬¡æ¨¡æ‹Ÿ</button>
  </div>

  <div class="results" id="results">
    <div class="risk-cards">
      <div class="risk-card buy">
        <h3>ğŸ›ï¸ ä¹°äº†ä¹‹å</h3>
        <div class="value" id="riskBuy">-</div>
        <div class="label">12ä¸ªæœˆå†…"åƒåœŸ"æ¦‚ç‡</div>
      </div>
      <div class="risk-card nobuy">
        <h3>ğŸ’ª ä¸ä¹°çš„è¯</h3>
        <div class="value" id="riskNoBuy">-</div>
        <div class="label">12ä¸ªæœˆå†…"åƒåœŸ"æ¦‚ç‡</div>
      </div>
    </div>

    <div class="compare-bar">
      <h3>ğŸ“Š åº”æ€¥å‚¨å¤‡é‡‘å¯¹æ¯”ï¼ˆå»ºè®®è‡³å°‘è¦†ç›– 6 ä¸ªæœˆæ”¯å‡ºï¼‰</h3>
      <div class="bar-container">
        <div class="bar-item">
          <div class="bar-label">ä¹°äº†ä¹‹åèƒ½æ’‘</div>
          <div class="bar buy" id="barBuy" style="width: 50%">- ä¸ªæœˆ</div>
        </div>
        <div class="bar-item">
          <div class="bar-label">ä¸ä¹°èƒ½æ’‘</div>
          <div class="bar nobuy" id="barNoBuy" style="width: 100%">- ä¸ªæœˆ</div>
        </div>
      </div>
    </div>

    <div class="chart-section">
      <h3>ğŸ“ˆ 1000 æ¬¡æ¨¡æ‹Ÿçš„å­˜æ¬¾èµ°åŠ¿ï¼ˆå±•ç¤ºå‰ 50 æ¡è·¯å¾„ï¼‰</h3>
      <div class="chart-container">
        <canvas id="chart"></canvas>
      </div>
    </div>

    <div class="interpretation" id="interpretation">
      <h3>ğŸ¯ è§£è¯»</h3>
      <p id="interpretText"></p>
    </div>

    <details class="method">
      <summary>ğŸ“ æ¨¡æ‹Ÿæ–¹æ³•è¯´æ˜</summary>
      <p>
        æœ¬æ¨¡æ‹Ÿä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•ï¼Œå¯¹æœªæ¥ 12 ä¸ªæœˆçš„è´¢åŠ¡çŠ¶å†µè¿›è¡Œ 1000 æ¬¡éšæœºæ¨¡æ‹Ÿã€‚<br><br>
        æ¯æ¬¡æ¨¡æ‹Ÿä¸­ï¼š<br>
        â€¢ 8% æ¦‚ç‡è§¦å‘å¤±ä¸šï¼Œä¸€æ—¦å¤±ä¸šæŒç»­ 3-6 ä¸ªæœˆé›¶æ”¶å…¥<br>
        â€¢ 15% æ¦‚ç‡äº§ç”Ÿ 2000-17000 å…ƒæ„å¤–æ”¯å‡ºï¼ˆç”Ÿç—…/ç»´ä¿®/çº¢åŒ…ç­‰ï¼‰<br>
        â€¢ 3% æ¦‚ç‡äº§ç”Ÿ 10000-40000 å…ƒå¤§é¢æ„å¤–ï¼ˆå¤§ç—…/äº‹æ•…ï¼‰<br>
        â€¢ æ—¥å¸¸æ”¯å‡ºæœ‰ Â±30% çš„éšæœºæ³¢åŠ¨<br><br>
        "åƒåœŸ"å®šä¹‰ä¸ºï¼šå­˜æ¬¾é™è‡³ 0 ä»¥ä¸‹ï¼ˆä»»æ„æœˆä»½ï¼‰ã€‚
      </p>
    </details>
  </div>
</div>

<script>
let chart = null;

function runSimulation() {
  const savings = parseFloat(document.getElementById('savings').value) || 0;
  const income = parseFloat(document.getElementById('income').value) || 0;
  const expense = parseFloat(document.getElementById('expense').value) || 0;
  const purchase = parseFloat(document.getElementById('purchase').value) || 0;
  
  const months = 12;
  const simulations = 1000;
  
  // è¿è¡Œæ¨¡æ‹Ÿ
  const resultsBuy = simulate(savings - purchase, income, expense, months, simulations);
  const resultsNoBuy = simulate(savings, income, expense, months, simulations);
  
  // è®¡ç®—ç ´äº§æ¦‚ç‡
  const riskBuy = (resultsBuy.bankruptCount / simulations * 100).toFixed(1);
  const riskNoBuy = (resultsNoBuy.bankruptCount / simulations * 100).toFixed(1);
  
  // è®¡ç®—åº”æ€¥å‚¨å¤‡æœˆæ•°
  const monthsBuy = Math.max(0, (savings - purchase) / expense).toFixed(1);
  const monthsNoBuy = (savings / expense).toFixed(1);
  
  // æ˜¾ç¤ºç»“æœ
  document.getElementById('results').classList.add('show');
  document.getElementById('riskBuy').textContent = riskBuy + '%';
  document.getElementById('riskNoBuy').textContent = riskNoBuy + '%';
  
  // æ›´æ–°å¯¹æ¯”æ¡
  const maxMonths = Math.max(parseFloat(monthsNoBuy), 12);
  document.getElementById('barBuy').style.width = (monthsBuy / maxMonths * 100) + '%';
  document.getElementById('barBuy').textContent = monthsBuy + ' ä¸ªæœˆ';
  document.getElementById('barNoBuy').style.width = (monthsNoBuy / maxMonths * 100) + '%';
  document.getElementById('barNoBuy').textContent = monthsNoBuy + ' ä¸ªæœˆ';
  
  // ç»˜åˆ¶å›¾è¡¨
  drawChart(resultsBuy.paths, resultsNoBuy.paths, months);
  
  // ç”Ÿæˆè§£è¯»
  generateInterpretation(riskBuy, riskNoBuy, monthsBuy, monthsNoBuy, purchase);
}

function simulate(initialSavings, income, expense, months, simulations) {
  let bankruptCount = 0;
  const paths = [];
  
  for (let i = 0; i < simulations; i++) {
    let balance = initialSavings;
    const path = [balance];
    let bankrupt = false;
    let unemployedMonths = 0; // å¤±ä¸šæŒç»­æœˆæ•°
    
    for (let m = 0; m < months; m++) {
      let monthIncome = income;
      
      // å¤±ä¸šæ¨¡å‹ï¼šä¸€æ—¦å¤±ä¸šï¼ŒæŒç»­3-6ä¸ªæœˆ
      if (unemployedMonths > 0) {
        monthIncome = 0;
        unemployedMonths--;
      } else if (Math.random() < 0.08) {
        // 8% æ¦‚ç‡è§¦å‘å¤±ä¸šï¼ŒæŒç»­3-6ä¸ªæœˆ
        unemployedMonths = 3 + Math.floor(Math.random() * 4);
        monthIncome = 0;
      }
      
      // æ”¯å‡ºæ³¢åŠ¨ï¼šÂ±30%
      let monthExpense = expense * (0.7 + Math.random() * 0.6);
      
      // æ„å¤–æ”¯å‡ºï¼š15% æ¦‚ç‡ï¼Œé‡‘é¢æ›´å¤§
      if (Math.random() < 0.15) {
        monthExpense += 2000 + Math.random() * 15000;
      }
      
      // å¤§é¢æ„å¤–ï¼š3% æ¦‚ç‡ï¼ˆå¤§ç—…/äº‹æ•…ï¼‰
      if (Math.random() < 0.03) {
        monthExpense += 10000 + Math.random() * 30000;
      }
      
      balance = balance + monthIncome - monthExpense;
      path.push(balance);
      
      if (balance < 0) {
        bankrupt = true;
      }
    }
    
    if (bankrupt) bankruptCount++;
    if (i < 50) paths.push(path);
  }
  
  return { bankruptCount, paths };
}

function drawChart(pathsBuy, pathsNoBuy, months) {
  const ctx = document.getElementById('chart').getContext('2d');
  
  if (chart) chart.destroy();
  
  const labels = Array.from({length: months + 1}, (_, i) => `ç¬¬${i}æœˆ`);
  
  const datasets = [];
  
  // ä¹°äº†çš„è·¯å¾„ï¼ˆç²‰è‰²ï¼‰
  pathsBuy.slice(0, 20).forEach((path, i) => {
    datasets.push({
      data: path,
      borderColor: 'rgba(244, 114, 182, 0.3)',
      borderWidth: 1,
      pointRadius: 0,
      fill: false,
      tension: 0.1
    });
  });
  
  // ä¸ä¹°çš„è·¯å¾„ï¼ˆç»¿è‰²ï¼‰
  pathsNoBuy.slice(0, 20).forEach((path, i) => {
    datasets.push({
      data: path,
      borderColor: 'rgba(74, 222, 128, 0.3)',
      borderWidth: 1,
      pointRadius: 0,
      fill: false,
      tension: 0.1
    });
  });
  
  // é›¶çº¿
  datasets.push({
    data: Array(months + 1).fill(0),
    borderColor: 'rgba(255, 100, 100, 0.8)',
    borderWidth: 2,
    borderDash: [5, 5],
    pointRadius: 0,
    fill: false
  });
  
  chart = new Chart(ctx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: { enabled: false }
      },
      scales: {
        x: {
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { color: 'rgba(255,255,255,0.4)' }
        },
        y: {
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { 
            color: 'rgba(255,255,255,0.4)',
            callback: v => (v/10000).toFixed(1) + 'ä¸‡'
          }
        }
      }
    }
  });
}

function generateInterpretation(riskBuy, riskNoBuy, monthsBuy, monthsNoBuy, purchase) {
  let text = '';
  
  const riskDiff = (riskBuy - riskNoBuy).toFixed(1);
  
  if (riskBuy > 30) {
    text = `<span class="highlight">é£é™©è¾ƒé«˜ï¼</span>ä¹°äº†ä¹‹åï¼Œæœªæ¥ä¸€å¹´å†…"åƒåœŸ"çš„æ¦‚ç‡æ˜¯ ${riskBuy}%ï¼Œå·®ä¸å¤šæ¯ ${Math.round(100/riskBuy)} ä¸ªç±»ä¼¼æƒ…å†µçš„äººé‡Œå°±æœ‰ 1 ä¸ªä¼šé‡åˆ°è´¢åŠ¡å±æœºã€‚`;
  } else if (riskBuy > 10) {
    text = `é£é™©ä¸­ç­‰ã€‚ä¹°äº†ä¹‹å"åƒåœŸ"æ¦‚ç‡æ˜¯ ${riskBuy}%ï¼Œæ¯”ä¸ä¹°é«˜äº† <span class="highlight">${riskDiff} ä¸ªç™¾åˆ†ç‚¹</span>ã€‚`;
  } else {
    text = `<span class="safe">é£é™©å¯æ§ã€‚</span>ä¹°äº†ä¹‹å"åƒåœŸ"æ¦‚ç‡åªæœ‰ ${riskBuy}%ï¼Œè´¢åŠ¡çŠ¶å†µç›¸å¯¹å¥åº·ã€‚`;
  }
  
  text += `<br><br>`;
  
  if (monthsBuy < 3) {
    text += `âš ï¸ ä¹°å®Œååº”æ€¥å‚¨å¤‡é‡‘åªå¤Ÿ <span class="highlight">${monthsBuy} ä¸ªæœˆ</span>ï¼Œä½äºå»ºè®®çš„ 3-6 ä¸ªæœˆå®‰å…¨çº¿ã€‚ä¸€æ—¦å¤±ä¸šæˆ–ç”Ÿç—…ï¼Œç¼“å†²ç©ºé—´å¾ˆå°ã€‚`;
  } else if (monthsBuy < 6) {
    text += `ä¹°å®Œåè¿˜æœ‰ ${monthsBuy} ä¸ªæœˆçš„åº”æ€¥å‚¨å¤‡ï¼Œå‹‰å¼ºè¾¾æ ‡ï¼Œä½†å»ºè®®å†æ”’ä¸€äº›å†è€ƒè™‘å¤§é¢æ¶ˆè´¹ã€‚`;
  } else {
    text += `<span class="safe">ä¹°å®Œåè¿˜æœ‰ ${monthsBuy} ä¸ªæœˆçš„åº”æ€¥å‚¨å¤‡</span>ï¼Œè¶…è¿‡ 6 ä¸ªæœˆå®‰å…¨çº¿ï¼Œè´¢åŠ¡å¼¹æ€§ä¸é”™ã€‚`;
  }
  
  text += `<br><br>`;
  text += `ğŸ’¡ è¿™ä¸æ˜¯è¯´"ä¸è¯¥ä¹°"ï¼Œè€Œæ˜¯è®©ä½ æ¸…æ¥šè¿™ç¬”æ¶ˆè´¹çš„çœŸå®ä»£ä»·ã€‚å¦‚æœè¿™ ${purchase/10000} ä¸‡èƒ½å¸¦æ¥çš„å¿«ä¹å€¼å¾—è¿™ä¸ªé£é™©ï¼Œé‚£å°±ä¹°ï¼›å¦‚æœåªæ˜¯ä¸€æ—¶å†²åŠ¨ï¼Œä¸å¦¨å†ç­‰ç­‰ã€‚`;
  
  document.getElementById('interpretText').innerHTML = text;
}

// é¡µé¢åŠ è½½æ—¶ä¸è‡ªåŠ¨è¿è¡Œï¼Œç­‰ç”¨æˆ·ç‚¹å‡»
</script>

</body>
</html>
