<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç™¾ä¸‡åªé¸¡ç è…¿é—®é¢˜ - æ¦‚ç‡è®ºçš„ä¼˜é›…è§£ç­”</title>
  <script src="../components/header.js" defer></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #e4e4e4;
      padding: 30px 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .header { text-align: center; margin: 20px 0 40px; }
    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ffd700, #ff6b6b, #ffd700);
      background-size: 200% 100%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease infinite;
    }
    @keyframes shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .header p { color: rgba(255,255,255,0.6); margin-top: 12px; font-size: 15px; line-height: 1.6; }

    /* é¸¡åœºå¯è§†åŒ– */
    .farm-section {
      background: rgba(255,255,255,0.03);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 30px;
      margin-bottom: 30px;
    }
    .farm-title {
      text-align: center;
      color: #ffd700;
      font-size: 18px;
      margin-bottom: 25px;
    }
    .chicken-farm {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    .chicken-group {
      text-align: center;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      min-width: 150px;
    }
    .chicken-icon { font-size: 48px; margin-bottom: 10px; }
    .chicken-count { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
    .chicken-label { font-size: 13px; color: rgba(255,255,255,0.5); }
    .chicken-group.healthy .chicken-count { color: #4ade80; }
    .chicken-group.one-leg .chicken-count { color: #fbbf24; }
    .chicken-group.no-leg .chicken-count { color: #f87171; }

    /* æ§åˆ¶é¢æ¿ */
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .control-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .control-group label { color: rgba(255,255,255,0.6); font-size: 14px; }
    .control-group input, .control-group select {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: 10px 15px;
      color: white;
      font-size: 14px;
      width: 150px;
    }
    .btn {
      padding: 12px 30px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #ffd700, #ff6b6b);
      color: #1a1a2e;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn:hover:not(:disabled) { transform: translateY(-2px); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* è¿›åº¦æ¡ */
    .progress-section {
      margin: 20px 0;
    }
    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 8px;
      color: rgba(255,255,255,0.6);
    }
    .progress-bar {
      height: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4ade80, #22d3ee);
      border-radius: 10px;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: #1a1a2e;
    }
    /* åŠ¨ç”»é¸¡ */
    .animation-area {
      height: 120px;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      position: relative;
      overflow: hidden;
      margin: 20px 0;
    }
    .flying-chicken {
      position: absolute;
      font-size: 30px;
      animation: flyAcross 2s linear;
      opacity: 0;
    }
    @keyframes flyAcross {
      0% { left: -50px; opacity: 1; transform: rotate(0deg); }
      50% { opacity: 1; transform: rotate(10deg); }
      100% { left: 100%; opacity: 0; transform: rotate(-10deg); }
    }

    /* ç»Ÿè®¡åŒºåŸŸ */
    .stats-section {
      background: rgba(255,255,255,0.03);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 30px;
      margin-bottom: 30px;
    }
    .stats-title {
      text-align: center;
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      margin-bottom: 25px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    @media (max-width: 600px) {
      .stats-grid { grid-template-columns: 1fr; }
    }
    .stat-card {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
    }
    .stat-label { color: rgba(255,255,255,0.5); font-size: 13px; margin-bottom: 10px; }
    .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
    .stat-detail { font-size: 13px; color: rgba(255,255,255,0.4); }
    .stat-card.theory .stat-value { color: #a78bfa; }
    .stat-card.simulation .stat-value { color: #4ade80; }
    .stat-card.error .stat-value { color: #fbbf24; }

    /* æ•°å­¦æ¨å¯¼ */
    .math-section {
      background: rgba(255,255,255,0.03);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 30px;
      margin-bottom: 30px;
    }
    .math-section h3 {
      color: #ffd700;
      font-size: 16px;
      margin-bottom: 20px;
    }
    .math-section p {
      color: rgba(255,255,255,0.7);
      line-height: 1.8;
      margin-bottom: 15px;
      font-size: 14px;
    }
    .formula {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      font-family: 'Times New Roman', serif;
      font-size: 18px;
      color: #4ade80;
      overflow-x: auto;
    }
    .key-point {
      background: rgba(255,215,0,0.1);
      border-left: 3px solid #ffd700;
      padding: 15px;
      margin: 20px 0;
      border-radius: 0 10px 10px 0;
    }
    .key-point strong { color: #ffd700; }
    /* å›¾è¡¨ */
    .chart-container {
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }
    #distributionChart { width: 100%; height: 300px; }

    /* çŸ¥ä¹å›ç­”æ ·å¼ */
    .zhihu-section {
      background: linear-gradient(135deg, rgba(0,132,255,0.1), rgba(0,132,255,0.05));
      border-radius: 20px;
      border: 1px solid rgba(0,132,255,0.2);
      padding: 30px;
      margin-bottom: 30px;
    }
    .zhihu-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .zhihu-logo { font-size: 24px; }
    .zhihu-title { color: #0084ff; font-size: 16px; }
    .zhihu-content {
      color: rgba(255,255,255,0.8);
      line-height: 2;
      font-size: 15px;
    }
    .zhihu-content p { margin-bottom: 15px; }
    .zhihu-content .highlight { 
      color: #ffd700; 
      font-weight: 600;
      background: rgba(255,215,0,0.1);
      padding: 2px 6px;
      border-radius: 4px;
    }
    .copy-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background: #0084ff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .copy-btn:hover { background: #006acc; }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ” ç™¾ä¸‡åªé¸¡ç è…¿é—®é¢˜</h1>
    <p>100ä¸‡åªé¸¡ï¼Œæ¯æ¬¡ä»æœ‰è…¿çš„é¸¡ä¸­éšæœºæŠ½ä¸€åªç æ‰ä¸€æ¡è…¿ï¼Œé‡å¤100ä¸‡æ¬¡<br>æœ€åæœŸæœ›è¿˜æœ‰å¤šå°‘åªå®Œå¥½çš„é¸¡ï¼Ÿ</p>
  </div>

  <!-- å¯è§†åŒ–æ¨¡æ‹Ÿ -->
  <div class="farm-section">
    <div class="farm-title">ğŸ® é¸¡åœºå®æ—¶çŠ¶æ€</div>
    <div class="chicken-farm">
      <div class="chicken-group healthy">
        <div class="chicken-icon">ğŸ”</div>
        <div class="chicken-count" id="healthyCount">1,000,000</div>
        <div class="chicken-label">å®Œå¥½çš„é¸¡ (2æ¡è…¿)</div>
      </div>
      <div class="chicken-group one-leg">
        <div class="chicken-icon">ğŸ¦µğŸ”</div>
        <div class="chicken-count" id="oneLegCount">0</div>
        <div class="chicken-label">ç‹¬è…¿é¸¡ (1æ¡è…¿)</div>
      </div>
      <div class="chicken-group no-leg">
        <div class="chicken-icon">ğŸª¹</div>
        <div class="chicken-count" id="noLegCount">0</div>
        <div class="chicken-label">æ— è…¿é¸¡ (0æ¡è…¿)</div>
      </div>
    </div>

    <div class="controls">
      <div class="control-group">
        <label>é¸¡çš„æ•°é‡ N:</label>
        <input type="number" id="chickenCount" value="1000000" min="100" max="10000000">
      </div>
      <div class="control-group">
        <label>æ¨¡æ‹Ÿé€Ÿåº¦:</label>
        <select id="simSpeed">
          <option value="instant">ç¬é—´å®Œæˆ</option>
          <option value="fast">å¿«é€ŸåŠ¨ç”»</option>
          <option value="slow">æ…¢é€Ÿæ¼”ç¤º</option>
        </select>
      </div>
    </div>
    <div class="controls">
      <button class="btn btn-primary" id="startBtn" onclick="startSimulation()">ğŸš€ å¼€å§‹æ¨¡æ‹Ÿ</button>
      <button class="btn btn-secondary" onclick="resetSimulation()">ğŸ”„ é‡ç½®</button>
    </div>
    
    <div class="progress-section">
      <div class="progress-label">
        <span>ç è…¿è¿›åº¦</span>
        <span id="progressText">0 / 1,000,000</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
    </div>
    
    <div class="animation-area" id="animationArea"></div>
  </div>

  <!-- ç»Ÿè®¡ç»“æœ -->
  <div class="stats-section">
    <div class="stats-title">ğŸ“Š æ¨¡æ‹Ÿç»“æœ vs ç†è®ºå€¼</div>
    <div class="stats-grid">
      <div class="stat-card theory">
        <div class="stat-label">ç†è®ºæœŸæœ›å€¼</div>
        <div class="stat-value" id="theoryValue">-</div>
        <div class="stat-detail">N Ã— 0.3178 â‰ˆ 31.78%</div>
      </div>
      <div class="stat-card simulation">
        <div class="stat-label">æ¨¡æ‹Ÿç»“æœ</div>
        <div class="stat-value" id="simValue">-</div>
        <div class="stat-detail" id="simDetail">ç­‰å¾…æ¨¡æ‹Ÿ...</div>
      </div>
      <div class="stat-card error">
        <div class="stat-label">ç›¸å¯¹è¯¯å·®</div>
        <div class="stat-value" id="errorValue">-</div>
        <div class="stat-detail">|æ¨¡æ‹Ÿ - ç†è®º| / ç†è®º</div>
      </div>
    </div>
  </div>

  <!-- åˆ†å¸ƒå›¾è¡¨ -->
  <div class="stats-section">
    <div class="stats-title">ğŸ“ˆ å¤šæ¬¡æ¨¡æ‹Ÿåˆ†å¸ƒ</div>
    <div class="controls">
      <button class="btn btn-secondary" onclick="runMultipleSimulations(100)">è¿è¡Œ100æ¬¡æ¨¡æ‹Ÿ</button>
      <button class="btn btn-secondary" onclick="runMultipleSimulations(1000)">è¿è¡Œ1000æ¬¡æ¨¡æ‹Ÿ</button>
    </div>
    <div class="chart-container">
      <canvas id="distributionChart"></canvas>
    </div>
    <div id="multiSimStats" style="text-align: center; color: rgba(255,255,255,0.6); font-size: 14px;"></div>
  </div>

  <!-- æ•°å­¦æ¨å¯¼ -->
  <div class="math-section">
    <h3>ğŸ§® æ•°å­¦æ¨å¯¼ï¼šç­”æ¡ˆçº¦ä¸º N Ã— 31.78%</h3>
    
    <p>è®¾ N = 100ä¸‡ï¼Œæˆ‘ä»¬è¦ç  N æ¬¡è…¿ã€‚</p>
    
    <p><strong>æ ¸å¿ƒæ€è·¯ï¼š</strong>è€ƒè™‘æŸä¸€åªç‰¹å®šçš„é¸¡ï¼Œå®ƒä¿æŒå®Œå¥½çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ</p>
    
    <div class="key-point">
      <strong>å…³é”®æ´å¯Ÿï¼š</strong>ä¸€åªé¸¡å®Œå¥½ = å®ƒä»æœªè¢«é€‰ä¸­
    </div>
    
    <p>è®¾åœ¨ç¬¬ k æ¬¡ç è…¿å‰ï¼š</p>
    <ul style="color: rgba(255,255,255,0.7); margin-left: 20px; line-height: 2;">
      <li>H<sub>k</sub> = å®Œå¥½çš„é¸¡æ•°é‡ï¼ˆ2æ¡è…¿ï¼‰</li>
      <li>O<sub>k</sub> = ç‹¬è…¿é¸¡æ•°é‡ï¼ˆ1æ¡è…¿ï¼‰</li>
      <li>æœ‰è…¿çš„é¸¡æ€»æ•° = H<sub>k</sub> + O<sub>k</sub></li>
    </ul>
    
    <p>æ¯æ¬¡ç è…¿æ—¶ï¼Œä»æœ‰è…¿çš„é¸¡ä¸­éšæœºé€‰ä¸€åªï¼š</p>
    <ul style="color: rgba(255,255,255,0.7); margin-left: 20px; line-height: 2;">
      <li>é€‰ä¸­å®Œå¥½é¸¡çš„æ¦‚ç‡ = H / (H + O)</li>
      <li>é€‰ä¸­ç‹¬è…¿é¸¡çš„æ¦‚ç‡ = O / (H + O)</li>
    </ul>
    
    <div class="formula">
      E[H<sub>k+1</sub>] = H<sub>k</sub> - H<sub>k</sub>/(H<sub>k</sub> + O<sub>k</sub>)
    </div>
    
    <p>è¿™ä¸ªé€’æ¨å…³ç³»å¯ä»¥ç”¨å¾®åˆ†æ–¹ç¨‹è¿‘ä¼¼æ±‚è§£ã€‚å½“ N â†’ âˆ æ—¶ï¼š</p>
    
    <div class="formula">
      å®Œå¥½é¸¡çš„æ¯”ä¾‹ â†’ <span style="color:#ffd700">0.31784...</span> â‰ˆ 31.78%
    </div>
    
    <p>å› æ­¤ï¼Œå®Œå¥½çš„é¸¡çš„æœŸæœ›æ•°é‡ï¼š</p>
    
    <div class="formula">
      E[å®Œå¥½çš„é¸¡] = 1,000,000 Ã— 0.3178 â‰ˆ <span style="color:#ffd700">317,844</span>
    </div>
  </div>

  <!-- æœ‰è¶£çš„å‘ç° -->
  <div class="math-section">
    <h3>ğŸ¯ æœ‰è¶£çš„å‘ç°</h3>
    
    <p>è¿™ä¸ªå¸¸æ•° 0.31784... éå¸¸æ¥è¿‘ 1/Ï€ â‰ˆ 0.31831ï¼Œä½†å¹¶ä¸å®Œå…¨ç›¸ç­‰ï¼</p>
    
    <div class="key-point">
      <strong>æ•°å­¦ä¹‹ç¾ï¼š</strong>è¿™ä¸ªé—®é¢˜æ²¡æœ‰ç®€å•çš„é—­å¼è§£ï¼Œä½†é€šè¿‡é€’æ¨æˆ–å¾®åˆ†æ–¹ç¨‹å¯ä»¥ç²¾ç¡®è®¡ç®—ã€‚<br><br>
      ç›´è§‰ç†è§£ï¼šä¸€åªé¸¡ä¿æŒå®Œå¥½ = å®ƒä»æœªè¢«é€‰ä¸­ã€‚æ¯æ¬¡è¢«é€‰ä¸­çš„æ¦‚ç‡çº¦ä¸º 1/(æœ‰è…¿é¸¡æ•°)ï¼Œä½†æœ‰è…¿é¸¡æ•°ä¼šéšç€ç‹¬è…¿é¸¡å˜æˆæ— è…¿é¸¡è€Œå‡å°‘ï¼Œè¿™ä½¿å¾—åˆ†æå˜å¾—å¤æ‚ã€‚
    </div>
    
    <p>å¦‚æœé¢˜ç›®æ”¹æˆ"ä»æ‰€æœ‰è…¿ä¸­éšæœºé€‰ä¸€æ¡ç æ‰"ï¼Œé‚£ç­”æ¡ˆå°±æ˜¯ N/eÂ² â‰ˆ 13.53%ã€‚ä½†åŸé¢˜æ˜¯"ä»æœ‰è…¿çš„é¸¡ä¸­é€‰ä¸€åª"ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 31.78%ã€‚</p>
  </div>

  
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ============ æ ¸å¿ƒè®¡ç®—å‡½æ•°ï¼ˆå¯æµ‹è¯•ï¼‰============
// ç†è®ºæ¯”ä¾‹å¸¸æ•°ï¼ˆé€šè¿‡æ•°å€¼æ–¹æ³•è®¡ç®—å¾—åˆ°çš„æé™å€¼ï¼‰
const THEORY_RATIO = 0.31784443;

const ChickenLegSimulator = {
  // ç†è®ºå€¼è®¡ç®—
  calculateTheory: function(n) {
    // å¯¹äºæœ‰é™çš„ Nï¼Œç”¨æœŸæœ›å€¼é€’æ¨è®¡ç®—ç²¾ç¡®ç†è®ºå€¼
    if (n <= 10000) {
      return this.calculateExactTheory(n);
    }
    // å¯¹äºå¤§ Nï¼Œä½¿ç”¨æé™æ¯”ä¾‹
    return n * THEORY_RATIO;
  },
  
  // ç²¾ç¡®ç†è®ºå€¼ï¼ˆæœŸæœ›å€¼é€’æ¨ï¼‰
  calculateExactTheory: function(n) {
    let H = n;
    let O = 0;
    
    for (let k = 0; k < n; k++) {
      const total = H + O;
      if (total < 1e-10) break;
      
      const probHealthy = H / total;
      const newH = H - probHealthy;
      const newO = O + probHealthy - (O / total);
      
      H = newH;
      O = newO;
    }
    
    return H;
  },
  
  // å•æ¬¡æ¨¡æ‹Ÿ - ä»æœ‰è…¿çš„é¸¡ä¸­é€‰ä¸€åªï¼Œç ä¸€æ¡è…¿
  simulate: function(n) {
    let healthy = n;      // 2æ¡è…¿çš„é¸¡
    let oneLeg = 0;       // 1æ¡è…¿çš„é¸¡
    let noLeg = 0;        // 0æ¡è…¿çš„é¸¡ï¼ˆé€€å‡ºæŠ½é€‰æ± ï¼‰
    
    for (let i = 0; i < n; i++) {
      // æœ‰è…¿çš„é¸¡æ€»æ•°
      const chickensWithLegs = healthy + oneLeg;
      if (chickensWithLegs === 0) break;
      
      // ä»æœ‰è…¿çš„é¸¡ä¸­éšæœºé€‰ä¸€åª
      const rand = Math.random() * chickensWithLegs;
      
      if (rand < healthy) {
        // é€‰ä¸­äº†å®Œå¥½çš„é¸¡ï¼Œç ä¸€æ¡è…¿ï¼Œå˜æˆç‹¬è…¿é¸¡
        healthy--;
        oneLeg++;
      } else {
        // é€‰ä¸­äº†ç‹¬è…¿é¸¡ï¼Œç æ‰å”¯ä¸€çš„è…¿ï¼Œå˜æˆæ— è…¿é¸¡
        oneLeg--;
        noLeg++;
      }
    }
    
    return { healthy, oneLeg, noLeg };
  },
  
  // æ‰¹é‡æ¨¡æ‹Ÿ
  simulateMultiple: function(n, times) {
    const results = [];
    for (let i = 0; i < times; i++) {
      results.push(this.simulate(n).healthy);
    }
    return results;
  },
  
  // è®¡ç®—ç»Ÿè®¡é‡
  calculateStats: function(results) {
    const n = results.length;
    const mean = results.reduce((a, b) => a + b, 0) / n;
    const variance = results.reduce((a, b) => a + (b - mean) ** 2, 0) / n;
    const stdDev = Math.sqrt(variance);
    const min = Math.min(...results);
    const max = Math.max(...results);
    return { mean, stdDev, min, max };
  }
};

// å¯¼å‡ºä¾›æµ‹è¯•ä½¿ç”¨
if (typeof module !== 'undefined' && module.exports) {
  module.exports = ChickenLegSimulator;
}

// ============ UI äº¤äº’ ============
let simulationRunning = false;
let chart = null;

function formatNumber(num) {
  return Math.round(num).toLocaleString();
}

function updateDisplay(healthy, oneLeg, noLeg, progress, total) {
  document.getElementById('healthyCount').textContent = formatNumber(healthy);
  document.getElementById('oneLegCount').textContent = formatNumber(oneLeg);
  document.getElementById('noLegCount').textContent = formatNumber(noLeg);
  
  const pct = (progress / total * 100).toFixed(1);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = `${formatNumber(progress)} / ${formatNumber(total)}`;
}

function updateStats(n, simHealthy) {
  const theory = ChickenLegSimulator.calculateTheory(n);
  const error = Math.abs(simHealthy - theory) / theory * 100;
  
  document.getElementById('theoryValue').textContent = formatNumber(theory);
  document.getElementById('simValue').textContent = formatNumber(simHealthy);
  document.getElementById('simDetail').textContent = `å æ¯” ${(simHealthy / n * 100).toFixed(2)}%`;
  document.getElementById('errorValue').textContent = error.toFixed(2) + '%';
}

async function startSimulation() {
  if (simulationRunning) return;
  simulationRunning = true;
  
  const n = parseInt(document.getElementById('chickenCount').value) || 1000000;
  const speed = document.getElementById('simSpeed').value;
  
  document.getElementById('startBtn').disabled = true;
  
  if (speed === 'instant') {
    // ç¬é—´å®Œæˆ
    const result = ChickenLegSimulator.simulate(n);
    updateDisplay(result.healthy, result.oneLeg, result.noLeg, n, n);
    updateStats(n, result.healthy);
  } else {
    // åŠ¨ç”»æ¨¡å¼
    const batchSize = speed === 'fast' ? Math.ceil(n / 100) : Math.ceil(n / 500);
    let healthy = n, oneLeg = 0, noLeg = 0;
    
    for (let i = 0; i < n; i += batchSize) {
      const actualBatch = Math.min(batchSize, n - i);
      
      for (let j = 0; j < actualBatch; j++) {
        const chickensWithLegs = healthy + oneLeg;
        if (chickensWithLegs === 0) break;
        
        const rand = Math.random() * chickensWithLegs;
        if (rand < healthy) {
          healthy--;
          oneLeg++;
        } else {
          oneLeg--;
          noLeg++;
        }
      }
      
      updateDisplay(healthy, oneLeg, noLeg, i + actualBatch, n);
      
      // æ·»åŠ åŠ¨ç”»é¸¡
      if (Math.random() < 0.3) {
        addFlyingChicken();
      }
      
      await new Promise(r => setTimeout(r, speed === 'fast' ? 20 : 50));
    }
    
    updateStats(n, healthy);
  }
  
  document.getElementById('startBtn').disabled = false;
  simulationRunning = false;
}

function resetSimulation() {
  const n = parseInt(document.getElementById('chickenCount').value) || 1000000;
  updateDisplay(n, 0, 0, 0, n);
  document.getElementById('theoryValue').textContent = '-';
  document.getElementById('simValue').textContent = '-';
  document.getElementById('simDetail').textContent = 'ç­‰å¾…æ¨¡æ‹Ÿ...';
  document.getElementById('errorValue').textContent = '-';
}

function addFlyingChicken() {
  const area = document.getElementById('animationArea');
  const chicken = document.createElement('div');
  chicken.className = 'flying-chicken';
  chicken.textContent = ['ğŸ”', 'ğŸ¦µ', 'ğŸ—'][Math.floor(Math.random() * 3)];
  chicken.style.top = Math.random() * 80 + 'px';
  area.appendChild(chicken);
  
  setTimeout(() => chicken.remove(), 2000);
}

function runMultipleSimulations(times) {
  const n = parseInt(document.getElementById('chickenCount').value) || 1000000;
  const smallN = Math.min(n, 10000); // ä¸ºäº†é€Ÿåº¦ï¼Œç”¨è¾ƒå°çš„N
  
  const results = ChickenLegSimulator.simulateMultiple(smallN, times);
  const stats = ChickenLegSimulator.calculateStats(results);
  const theory = ChickenLegSimulator.calculateTheory(smallN);
  
  // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
  document.getElementById('multiSimStats').innerHTML = 
    `N=${smallN.toLocaleString()} æ¨¡æ‹Ÿ${times}æ¬¡ | ` +
    `å‡å€¼: ${stats.mean.toFixed(1)} | ` +
    `æ ‡å‡†å·®: ${stats.stdDev.toFixed(1)} | ` +
    `ç†è®ºå€¼: ${theory.toFixed(1)} | ` +
    `èŒƒå›´: [${stats.min}, ${stats.max}]`;
  
  // ç»˜åˆ¶ç›´æ–¹å›¾
  drawHistogram(results, theory);
}

function drawHistogram(results, theory) {
  const ctx = document.getElementById('distributionChart').getContext('2d');
  
  // è®¡ç®—ç›´æ–¹å›¾æ•°æ®
  const min = Math.min(...results);
  const max = Math.max(...results);
  const binCount = 30;
  const binWidth = (max - min) / binCount || 1;
  
  const bins = new Array(binCount).fill(0);
  results.forEach(v => {
    const idx = Math.min(Math.floor((v - min) / binWidth), binCount - 1);
    bins[idx]++;
  });
  
  const labels = bins.map((_, i) => Math.round(min + i * binWidth));
  
  if (chart) chart.destroy();
  
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'é¢‘æ¬¡',
        data: bins,
        backgroundColor: 'rgba(74, 222, 128, 0.6)',
        borderColor: 'rgba(74, 222, 128, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        annotation: {
          annotations: {
            line1: {
              type: 'line',
              xMin: theory,
              xMax: theory,
              borderColor: '#ffd700',
              borderWidth: 2,
              label: {
                content: 'ç†è®ºå€¼',
                enabled: true
              }
            }
          }
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'å®Œå¥½çš„é¸¡æ•°é‡', color: 'rgba(255,255,255,0.6)' },
          ticks: { color: 'rgba(255,255,255,0.6)' },
          grid: { color: 'rgba(255,255,255,0.1)' }
        },
        y: {
          title: { display: true, text: 'é¢‘æ¬¡', color: 'rgba(255,255,255,0.6)' },
          ticks: { color: 'rgba(255,255,255,0.6)' },
          grid: { color: 'rgba(255,255,255,0.1)' }
        }
      }
    }
  });
}

function copyZhihuAnswer() {
  const answer = `è¿™é“é¢˜ä¹ä¸€çœ‹å¾ˆå¤æ‚ï¼Œä½†ç­”æ¡ˆå‡ºå¥‡åœ°ä¼˜é›…ï¼šçº¦ 317,844 åªï¼Œä¹Ÿå°±æ˜¯ â‰ˆ 31.78%ã€‚

è®©æˆ‘ç”¨æœ€ç›´è§‚çš„æ–¹å¼è§£é‡Šã€‚

ã€ç†è§£é¢˜æ„ã€‘

"ä»æœ‰è…¿çš„é¸¡ä¸­æŠ½å–ä¸€åªç æ‰ä¸€æ¡è…¿" = ä»å®Œå¥½é¸¡å’Œç‹¬è…¿é¸¡ä¸­éšæœºé€‰ä¸€åªï¼Œç å®ƒä¸€æ¡è…¿ã€‚

æ³¨æ„ï¼šæ— è…¿é¸¡é€€å‡ºæŠ½é€‰æ± ï¼Œä¸ä¼šè¢«é€‰ä¸­ã€‚

ã€æ¢ä¸ªè§’åº¦æƒ³ã€‘

ä¸å…¶è¿½è¸ªæ•´ä¸ªé¸¡ç¾¤çš„çŠ¶æ€å˜åŒ–ï¼Œä¸å¦‚é—®ï¼šæŸä¸€åªç‰¹å®šçš„é¸¡ï¼Œå®ƒä¿æŒå®Œå¥½çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ

ä¸€åªé¸¡å®Œå¥½ = å®ƒä»æœªè¢«é€‰ä¸­ã€‚

ã€é€’æ¨åˆ†æã€‘

è®¾ H = å®Œå¥½é¸¡æ•°ï¼ŒO = ç‹¬è…¿é¸¡æ•°ã€‚æ¯æ¬¡ç è…¿ï¼š
â€¢ é€‰ä¸­å®Œå¥½é¸¡çš„æ¦‚ç‡ = H / (H + O)
â€¢ é€‰ä¸­ç‹¬è…¿é¸¡çš„æ¦‚ç‡ = O / (H + O)

è¿™å½¢æˆä¸€ä¸ªé€’æ¨å…³ç³»ï¼Œå¯ä»¥ç”¨æœŸæœ›å€¼è¿­ä»£æˆ–å¾®åˆ†æ–¹ç¨‹æ±‚è§£ã€‚

ã€æœ€ç»ˆç­”æ¡ˆã€‘

å½“ N â†’ âˆ æ—¶ï¼Œå®Œå¥½é¸¡çš„æ¯”ä¾‹æ”¶æ•›åˆ°çº¦ 0.31784ï¼ˆæœ‰è¶£çš„æ˜¯ï¼Œè¿™éå¸¸æ¥è¿‘ 1/Ï€ â‰ˆ 0.31831ï¼Œä½†ä¸å®Œå…¨ç›¸ç­‰ï¼‰ã€‚

æ‰€ä»¥ï¼šå®Œå¥½çš„é¸¡çš„æœŸæœ›æ•°é‡ = 100ä¸‡ Ã— 0.3178 â‰ˆ 317,844 åª

ã€éªŒè¯ã€‘

ä¸ä¿¡ï¼Ÿæˆ‘å†™äº†ä¸ªæ¨¡æ‹Ÿå™¨ï¼šhttps://mock.runnable.run/pages/chicken-leg-problem.html
è·‘ä¸ªå‡ ç™¾ä¸‡æ¬¡ï¼Œç»“æœç¨³ç¨³åœ°è½åœ¨ 31.78% é™„è¿‘ã€‚

â€”â€”
è¿™é“é¢˜çš„æœ¬è´¨æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«è¿‡ç¨‹ï¼Œæ²¡æœ‰ç®€å•çš„é—­å¼è§£ï¼Œä½†å¯ä»¥é€šè¿‡æ•°å€¼æ–¹æ³•ç²¾ç¡®è®¡ç®—ã€‚`;

  navigator.clipboard.writeText(answer).then(() => {
    alert('å›ç­”å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
  });
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
  resetSimulation();
});
</script>
</body>
</html>
